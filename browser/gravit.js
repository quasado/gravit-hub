function gShellReady(){gApp=new GApplication}function gShellFinished(){gApp.init(),gShell.prepare(),gApp.relayout(),setTimeout(function(){gShell.start(),__loader.remove()},2500)}!function(a){var b={init:function(c){return c=a.extend({selector:null},c),this.each(function(){var d=this;a(this).data("gautoedit",{options:c,input:null}).on("dblclick",function(){b.open.call(d)})})},open:function(){var c=this,d=a(this),e=d.data("gautoedit");e.input&&b.close.call(this);var f=d.find(e.options.selector);if(0===f.length){if(e.options.selector)return;f=d}var g=f.offset();e.value=f.text(),e.input=a("<input>").css({position:"absolute",left:g.left+"px",top:g.top+"px",width:f.outerWidth()+"px",height:f.outerHeight()+"px"}).val(e.value).on("blur",function(){b.submit.call(c)}).on("keyup",function(a){13===a.keyCode?b.submit.call(c):27===a.keyCode&&b.close.call(c)}).appendTo(a("body")).focus().select()},submit:function(){var c=a(this),d=c.data("gautoedit"),e=d.input?d.input.val():null;b.close.call(this),e&&d.value!==e&&c.trigger("submitvalue",e)},close:function(){var b=a(this),c=b.data("gautoedit");c.input&&(c.input.remove(),c.input=null,c.value=null)}};a.fn.gAutoEdit=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.myPlugin"):b.init.apply(this,arguments)}}(jQuery),function(a){var b={init:function(c){return c=a.extend({title:"",content:"",controls:null},c),this.each(function(){{var d=this;a(this).empty().addClass("g-panel").data("gpanel",{options:c,expanded:!0}).append(a("<div></div>").addClass("header").append(a("<div></div>").addClass("title").append(a("<i></i>").addClass("fa fa-angle-down")).append(a("<span></span>").text(c.title)).on("click",function(){b.toggle.call(d)})).append(a("<div></div>").addClass("controls").append(c.controls))).append(a("<div></div>").addClass("content").append(c.content))}})},toggle:function(){var c=a(this),d=c.data("gpanel");b.expanded.call(this,!d.expanded)},expanded:function(b){var c=a(this),d=c.data("gpanel");return arguments.length?(b!==d.expanded&&(d.expanded=b,c.find(".content").css("display",d.expanded?"":"none"),c.find(".controls").css("visibility",d.expanded?"":"hidden"),c.find(".header i.fa").toggleClass("fa-angle-down",d.expanded).toggleClass("fa-angle-right",!d.expanded)),this):d.expanded}};a.fn.gPanel=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.myPlugin"):b.init.apply(this,arguments)}}(jQuery),function(a){var b=20,c=a("<div></div>").css({position:"absolute",left:"0px",top:"0px",width:b+"px",height:b+"px","z-index":"-1"}).appendTo(a("body")),d={init:function(e){return e=a.extend({allowDrag:!0,allowDrop:!0,types:null},e),this.each(function(){var f=this,g=a(this);g.data("gpatterntarget",{options:e,pattern:null}),e.allowDrag&&g.attr("draggable","true").on("dragstart",function(a){var d=a.originalEvent,e=g.data("gpatterntarget").pattern;return e?(d.stopPropagation(),g.trigger("patterndrag",e),c.css("background",IFPattern.asCSSBackground(e)),d.dataTransfer.effectAllowed="move",d.dataTransfer.setData(IFPattern.MIME_TYPE,IFPattern.asString(e)),d.dataTransfer.setDragImage(c[0],b/2,b/2),void(d.dataTransfer.sourceElement=this)):void d.preventDefault()}).on("dragend",function(a){var b=a.originalEvent;b.stopPropagation()}),e.allowDrop&&g.on("dragover",function(a){var b=a.originalEvent;b.preventDefault(),b.stopPropagation(),a.originalEvent.dataTransfer.dropEffect="move"}).on("drop",function(a){var b=a.originalEvent,c=b.dataTransfer.getData(IFPattern.MIME_TYPE);if(c&&(c=IFPattern.parsePattern(c),c&&(!e.types||0===e.types.length||e.types.indexOf(c.getPatternType())>=0))){var h=g.data("gpatterntarget").pattern;IFPattern.equals(c,h)||(d.value.call(f,c),g.trigger("patternchange",c)),g.trigger("patterndrop",[c,b])}return!1})})},value:function(b){var c=a(this),d=c.data("gpatterntarget");return arguments.length?(b="string"==typeof b?IFPattern.parsePattern(b):b,d.pattern=b,this):d.pattern}};a.fn.gPatternTarget=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):d.init.apply(this,arguments)}}(jQuery),function(a){function b(){return c||(c=a("<div></div>").css("padding","5px").gColorPanel().gOverlay()),c}var c=null,d={init:function(c){return c=a.extend({"transient":!1,autoOpen:!0,allowClear:!1,immediateClose:!1,scene:null},c),c.types=[IFPattern.Type.Color],this.each(function(){var e=this,f=a(this);f.data("g-colorbutton",{options:c,scene:c.scene,panelCloseListener:function(){var a=f.data("g-colorbutton"),c=b();c.gColorPanel("scene",null),c.off("colorchange",a.panelChangeListener),c.off("close",a.panelCloseListener)},panelChangeListener:function(a,b){c.immediateClose&&d.close.call(e),d.value.call(e,b),f.trigger("colorchange",b)}}).gPatternTarget(c).on("patternchange",function(a,b){d.value.call(e,b)}),c.transient||f.addClass("g-cursor-pipette").append(a("<span></span>").addClass("fa fa-ban").css("visibility","hidden")),c.autoOpen&&f.on("click",function(){d.open.call(e)})})},open:function(){var c=a(this),e=c.data("g-colorbutton"),f=b();return f.gColorPanel("scene",e.scene),f.gColorPanel("value",d.value.call(this)),f.gColorPanel("allowClear",e.options.allowClear),f.on("colorchange",e.panelChangeListener),f.on("close",e.panelCloseListener),f.gOverlay("open",this),this},close:function(){var a=b();return a.gOverlay("close",this),this},scene:function(b){var c=a(this),d=c.data("g-colorbutton");return arguments.length?(d.scene=b,this):d.scene},value:function(b){var c=a(this),d=c.data("g-colorbutton");return arguments.length?(c.gPatternTarget("value",b),d.options.transient||c.css("background",IFPattern.asCSSBackground(b)),this):c.gPatternTarget("value")}};a.fn.gColorButton=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):d.init.apply(this,arguments)}}(jQuery),function(a){function b(b){for(var c=a("<table></table>"),d=a("<tr></tr>").appendTo(c),e=0,f=0;f<s.length;++f){var g="#"+s[f];a("<td></td>").addClass("swatch").css("background",g).attr("data-color",g).on("click",function(){var c=IFColor.parseCSSColor(a(this).attr("data-color"));p(b,c,!1),b.trigger("colorchange",c)}).appendTo(d),++e===r&&(e=0,d=a("<tr></tr>").appendTo(c))}return c}function c(b){var c=b.data("gcolorpanel");return a("<div></div>").gSwatchPanel({nullSwatch:a("<span></span>").addClass("fa fa-plus-circle"),nullName:"Add current color as new swatch",types:[IFPattern.Type.Color],allowSelect:!1}).on("swatchchange",function(a,d){if(d){var e=d.getProperty("pat");p(b,e,!1),b.trigger("colorchange",e)}else{if(!c.scene||!c.color)return;for(var f=c.scene.getSwatchCollection(),g=f.getFirstChild();null!==g;g=g.getNext())if(g instanceof IFSwatch&&g.getPatternType()===IFPattern.Type.Color&&IFColor.equals(c.color,g.getProperty("pat")))return;var h=prompt("Enter a name for the new swatch:",c.color.asString());if(null===h)return;""===h.trim()&&(h=c.color.asString());var i=IFEditor.getEditor(c.scene);i&&i.beginTransaction();try{var d=new IFSwatch;d.setProperties(["name","pat"],[h,c.color]),f.appendChild(d)}finally{i&&i.commitTransaction("Add Swatch")}}})}function d(b){var c=function(c,d){var e=null;switch(c){case 1:e="Tint";break;case 2:e="Shade";break;case 3:e="Tone"}a("<div></div>").addClass("color-trend-label").text(e).appendTo(d);for(var g=a("<div></div>").addClass("color-trend color-trend-"+c.toString()).append(a("<div></div>").addClass("color-palette").append(a("<div></div>").addClass("color-preview"))).append(a("<div></div>").addClass("color-trend-value").append(a("<input>").attr("type","text").on("input",function(){{var d=a(this).val();f(b,c,d)}}))).appendTo(d),h=g.find(".color-preview"),i=1;10>=i;++i)a("<div>&nbsp;</div>").addClass("g-input color-trend-box-"+(10===i?"current":i.toString())).css("width","10%").on("click",function(){var c=IFColor.parseColor(a(this).attr("data-color"));c&&(p(b,c,!1),b.trigger("colorchange",c))}).appendTo(h)}.bind(this),d=a("<div></div>");return c(1,d),c(2,d),c(3,d),d}function e(a,b,c){var d=a.data("gcolorpanel").color;if(!d)return null;switch(b){case 1:return d.withTint(c);case 2:return d.withShade(c);case 3:return d.withTone(c);default:throw new Error("Unknown trend: "+b)}}function f(a,b,c){"string"==typeof c&&(c=parseInt(c),isNaN(c)&&(c=50)),0>c?c=0:c>100&&(c=100);var d=a.find('[data-view="trends"]'),f=d.find(".color-trend-"+b.toString()),g=e(a,b,c);return f.find(".color-trend-box-current").attr("data-color",g?g.asString():"").css("background",IFPattern.asCSSBackground(g)),f.find(".color-trend-value > input").val(c),g}function g(a){for(var b=a.find('[data-view="trends"]'),c=1;3>=c;++c)for(var d=b.find(".color-trend-"+c.toString()),g=1;9>=g;++g){var h=e(a,c,10*g);d.find(".color-trend-box-"+g.toString()).attr("data-color",h?h.asString():"").css("background",IFPattern.asCSSBackground(h)),5===g&&f(a,c,50)}}function h(a){return new IFColor(IFColor.Type.RGB,[a[0],a[1],a[2],100])}function i(b){return a("<div></div>").append(a("<div></div>").addClass("image-panel").text("Drag an image here").on("dragenter",function(){return a(this).css("background","maroon"),!1}).on("dragleave",function(){return a(this).css("background",""),!1}).on("dragover",function(){return!1}).on("drop",function(c){var d=a(this);d.css("background","");var e=d.closest("[data-view]").find(".image-palette");e.empty();for(var f=function(c){a("<div></div>").css("background",IFPattern.asCSSBackground(c)).on("click",function(){p(b,c,!1),b.trigger("colorchange",c)}.bind(this)).appendTo(e)}.bind(this),g=c.originalEvent.dataTransfer.files,i=g.length,j=/image.*/,k=0;i>k;k++){var l=g[k];if(l.type.match(j)){var m=new FileReader;m.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var a=new ColorThief,c=h(a.getColor(b));f(c);for(var d=a.getPalette(b,8),e=0;e<d.length;++e){var g=h(d[e]);IFColor.equals(g,c)||f(g)}}.bind(this),d.css("background-image","url("+a.target.result+")").text("")}.bind(this),m.readAsDataURL(l);break}}return!1})).append(a("<div></div>").addClass("image-palette"))}function j(a,e){var f=null;if(e===q.Palette)f=b(a);else if(e===q.Swatches)f=c(a);else if(e===q.Trends)f=d(a);else{if(e!==q.Image)throw new Error("Unknown color view: "+e);f=i(a)}f&&f.attr("data-view",e).css("display","none").appendTo(a.find(".color-view"))}function k(b){var c=b.data("gcolorpanel"),d=b.find(".matcher-palette");if(d.empty(),c.matcher&&c.color){var e=function(c,e){a("<div></div>").css("width",e.toString()+"%").css("background",IFPattern.asCSSBackground(c)).on("click",function(){p(b,c,!1),b.trigger("colorchange",c)}.bind(this)).appendTo(d)}.bind(this),f=c.matcher.match(c.color);if(f&&f.length>0)for(var g=Math.min(f.length,8),h=100/g,i=0;g>i;++i){var j=c.color?f[i].toType(c.color.getType()):f[i];e(j,h)}}}function l(a,b){var c=a.data("gcolorpanel");c.matcher=b,k(a)}function m(a,b){var c=a.data("gcolorpanel");if(!c.colorMode||b!==c.colorMode.type.key)for(var d=0;d<ColorModes.length;++d){var e=ColorModes[d];if(e.type.key===b){c.colorMode=e;for(var d=0;4>d;++d){var f=a.find(".color-component-"+d.toString());if(d>=e.components.length)f.css("visibility","hidden");else{f.css("visibility","");var g=e.components[d],h=f.find('input[type="range"]'),i=f.find(".color-label"),j=f.find(".color-unit");i.text(g.label),j.text(g.unit),j.css("display",""!=g.unit?"":"none"),h.attr("min",g.min),h.attr("max",g.max)}}o(a),n(a);break}}a.find(".color-mode-select").val(c.colorMode?c.colorMode.type.key:IFColor.Type.RGB.key)}function n(a){for(var b=a.data("gcolorpanel"),c=[],d=0;d<b.colorMode.components.length;++d){var e=b.colorMode.components[d],f=a.find(".color-component-"+d.toString()),g=f.find('input[type="text"]'),h=f.find('input[type="range"]'),i=parseInt(g.val());isNaN(i)||i<e.min?i=e.min:i>e.max&&(i=e.max),c.push(i),g.val(i),h.val(i)}var j=b.colorMode.makeColor(c);return p(a,j),j}function o(a){var b=a.data("gcolorpanel"),c=b.color?b.color:IFColor.WHITE,d=null;if(b.colorMode.type===IFColor.Type.RGB)d=c.asRGB();else if(b.colorMode.type===IFColor.Type.HSL)d=c.asHSL();else if(b.colorMode.type===IFColor.Type.Tone)d=c.asTone();else{if(b.colorMode.type!==IFColor.Type.CMYK)throw new Error("Unknown mode.");d=c.asCMYK()}if(d)for(var e=0;e<b.colorMode.components.length;++e){var f=b.colorMode.components[e],g=a.find(".color-component-"+e.toString()),h=g.find('input[type="text"]'),i=g.find('input[type="range"]'),j=Math.min(f.max,Math.max(f.min,d[e])).toFixed(0),k=b.colorMode.components[e].stops,l=k?k(d):null;if(l)if(1===l.length)i.css("background",l[0].asCSSString());else{for(var m="",n=0;n<l.length;++n)""!==m&&(m+=","),m+=l[n].asCSSString();i.css("background","linear-gradient(90deg, "+m+")")}else i.css("background","");h.val(j),i.val(j)}}function p(a,b,c){var d=a.data("gcolorpanel");b="string"==typeof b?IFColor.parseColor(b):b,d.color=b,c&&(d.previousColor=b),a.find('input[type="color"]').val(b?b.asHTMLHexString():""),a.find(".previous-color").css("background",IFPattern.asCSSBackground(d.previousColor)),a.find(".current-color").css("background",IFPattern.asCSSBackground(d.color)),a.find(".color-input").val(d.color?d.color.asHTMLHexString():"");var e="&ndash;";if(d.previousColor&&d.color){var f=d.color.difference(d.previousColor);e="&Delta;&nbsp;"+(0>f?ifUtil.formatNumber(f,2):f.toFixed(0))}a.find(".color-difference").html(e),m(a,b?b.getType().key:IFColor.Type.RGB.key),k(a),o(a),g(a)}var q={Palette:"palette",Swatches:"swatches",Trends:"trends",Image:"image"};ColorModes=[{type:IFColor.Type.RGB,name:"RGB",components:[{label:"R",min:0,max:255,unit:" ",stops:function(a){var b=a;return[new IFColor(IFColor.Type.RGB,[0,b[1],b[2],100]),new IFColor(IFColor.Type.RGB,[255,b[1],b[2],100])]}},{label:"G",min:0,max:255,unit:" ",stops:function(a){var b=a;return[new IFColor(IFColor.Type.RGB,[b[0],0,b[2],100]),new IFColor(IFColor.Type.RGB,[b[0],255,b[2],100])]}},{label:"B",min:0,max:255,unit:" ",stops:function(a){var b=a;return[new IFColor(IFColor.Type.RGB,[b[0],b[1],0,100]),new IFColor(IFColor.Type.RGB,[b[0],b[1],255,100])]}},{label:"A",min:0,max:100,unit:"%"}],makeColor:function(a){return new IFColor(IFColor.Type.RGB,a)}},{type:IFColor.Type.HSL,name:"HSL",components:[{label:"H",min:0,max:360,unit:"Â° ",stops:function(a){for(var b=a,c=[],d=60,e=0;360>=e;e+=d)c.push(new IFColor(IFColor.Type.HSL,[e,b[1],b[2],100]));return c}},{label:"S",min:0,max:100,unit:"%",stops:function(a){var b=a;return[new IFColor(IFColor.Type.HSL,[b[0],0,b[2],100]),new IFColor(IFColor.Type.HSL,[b[0],100,b[2],100])]}},{label:"L",min:0,max:100,unit:"%",stops:function(a){var b=a;return[new IFColor(IFColor.Type.HSL,[b[0],b[1],0,100]),new IFColor(IFColor.Type.HSL,[b[0],b[1],100,100])]}},{label:"A",min:0,max:100,unit:"%"}],makeColor:function(a){return new IFColor(IFColor.Type.HSL,a)}},{type:IFColor.Type.Tone,name:"Tone",components:[{label:"T",min:0,max:100,unit:"%",stops:function(){return[IFColor.parseCSSColor("white"),IFColor.parseCSSColor("black")]}},{label:"A",min:0,max:100,unit:"%"}],makeColor:function(a){return new IFColor(IFColor.Type.Tone,a)}},{type:IFColor.Type.CMYK,name:"CMYK",components:[{label:"C",min:0,max:100,unit:"%",stops:function(a){var b=a;return[new IFColor(IFColor.Type.CMYK,[0,b[1],b[2],b[3]]),new IFColor(IFColor.Type.CMYK,[100,b[1],b[2],b[3]])]}},{label:"M",min:0,max:100,unit:"%",stops:function(a){var b=a;return[new IFColor(IFColor.Type.CMYK,[b[0],0,b[2],b[3]]),new IFColor(IFColor.Type.CMYK,[b[0],100,b[2],b[3]])]}},{label:"Y",min:0,max:100,unit:"%",stops:function(a){var b=a;return[new IFColor(IFColor.Type.CMYK,[b[0],b[1],0,b[3]]),new IFColor(IFColor.Type.CMYK,[b[0],b[1],100,b[3]])]}},{label:"K",min:0,max:100,unit:"%",stops:function(a){var b=a;return[new IFColor(IFColor.Type.CMYK,[b[0],b[1],b[2],0]),new IFColor(IFColor.Type.CMYK,[b[0],b[1],b[2],100])]}}],makeColor:function(a){return new IFColor(IFColor.Type.CMYK,a)}}];var r=21,s=["000000","001F3F","DDDDDD","000000","003300","006600","009900","00CC00","00FF00","330000","333300","336600","339900","33CC00","33FF00","660000","663300","666600","669900","66CC00","66FF00","333333","0074D9","CCCCCC","000033","003333","006633","009933","00CC33","00FF33","330033","333333","336633","339933","33CC33","33FF33","660033","663333","666633","669933","66CC33","66FF33","666666","7FDBFF","BBBBBB","000066","003366","006666","009966","00CC66","00FF66","330066","333366","336666","339966","33CC66","33FF66","660066","663366","666666","669966","66CC66","66FF66","999999","39CCCC","AAAAAA","000099","003399","006699","009999","00CC99","00FF99","330099","333399","336699","339999","33CC99","33FF99","660099","663399","666699","669999","66CC99","66FF99","CCCCCC","3D9970","999999","0000CC","0033CC","0066CC","0099CC","00CCCC","00FFCC","3300CC","3333CC","3366CC","3399CC","33CCCC","33FFCC","6600CC","6633CC","6666CC","6699CC","66CCCC","66FFCC","FFFFFF","2ECC40","888888","0000FF","0033FF","0066FF","0099FF","00CCFF","00FFFF","3300FF","3333FF","3366FF","3399FF","33CCFF","33FFFF","6600FF","6633FF","6666FF","6699FF","66CCFF","66FFFF","FF0000","01FF70","777777","990000","993300","996600","999900","99CC00","99FF00","CC0000","CC3300","CC6600","CC9900","CCCC00","CCFF00","FF0000","FF3300","FF6600","FF9900","FFCC00","FFFF00","00FF00","FFDC00","666666","990033","993333","996633","999933","99CC33","99FF33","CC0033","CC3333","CC6633","CC9933","CCCC33","CCFF33","FF0033","FF3333","FF6633","FF9933","FFCC33","FFFF33","0000FF","FF851B","555555","990066","993366","996666","999966","99CC66","99FF66","CC0066","CC3366","CC6666","CC9966","CCCC66","CCFF66","FF0066","FF3366","FF6666","FF9966","FFCC66","FFFF66","FFFF00","FF4136","444444","990099","993399","996699","999999","99CC99","99FF99","CC0099","CC3399","CC6699","CC9999","CCCC99","CCFF99","FF0099","FF3399","FF6699","FF9999","FFCC99","FFFF99","00FFFF","85144B","333333","9900CC","9933CC","9966CC","9999CC","99CCCC","99FFCC","CC00CC","CC33CC","CC66CC","CC99CC","CCCCCC","CCFFCC","FF00CC","FF33CC","FF66CC","FF99CC","FFCCCC","FFFFCC","FF00FF","B10DC9","222222","9900FF","9933FF","9966FF","9999FF","99CCFF","99FFFF","CC00FF","CC33FF","CC66FF","CC99FF","CCCCFF","CCFFFF","FF00FF","FF33FF","FF66FF","FF99FF","FFCCFF","FFFFFF"],t={init:function(b){return b=a.extend({defaultView:q.Palette},b),this.each(function(){var c=this,d={options:b,allowClear:!1,scene:null},e=a(this).data("gcolorpanel",d);e.addClass("g-color-panel").append(a("<input>").attr("type","color").css({position:"absolute",visibility:"hidden"}).on("change",function(){var b=IFColor.parseCSSColor(a(this).val());p(e,b,!1),e.trigger("colorchange",b)})).append(a("<div></div>").addClass("toolbar").append(a("<div></div>").addClass("section-start").append(a("<button></button>").attr("data-action","clear").attr("title","Clear Color").css("display","none").append(a("<span></span>").addClass("fa fa-ban")).on("click",function(){p(e,null,!1),e.trigger("colorchange",null)})).append(a("<button></button>").attr("data-action","system-color").attr("title","System").append(a("<span></span>").addClass("fa fa-cog")).on("click",function(){e.find('input[type="color"]').trigger("click")}))).append(a("<div></div>").addClass("section-center").append(a("<button></button>").attr("data-activate-view",q.Palette).attr("title","Palette").append(a("<span></span>").addClass("fa fa-th"))).append(a("<button></button>").attr("data-activate-view",q.Swatches).attr("title","Swatches").css("display","none").append(a("<span></span>").addClass("fa fa-bars"))).append(a("<button></button>").attr("data-activate-view",q.Trends).attr("title","Trends").append(a("<span></span>").addClass("fa fa-sliders"))).append(a("<button></button>").attr("data-activate-view",q.Image).attr("title","From Image").append(a("<span></span>").addClass("fa fa-image")))).append(a("<div></div>").addClass("section-end").append(a("<select></select>").addClass("color-mode-select").on("change",function(){m(e,a(this).val())})))).append(a("<div></div>").addClass("color-view")).append(a("<div></div>").addClass("color-components")).append(a("<hr/>")).append(a("<div></div>").addClass("color").append(a("<div></div>").append(a("<div>&nbsp;</div>").addClass("previous-color g-input").on("click",function(){d.previousColor&&(p(e,d.previousColor,!1),e.trigger("colorchange",d.previousColor))})).append(a("<div>&nbsp;</div>").addClass("current-color g-input")).append(a("<div></div>").addClass("color-difference g-input").attr("title","Color Difference (CIEDE2000)")).append(a("<input>").addClass("color-input").on("change",function(){var b=IFColor.parseCSSColor(a(this).val());b&&(p(e,b,!1),e.trigger("colorchange",b))}))).append(a("<div></div>").append(a("<select></select>").addClass("matcher-select").on("change",function(){l(e,a(this).find(":selected").data("matcher"))})))).append(a("<div></div>").addClass("matcher-palette")),e.find("[data-activate-view]").each(function(b,d){var e=a(d);e.on("click",function(){t.view.call(c,e.attr("data-activate-view"))})});for(var f=e.find(".color-components"),g=function(b){a("<div></div>").addClass("color-component color-component-"+b.toString()).append(a("<div></div>").addClass("color-label").on("click",function(){var a=e.find(".color-component-"+b.toString()+' input[type="text"]');a.val(a.val()==d.colorMode.components[b].max?d.colorMode.components[b].min:d.colorMode.components[b].max);var c=n(e);e.trigger("colorchange",c)}.bind(this))).append(a("<div></div>").addClass("color-range").append(a("<input>").attr("type","range").attr("tabIndex","-1").on("input",function(c){e.find(".color-component-"+b.toString()+' input[type="text"]').val(a(c.target).val());var d=n(e);e.trigger("colorchange",d)}.bind(this)))).append(a("<div></div>").addClass("color-value").append(a("<input>").attr("type","text").on("input",function(){var a=n(e);e.trigger("colorchange",a)}))).append(a("<div></div>").addClass("color-unit")).appendTo(f)}.bind(this),h=0;4>h;++h)g(h);for(var i=e.find(".color-mode-select"),h=0;h<ColorModes.length;++h){var k=ColorModes[h];a("<option></option>").attr("value",k.type.key).text(k.name).appendTo(i),d.colorMode||m(e,k.type.key)}for(var o=e.find(".matcher-select"),r=o,s=null,h=0;h<gravit.colorMatchers.length;++h){var u=gravit.colorMatchers[h],v=ifLocale.get(u.getCategory());s&&v===s||(r=a("<optgroup></optgroup>").attr("label",v).appendTo(o),s=v),a("<option></option>").data("matcher",u).text(ifLocale.get(u.getTitle())).appendTo(r),d.matcher||l(e,u)}for(var w in q)q.hasOwnProperty(w)&&j(e,q[w]);t.view.call(c,b.defaultView)})},view:function(b){var c=a(this),d=c.data("gcolorpanel");return arguments.length?(b!==d.view&&(d.view=b,c.find("[data-activate-view]").each(function(c,d){var e=a(d);e.toggleClass("g-active",e.attr("data-activate-view")===b)}),c.find(".color-view > *").each(function(c,d){var e=a(d);e.css("display",e.attr("data-view")===b?"":"none")})),this):d.view},allowClear:function(b){var c=a(this);return arguments.length?(c.data("gcolorpanel").allowClear=b,c.find('[data-action="clear"]').css("display",b?"":"none"),this):c.data("gcolorpanel").allowClear},scene:function(b){var c=a(this),d=c.data("gcolorpanel");if(arguments.length){var e=d.scene;d.scene=b;var f=c.find('[data-view="'+q.Swatches+'"]');return e&&f.gSwatchPanel("detach"),d.scene&&f.gSwatchPanel("attach",d.scene.getSwatchCollection()),c.find('[data-activate-view="'+q.Swatches+'"]').css("display",d.scene?"":"none"),this}return d.scene},value:function(b){var c=a(this);if(arguments.length){var d=c.data("gcolorpanel");if(p(c,b,!0),d.scene&&(!d.color||d.color.getType()===IFColor.Type.Black||d.color.getType()===IFColor.Type.White||d.color.getType()===IFColor.Type.Registration)){var e=d.scene.getProperty("clspace");if(e)for(var f=0;f<ColorModes.length;++f)if(ColorModes[f].type.space===e){m(c,ColorModes[f].type.key);break}}return this}return c.data("gcolorpanel").color}};a.fn.gColorPanel=function(b){return t[b]?t[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):t.init.apply(this,arguments)}}(jQuery),function(a){var b=[{type:IFPathBase.CornerType.Rounded,name:"Rounded"},{type:IFPathBase.CornerType.InverseRounded,name:"Inverse Rounded"},{type:IFPathBase.CornerType.Bevel,name:"Beveled"},{type:IFPathBase.CornerType.Inset,name:"Inset"},{type:IFPathBase.CornerType.Fancy,name:"Fancy"}],c={init:function(c){return c=a.extend({},c),this.each(function(){var c=a(this);if(c.is("select")){var d=c,e=c.find(":last");e.is("optgroup")&&(d=e);for(var f=0;f<b.length;++f)d.append(a("<option></option>").attr("value",b[f].type).text(b[f].name))}})}};a.fn.gCornerType=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):c.init.apply(this,arguments)}}(jQuery),function(a){var b=[{type:IFPaintCanvas.BlendMode.Normal,name:"Normal"},{type:IFPaintCanvas.BlendMode.Multiply,name:"Multiply"},{type:IFPaintCanvas.BlendMode.Screen,name:"Screen"},{type:IFPaintCanvas.BlendMode.Overlay,name:"Overlay"},{type:IFPaintCanvas.BlendMode.Darken,name:"Darken"},{type:IFPaintCanvas.BlendMode.Lighten,name:"Lighten"},{type:IFPaintCanvas.BlendMode.ColorDoge,name:"Color Doge"},{type:IFPaintCanvas.BlendMode.ColorBurn,name:"Color Burn"},{type:IFPaintCanvas.BlendMode.HardLight,name:"Hard Light"},{type:IFPaintCanvas.BlendMode.SoftLight,name:"Soft Light"},{type:IFPaintCanvas.BlendMode.Difference,name:"Difference"},{type:IFPaintCanvas.BlendMode.Exclusion,name:"Exclusion"},{type:IFPaintCanvas.BlendMode.Hue,name:"Hue"},{type:IFPaintCanvas.BlendMode.Saturation,name:"Saturation"},{type:IFPaintCanvas.BlendMode.Color,name:"Color"},{type:IFPaintCanvas.BlendMode.Luminosity,name:"Luminosity"}],c={init:function(c){return c=a.extend({},c),this.each(function(){var c=a(this);if(c.is("select")){var d=c,e=c.find(":last");e.is("optgroup")&&(d=e);for(var f=0;f<b.length;++f)d.append(a("<option></option>").attr("value",b[f].type).text(b[f].name))}})}};a.fn.gBlendMode=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):c.init.apply(this,arguments)}}(jQuery),function(a){var b=[{unit:IFLength.Unit.PX,name:"Pixels"},{unit:IFLength.Unit.MM,name:"Millimeters"},{unit:IFLength.Unit.CM,name:"Centimeters"},{unit:IFLength.Unit.IN,name:"Inches"},{unit:IFLength.Unit.PC,name:"Picas"},{unit:IFLength.Unit.PT,name:"Points"}],c={init:function(c){return c=a.extend({},c),this.each(function(){var c=a(this);if(c.is("select"))for(var d=0;d<b.length;++d)c.append(a("<option></option>").attr("value",b[d].unit).text(b[d].name))})}};a.fn.gUnit=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):c.init.apply(this,arguments)}}(jQuery),function(a){function b(a,b){b.css("left",b.data("stop-position")+"%"),b.find(".stop-color").css("background",b.data("stop-color").asCSSString()),b.gColorButton("value",b.data("stop-color")),c(a)}function c(a){for(var b=a.gGradientEditor("value"),c=[],d=0;d<b.length;++d){var e=b[d];c.push(""+e.color.asCSSString()+" "+e.position+"%")}a.find(".gradient").css("background","linear-gradient(90deg, "+c.join(", ")+")"),a.gPatternTarget("value",new IFGradient(b))}var d={init:function(b){return b=a.extend({scene:null},b),this.each(function(){var c=this,e={options:b},f=a(this).addClass("g-gradient-editor").data("ggradienteditor",e).gPatternTarget({types:[IFPattern.Type.Color,IFPattern.Type.Gradient]}).on("patterndrop",function(b,e,g){if(e&&e instanceof IFColor){var h=a(this).find(".stops"),i=h.width(),j=g.pageX-h.offset().left,k=0>=j?0:j>=i?100:j/i*100;d.insertStop.call(c,k,e),f.trigger("change")}else e instanceof IFGradient&&(d.value.call(c,e.getStops()),f.trigger("change"))}),g=a("<div></div>").addClass("container").appendTo(f);g.append(a("<div></div>").addClass("editor").append(a("<div></div>").addClass("gradient g-input").css("background","transparent")).append(a("<div></div>").addClass("stops").on("mousedown",function(a){a.preventDefault(),a.stopPropagation()}).on("dblclick",function(b){var e=a(b.target);if(e.hasClass("stops")){var g=e.width(),h=b.pageX-e.offset().left,i=0>=h?0:h>=g?100:h/g*100,j=d.insertStop.call(c,i,IFColor.parseCSSColor("black"));f.trigger("change"),e.find("> .stop").each(function(b,c){var d=a(c);return d.data("stop-position")===j?(d.gColorButton("open"),!1):void 0})}})))})},value:function(c){var e=this,f=a(this),g=(f.data("ggradienteditor"),f.find(".stops > .stop"));if(arguments.length){if(c&&c.length===g.length)g.each(function(d,e){var g=a(e);g.data("stop-position",c[d].position).data("stop-color",c[d].color).data("stop-delete",!1),b(f,g)});else if(f.find(".stops").empty(),c)for(var h=0;h<c.length;++h)d.insertStop.call(e,c[h].position,c[h].color);return this}var i=[];return g.each(function(b,c){var d=a(c);d.data("stop-delete")===!1&&i.push({position:d.data("stop-position"),color:d.data("stop-color")})}),i.sort(function(a,b){return a.position>b.position}),i},insertStop:function(c,d){var e=a(this),f=e.data("ggradienteditor"),g=e.find(".stops");c=Math.round(c),c=0>c?0:c>100?100:c;var h=!1,i=a("<div></div>").addClass("stop").data("stop-position",c).data("stop-color",d).data("stop-delete",!1).gColorButton({drag:!1,"transient":!0,autoOpen:!1,scene:f.options.scene}).append(a("<div></div>").addClass("stop-color")).on("colorchange",function(a,c){c&&(i.data("stop-color",c),b(e,i),e.trigger("change"))}).on("click",function(){h||a(this).gColorButton("open")}).on("mousedown",function(c){h=!1;var d=g.offset(),f=d.left,j=f+g.width(),k=d.top+g.outerHeight(),l=i.outerWidth(),m=i.offset().left+l-c.pageX,n=i.offset().top-c.pageY,o=a(document),p=function(a){var c=a.pageX+m-l/2,d=a.pageY+n;f>=c?c=f:c>=j&&(c=j),d>k?i.css("display","none").data("stop-delete",!0):i.css("display","").data("stop-delete",!1);var g=c-f,o=j-f,p=0>=g?0:g>=o?100:g/o*100;i.data("stop-position",p),b(e,i),h=!0},q=function(){o.off("mousemove",p).off("mouseup",q);var a=!0;i.data("stop-delete")===!0&&(g.find("> .stop").length>2?(i.remove(),h=!0):(i.data("stop-delete",!1),h=!0,a=!1)),h&&a&&e.trigger("change")};o.on("mousemove",p).on("mouseup",q)}).appendTo(g);return b(e,i),c}};a.fn.gGradientEditor=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):d.init.apply(this,arguments)}}(jQuery),function(a){var b=[];document.addEventListener("keydown",function(a){b.length>0&&27===a.keyCode&&b[b.length-1].gOverlay("close")});var c={init:function(b){return b=a.extend({releaseOnClose:!1},b),this.each(function(){{var d=this,e=a(this).data("goverlay",{releaseOnClose:b.releaseOnClose}),f=a("<div></div>").addClass("g-modal-background").on("click",function(b){a(b.target).hasClass("g-modal-background")&&c.close.call(d)});a("<div></div>").addClass("g-overlay").css("position","absolute").append(e).appendTo(f)}})},open:function(c){{var d=a(this);d.data("goverlay")}d.parents(".g-modal-background").appendTo(a("body"));var e=a(window),f=e.width(),g=e.height(),h=d.parents(".g-overlay"),i=h.outerWidth(),j=h.outerHeight(),k=a(c),l=k.offset(),m=l.top,n=l.left,o=l.left+k.outerWidth(),p=l.top+ +k.outerHeight(),q=n,r=p;return q+i>f&&(q=o-i),q+i>f&&(q=f-i),r+j>g&&(r=m-j),r+j>g&&(r=g-j),0>r&&(r=0),0>q&&(q=0),h.css("left",q+"px").css("top",r+"px"),b.push(d),this},close:function(){var c=a(this),d=c.data("goverlay");return c.trigger("close"),d.releaseOnClose?c.parents(".g-modal-background").remove():c.parents(".g-modal-background").detach(),b.pop(),this}};a.fn.gOverlay=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):c.init.apply(this,arguments)}}(jQuery),function(a){var b={init:function(){return this.each(function(){var c=this,d=a(this).data("gpivot",{value:null}).addClass("g-pivot"),e=function(e){a("<div></div>").addClass("side").attr("data-side",e).on("click",function(){b.value.call(c,e),d.trigger("pivotchange",e)
}).appendTo(d)};a("<div></div>").addClass("borderline").appendTo(d);for(var f in IFRect.Side)if(IFRect.Side.hasOwnProperty(f)){var g=IFRect.Side[f];"string"==typeof g&&e(g)}})},value:function(b){var c=a(this),d=c.data("gpivot");return arguments.length?(d.value=b,c.find("div[data-side]").each(function(c,d){var e=a(d);e.toggleClass("g-active",e.attr("data-side")===b)}),this):d.value}};a.fn.gPivot=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.myPlugin"):b.init.apply(this,arguments)}}(jQuery),function(a){function b(b,c){b.find(".style-block").each(function(b,d){var e=a(d);e.toggleClass("selected",e.data("style")===c)})}function c(b){var c=b.data("gstylepanel");if(c.options.placeholder){var d=b.find(".placeholder"),e=b.find("> .style-block");0===e.length?0===d.length&&(d=a("<div></div>").addClass("placeholder").text(c.options.placeholder).appendTo(b)):d.length>0&&d.remove()}}function d(b){var c=a(this),d=c.data("gstylepanel").container;b.node instanceof IFStyle&&b.node.getParent()===d&&j.insertStyle.call(this,b.node)}function e(b){var c=a(this),d=c.data("gstylepanel").container;b.node instanceof IFStyle&&b.node.getParent()===d&&j.removeStyle.call(this,b.node)}function f(b){var c=a(this),d=c.data("gstylepanel").container;b.node.getParent()===d&&j.updateStyle.call(this,b.node)}function g(b){var c=a(this),d=c.data("gstylepanel").container;b.style.getParent()===d&&j.updateStyle.call(this,b.style)}function h(b,c){var d=b.data("gstylepanel");if(i){var e=a(c).data("style");if(e&&(e!==i||ifPlatform.modifiers.shiftKey))return i.getParent()===e.getParent()?d.options.allowReorder:d.options.allowDrop}return!1}var i=null,j={init:function(d){return d=a.extend({allowDrag:!0,allowDrop:!1,allowReorder:!0,allowNameEdit:!1,nullStyle:null,nullName:null,placeholder:null,previewWidth:30,previewHeight:30},d),this.each(function(){var e=a(this).addClass("g-style-panel").data("gstylepanel",{selected:null,options:d});d.nullStyle&&a("<div></div>").addClass("style-block style-null").data("style",null).attr("title",d.nullName?d.nullName:"").append(a("<div></div>").addClass("style-content").append(a("<div></div>").addClass("style-preview").append(a("<div></div>").css({display:"inline-block",width:d.previewWidth+"px",height:d.previewHeight+"px","line-height":d.previewHeight+"px"}).append(d.nullStyle))).append(a("<div></div>").addClass("style-name").text(d.nullName?d.nullName:""))).on("click",function(){e.data("gstylepanel").selected=null,b(e,null),e.trigger("stylechange",null)}).appendTo(e),c(e)})},insertStyle:function(d,e){var f=a(this),g=f.data("gstylepanel"),k=null;"number"==typeof e?(g.options.nullStyle&&(e+=1),k=f.children(".style-block").eq(e)):d.getNext()&&f.find(".style-block").each(function(b,c){var e=a(c);return e.data("style")===d.getNext()?(k=e,!1):void 0});var l=a("<div></div>").addClass("style-block").data("style",d).append(a("<div></div>").addClass("style-content").append(a("<div></div>").addClass("style-preview").append(a("<img>"))).append(a("<div></div>").addClass("style-name"))).on("mousedown",function(){f.data("gstylepanel").selected=d,b(f,d)}).on("click",function(){f.trigger("stylechange",d)});g.options.allowNameEdit&&d instanceof IFSharedStyle&&l.gAutoEdit({selector:".style-name"}).on("submitvalue",function(a,b){b&&""!==b.trim()&&IFEditor.tryRunTransaction(d,function(){d.setProperty("name",b)},"Rename Style")}),(g.options.allowDrag||g.options.allowReorder)&&l.attr("draggable","true").on("dragstart",function(b){var c=b.originalEvent;c.stopPropagation(),i=a(this).data("style"),g.options.allowDrag&&(f.trigger("styledragstart",d),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData(IFNode.MIME_TYPE,IFNode.serialize(d)),c.dataTransfer.setDragImage(l.find(".style-preview > img")[0],g.options.previewWidth/2,g.options.previewHeight/2))}).on("dragend",function(a){var b=a.originalEvent;if(b.stopPropagation(),i=null,g.options.allowDrag){var c=f.offset(),e=f.outerWidth(),h=f.outerHeight(),j=b.pageX,k=b.pageY;j<=c.left||j>=c.left+e||k<=c.top||k>=c.top+h?f.trigger("styledragaway",d):f.trigger("styledragend",d)}}),(g.options.allowDrop||g.options.allowReorder)&&l.on("dragenter",function(){h(f,this)&&a(this).addClass("drop")}).on("dragleave",function(){h(f,this)&&a(this).removeClass("drop")}).on("dragover",function(a){var b=a.originalEvent;h(f,this)&&(b.preventDefault(),b.stopPropagation(),b.dataTransfer.dropEffect="move")}).on("drop",function(){a(this).removeClass("drop");var b=a(this).data("style");if(g.options.allowReorder&&i){if(g.container&&i.getParent()===g.container){var c=i.getParent(),d=c.getIndexOfChild(i),e=c.getIndexOfChild(b);IFEditor.tryRunTransaction(c,function(){if(ifPlatform.modifiers.shiftKey){var a=i.clone();a.setProperty("name",a.getProperty("name")+"-copy"),c.insertChild(a,e>d?b.getNext():b)}else c.removeChild(i),c.insertChild(i,e>d?b.getNext():b)},ifPlatform.modifiers.shiftKey?"Duplicate Style":"Move Style")}f.trigger("stylemove",[i,b])}else g.options.allowDrop&&f.trigger("styledrop",[i,b])}),k&&k.length>0?l.insertBefore(k):l.appendTo(f),c(f),j.updateStyle.call(this,d)},updateStyle:function(b){var c=a(this),d=c.data("gstylepanel");c.find(".style-block").each(function(c,e){var f=a(e);if(f.data("style")===b){f.find(".style-preview > img").attr("src",b.createPreviewImage(d.options.previewWidth,d.options.previewHeight));var g="";return b instanceof IFSharedStyle&&(g=b.getProperty("name")),f.attr("title",g),f.find(".style-name").text(g),!1}})},removeStyle:function(b){var d=a(this),e=d.data("gstylepanel");d.find(".style-block").each(function(f,g){var h=a(g);return h.data("style")===b?(h.remove(),b===e.selected&&(e.selected=null,d.trigger("stylechange",null)),c(d),!1):void 0})},clear:function(){var b=a(this),d=(b.data("gstylepanel"),[]);b.find(".style-block").each(function(b,c){var e=a(c);e.hasClass("style-null")||d.push(e)});for(var e=0;e<d.length;++e)d[e].remove();c(b)},attach:function(b){var c=a(this),h=c.data("gstylepanel");if(j.detach.call(this),h.container=b,b){for(var i=b.getFirstChild();null!==i;i=i.getNext())i instanceof IFStyle&&j.insertStyle.call(this,i);var k=b.getScene();k&&(h.afterInsertHandler=d.bind(this),h.beforeRemoveHandler=e.bind(this),h.styleChangeHandler=g.bind(this),h.afterPropertiesChangeHandler=f.bind(this),k.addEventListener(IFNode.AfterInsertEvent,h.afterInsertHandler),k.addEventListener(IFNode.BeforeRemoveEvent,h.beforeRemoveHandler),k.addEventListener(IFNode.AfterPropertiesChangeEvent,h.afterPropertiesChangeHandler),k.addEventListener(IFStyle.StyleChangeEvent,h.styleChangeHandler))}return this},detach:function(){var b=a(this),c=b.data("gstylepanel"),d=c.container;if(d){var e=d.getScene();e&&(e.removeEventListener(IFNode.AfterInsertEvent,c.afterInsertHandler),e.removeEventListener(IFNode.BeforeRemoveEvent,c.beforeRemoveHandler),e.removeEventListener(IFNode.AfterPropertiesChangeEvent,c.afterPropertiesChangeHandler),e.removeEventListener(IFStyle.StyleChangeEvent,c.styleChangeHandler))}return c.container=null,c.afterInsertHandler=null,c.beforeRemoveHandler=null,c.afterPropertiesChangeHandler=null,c.styleChangeHandler=null,j.clear.call(this),this},value:function(c){var d=a(this);return arguments.length?(d.data("gstylepanel").selected=c,b(d,c),this):d.data("gstylepanel").selected}};a.fn.gStylePanel=function(b){return j[b]?j[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):j.init.apply(this,arguments)}}(jQuery),function(a){function b(b,c){b.data("gswatchpanel").options.allowSelect&&b.find(".swatch-block").each(function(b,d){var e=a(d);e.toggleClass("selected",e.data("swatch")===c)})}function c(b){var c=b.data("gswatchpanel");if(c.options.placeholder){var d=b.find(".placeholder"),e=b.find("> .swatch-block");0===e.length?0===d.length&&(d=a("<div></div>").addClass("placeholder").text(c.options.placeholder).appendTo(b)):d.length>0&&d.remove()}}function d(b){var c=a(this),d=c.data("gswatchpanel").container;b.node instanceof IFSwatch&&b.node.getParent()===d&&i.insertSwatch.call(this,b.node)}function e(b){var c=a(this),d=c.data("gswatchpanel").container;b.node instanceof IFSwatch&&b.node.getParent()===d&&i.removeSwatch.call(this,b.node)}function f(b){var c=a(this),d=c.data("gswatchpanel").container;b.node.getParent()===d&&i.updateSwatch.call(this,b.node)}function g(b,c){var d=b.data("gswatchpanel");if(h){var e=a(c).data("swatch");if(e&&e!==h)return h.getParent()===e.getParent()?d.options.allowReorder:d.options.allowDrop}return!1}var h=null,i={init:function(d){return d=a.extend({types:null,allowDrag:!0,allowDrop:!1,allowReorder:!0,allowSelect:!0,allowNameEdit:!1,nullSwatch:null,nullName:null,placeholder:null,previewWidth:20,previewHeight:20},d),this.each(function(){var e=a(this).addClass("g-swatch-panel").data("gswatchpanel",{selected:null,options:d}).on("dragover",function(a){var b=a.originalEvent;b.preventDefault(),b.stopPropagation(),b.dataTransfer.dropEffect="move"}).on("drop",function(a){var b=e.data("gswatchpanel"),c=a.originalEvent;if(c.stopPropagation(),h||!b.container||!b.container.getScene())return void(h=null);var d=b.container.getScene(),f=c.dataTransfer.getData(IFPattern.MIME_TYPE);if(f){var g=IFPattern.parsePattern(f);if(g){for(var i=d.getSwatchCollection(),j=i.getFirstChild();null!==j;j=j.getNext())if(j instanceof IFSwatch&&IFPattern.equals(g,j.getProperty("pat")))return;var k=g instanceof IFColor?g.asString():"pattern",l=prompt("Enter a name for the new swatch:",k);if(null===l)return;""===l.trim()&&(l=k),IFEditor.tryRunTransaction(d,function(){var a=new IFSwatch;a.setProperties(["name","pat"],[l,g]),i.appendChild(a)},"Add Swatch")}}});d.nullSwatch&&a("<div></div>").addClass("swatch-block swatch-null").data("swatch",null).attr("title",d.nullName?d.nullName:"").append(a("<div></div>").addClass("swatch-content").append(a("<div></div>").addClass("swatch-preview").append(a("<div></div>").css({width:d.previewWidth+"px",height:d.previewHeight+"px","line-height":d.previewHeight+"px"}).append(d.nullSwatch))).append(a("<div></div>").addClass("swatch-name").text(d.nullName?d.nullName:""))).on("click",function(){e.data("gswatchpanel").selected=null,b(e,null),e.trigger("swatchchange",null)}).appendTo(e),c(e)})},insertSwatch:function(d,e){var f=a(this),j=f.data("gswatchpanel"),k=j.options.types;if(!(null!==k&&k.length>0&&k.indexOf(d.getPatternType())<0)){var l=null;"number"==typeof e?(j.options.nullSwatch&&(e+=1),l=f.children(".swatch-block").eq(e)):d.getNext()&&f.find(".swatch-block").each(function(b,c){var e=a(c);return e.data("swatch")===d.getNext()?(l=e,!1):void 0});var m=a("<div></div>").addClass("swatch-block").data("swatch",d).append(a("<div></div>").addClass("swatch-content").append(a("<div></div>").addClass("swatch-preview").append(a("<div></div>").css({width:j.options.previewWidth+"px",height:j.options.previewHeight+"px"}))).append(a("<div></div>").addClass("swatch-name"))).on("mousedown",function(){f.data("gswatchpanel").selected=d,b(f,d)}).on("click",function(){f.trigger("swatchchange",d)});j.options.allowNameEdit&&m.gAutoEdit({selector:".swatch-name"}).on("submitvalue",function(a,b){b&&""!==b.trim()&&IFEditor.tryRunTransaction(d,function(){d.setProperty("name",b)},"Rename Swatch")}),(j.options.allowDrag||j.options.allowReorder)&&m.attr("draggable","true").on("dragstart",function(b){var c=b.originalEvent;c.stopPropagation(),h=a(this).data("swatch");var d=h.getProperty("pat");return d?void(j.options.allowDrag&&(f.trigger("swatchdragstart",h),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData(IFPattern.MIME_TYPE,IFPattern.asString(d)),c.dataTransfer.setDragImage(m.find(".swatch-preview > div")[0],j.options.previewWidth/2,j.options.previewHeight/2))):void c.preventDefault()}).on("dragend",function(a){var b=a.originalEvent;if(b.stopPropagation(),h=null,j.options.allowDrag){var c=f.offset(),e=f.outerWidth(),g=f.outerHeight(),i=b.pageX,k=b.pageY;i<=c.left||i>=c.left+e||k<=c.top||k>=c.top+g?f.trigger("swatchdragaway",d):f.trigger("swatchdragend",d)}}),(j.options.allowDrop||j.options.allowReorder)&&m.on("dragenter",function(){g(f,this)&&a(this).addClass("drop")}).on("dragleave",function(){g(f,this)&&a(this).removeClass("drop")}).on("dragover",function(a){var b=a.originalEvent;g(f,this)&&(b.preventDefault(),b.stopPropagation(),b.dataTransfer.dropEffect="move")}).on("drop",function(){a(this).removeClass("drop");var b=a(this).data("swatch");if(h)if(j.options.allowReorder){if(j.container&&h.getParent()===j.container){var c=h.getParent(),d=c.getIndexOfChild(h),e=c.getIndexOfChild(b);IFEditor.tryRunTransaction(c,function(){c.removeChild(h),c.insertChild(h,e>d?b.getNext():b)},"Move Swatch")}f.trigger("swatchmove",[h,b])}else j.options.allowDrop&&f.trigger("swatchdrop",[h,b])}),l&&l.length>0?m.insertBefore(l):m.appendTo(f),c(f),i.updateSwatch.call(this,d)}},updateSwatch:function(b){{var c=a(this);c.data("gswatchpanel")}c.find(".swatch-block").each(function(c,d){var e=a(d);if(e.data("swatch")===b){e.find(".swatch-preview > div").css("background",IFPattern.asCSSBackground(b.getProperty("pat")));var f=b.getProperty("name");return e.attr("title",f),e.find(".swatch-name").text(f),!1}})},removeSwatch:function(b){var d=a(this),e=d.data("gswatchpanel");d.find(".swatch-block").each(function(f,g){var h=a(g);return h.data("swatch")===b?(h.remove(),b===e.selected&&(e.selected=null,d.trigger("swatchchange",null)),c(d),!1):void 0})},clear:function(){var b=a(this),d=(b.data("gswatchpanel"),[]);b.find(".swatch-block").each(function(b,c){var e=a(c);e.hasClass("swatch-null")||d.push(e)});for(var e=0;e<d.length;++e)d[e].remove();c(b)},attach:function(b){var c=a(this),g=c.data("gswatchpanel");if(i.detach.call(this),g.container=b,b){for(var h=b.getFirstChild();null!==h;h=h.getNext())h instanceof IFSwatch&&i.insertSwatch.call(this,h);var j=b.getScene();j&&(g.afterInsertHandler=d.bind(this),g.beforeRemoveHandler=e.bind(this),g.afterPropertiesChangeHandler=f.bind(this),j.addEventListener(IFNode.AfterInsertEvent,g.afterInsertHandler),j.addEventListener(IFNode.BeforeRemoveEvent,g.beforeRemoveHandler),j.addEventListener(IFNode.AfterPropertiesChangeEvent,g.afterPropertiesChangeHandler))}return this},detach:function(){var b=a(this),c=b.data("gswatchpanel"),d=c.container;if(d){var e=d.getScene();e&&(e.removeEventListener(IFNode.AfterInsertEvent,c.afterInsertHandler),e.removeEventListener(IFNode.BeforeRemoveEvent,c.beforeRemoveHandler),e.removeEventListener(IFNode.AfterPropertiesChangeEvent,c.afterPropertiesChangeHandler))}return c.container=null,c.afterInsertHandler=null,c.beforeRemoveHandler=null,c.afterPropertiesChangeHandler=null,i.clear.call(this),this},value:function(c){var d=a(this);return arguments.length?(d.data("gswatchpanel").selected=c,b(d,c),this):d.data("gswatchpanel").selected}};a.fn.gSwatchPanel=function(b){return i[b]?i[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):i.init.apply(this,arguments)}}(jQuery),function(a){function b(a){this._parent=a,this._htmlElement=$("<ul></ul>").addClass("g-menu"),this._htmlElement.on("mouseover",this._mouseOver.bind(this)),this._htmlElement.on("mouseout",this._mouseOut.bind(this))}IFObject.inherit(b,GEventTarget),b.Position={Left_Top:0,Center:1,Right_Bottom:2},b._activeMenu=null,b._activeMenuMouseLocations=null,b.getActiveMenu=function(){return b._activeMenu},b.setActiveMenu=function(a,c){this._activeMenu&&(c||this._activeMenu.close(),this._activeMenu=null,document.removeEventListener("mousemove",b._activeMenuMouseMoveListener),document.removeEventListener("mousedown",b._activeMenuMouseUpDownListener),document.removeEventListener("mouseup",b._activeMenuMouseUpDownListener),document.removeEventListener("keyup",b._activeMenuKeyDownListener)),this._activeMenu=a,this._activeMenu&&(document.addEventListener("mousemove",b._activeMenuMouseMoveListener),document.addEventListener("mousedown",b._activeMenuMouseUpDownListener),setTimeout(function(){document.addEventListener("mouseup",b._activeMenuMouseUpDownListener)},250),document.addEventListener("keyup",b._activeMenuKeyDownListener))},b._activeMenuMouseMoveListener=function(a){b._activeMenuMouseLocations||(b._activeMenuMouseLocations=[]),b._activeMenuMouseLocations.push({x:a.pageX,y:a.pageY}),b._activeMenuMouseLocations.length>3&&b._activeMenuMouseLocations.shift()},b._activeMenuMouseUpDownListener=function(){b.setActiveMenu(null)},b._activeMenuKeyDownListener=function(a){27==a.keyCode&&b.setActiveMenu(null)},b.createActionMenu=function(a,b){for(var c=[],d=function(a){for(var b=0;b<c.length;++b)if(c[b].item===a)return c[b].group},e=function(a,b,e){if(a.getItemCount()>0){var f=d(a.getItem(a.getItemCount()-1));f!==e&&a.addItem(new GMenuItem(GMenuItem.Type.Divider))}c.push({item:b,group:e})},f=0;f<a.length;++f){var g=a[f];if(g.isAvailable()){var h=ifLocale.get(g.getCategory()),i=g.getGroup(),j=h?h.split("/"):null,k=i?[""].concat(i.split("/")):null;if(k&&j&&j.length!==k.length-1)throw new Error("Number of categories different thant number of groups.");var l=b;if(j)for(var m=0;m<j.length;++m){var h=j[m],i=k?k[m]:null,n=l.findItem(h);n||(n=new GMenuItem(GMenuItem.Type.Menu),n.setCaption(h),e(l,n,i),l.addItem(n)),l=n.getMenu()}var o=new GMenuItem;o.setAction(g),e(l,o,k?k[k.length-1]:null),l.addItem(o)}}},b.OpenEvent=function(){},IFObject.inherit(b.OpenEvent,GEvent),b.OpenEvent.prototype.toString=function(){return"[Object GMenu.OpenEvent]"},b.OPEN_EVENT=new b.OpenEvent,b.CloseEvent=function(){},IFObject.inherit(b.CloseEvent,GEvent),b.CloseEvent.prototype.toString=function(){return"[Object GMenu.CloseEvent]"},b.CLOSE_EVENT=new b.CloseEvent,b.prototype._parent=null,b.prototype._htmlElement=null,b.prototype._items=null,b.prototype._hovered=!1,b.prototype.getParent=function(){return this._parent},b.prototype.isHovered=function(a){if(this._hovered)return!0;if(a){for(var b=0;b<this.getItemCount();++b){var c=this.getItem(b);if(c instanceof GMenuItem&&c.getType()===GMenuItem.Type.Menu&&c.getMenu().isHovered(!0))return!0}return!1}return!1},b.prototype.isRootMenu=function(){return!(this._parent&&this._parent instanceof GMenuItem)},b.prototype.isSubMenu=function(){return this._parent&&this._parent instanceof GMenuItem?!this._parent.isRootItem():!1},b.prototype.createAddDivider=function(){return this.createInsertDivider(this.getItemCount())},b.prototype.createInsertDivider=function(a){var b=new GMenuItem(GMenuItem.Type.Divider);return this.insertItem(a,b),b},b.prototype.createAddItem=function(a,b,c,d){return this.createInsertItem(this.getItemCount(),a,b,c,d)},b.prototype.createInsertItem=function(a,b,c,d,e){var f=new GMenuItem;return f.setCaption(b),c&&f.addEventListener(GMenuItem.ActivateEvent,c),d&&f.addEventListener(GMenuItem.EnterEvent,d),e&&f.addEventListener(GMenuItem.LeaveEvent,e),this.insertItem(a,f),f},b.prototype.addItem=function(a){return this.insertItem(this.getItemCount(),a)},b.prototype.insertItem=function(a,b){null==this._items&&(this._items=[]),a+1<this._items.length?(this._items.splice(a,0,b),this._items[a+1]._htmlElement.before(b._htmlElement)):(this._items.push(b),this._htmlElement.append(b._htmlElement)),b._parent=this},b.prototype.removeItem=function(a){a>=0&&a<this.getItemCount()&&(this._items[a]._parent=null,this._items[a]._htmlElement.detach(),this._items.splice(a,1))},b.prototype.clearItems=function(){if(this._items){for(var a=0;a<this._items.length;++a)this._items[a]._parent=null,this._items[a]._htmlElement.detach();this._items=[]}},b.prototype.getItem=function(a){return a>=0&&a<this.getItemCount()?this._items[a]:null},b.prototype.getItemCount=function(){return this._items?this._items.length:0},b.prototype.indexOf=function(a){return this._items?this._items.indexOf(a):-1},b.prototype.findItem=function(a){for(var b=0;b<this.getItemCount();++b){var c=this.getItem(b);if(a==c.getCaption())return c}return null},b.prototype.update=function(){for(var a=0;a<this.getItemCount();++a){var b=this.getItem(a);b.update()}},b.prototype.isOpen=function(){return!!this._htmlElement.parent().length},b.prototype.open=function(a,c,d){if(c="number"==typeof c?c:b.Position.Center,d="number"==typeof d?d:b.Position.Center,this.isOpen()||(this.update(),this._htmlElement.appendTo($("body")),this.isSubMenu()||b.setActiveMenu(this),this.trigger(b.OPEN_EVENT)),this._htmlElement.parent().is("body")){var e=this._htmlElement.outerWidth(),f=this._htmlElement.outerHeight(),g=$(window).width(),h=$(window).height(),i={x:0,y:0,width:0,height:0};if("number"==typeof a.x&&"number"==typeof a.y)i.x=a.x,i.y=a.y;else{var j=a.offset();i.x=j.left,i.y=j.top,i.width=a.outerWidth(),i.height=a.outerHeight()}var k=0;switch(c){case b.Position.Left_Top:k=i.x-e;break;case b.Position.Center:k=i.x;break;case b.Position.Right_Bottom:k=i.x+i.width}var l=0;switch(d){case b.Position.Left_Top:l=i.y-f;break;case b.Position.Center:l=i.y;break;case b.Position.Right_Bottom:l=i.y+i.height}switch(0>k&&(k=0),k+e>=g&&(k=g-e),0>l&&(l=0),l+f>=h&&(l=h-f),this._htmlElement.css("left",k),this._htmlElement.css("top",l),c){case b.Position.Left_Top:this._htmlElement.addClass("g-menu-left");break;case b.Position.Right_Bottom:this._htmlElement.addClass("g-menu-right")}switch(d){case b.Position.Left_Top:this._htmlElement.addClass("g-menu-top");break;case b.Position.Right_Bottom:this._htmlElement.addClass("g-menu-bottom")}}},b.prototype.close=function(){this.isOpen()&&this._htmlElement.parent().is("body")&&(this.closeMenus(),this._htmlElement.removeClass("g-menu-left g-menu-right g-menu-top g-menu-bottom"),this._htmlElement.detach(),this===b._activeMenu&&b.setActiveMenu(null,!0),this.trigger(b.CLOSE_EVENT))},b.prototype.closeMenus=function(){for(var a=0;a<this.getItemCount();++a){var b=this.getItem(a);b instanceof GMenuItem&&b.getType()===GMenuItem.Type.Menu&&b.getMenu().close()}},b.prototype._mouseOver=function(){this._hovered=!0},b.prototype._mouseOut=function(){this._hovered=!1,this.isSubMenu()&&setTimeout(function(){this.isHovered(!0)||this.closeMenus()}.bind(this),150)},a.GMenu=b}(this),function(a){function b(a){this._menu=a?a:new GMenu(this),this._menu._parent=this,this._menu._htmlElement.addClass("g-menu-root"),this._htmlElement=$("<nav></nav>").addClass("g-menu-bar").append(this._menu._htmlElement)}b.prototype._menu=null,b.prototype.getMenu=function(){return this._menu},b.prototype.isActive=function(){var a=GMenu.getActiveMenu();return a&&a._parent&&a._parent instanceof GMenuItem?a._parent.getMenuBar()===this:!1},b.prototype.toString=function(){return"[Object GMenuBar]"},a.GMenuBar=b}(this),function(a){function b(a){this._htmlElement=$("<li></li>").addClass("g-menu-item"),this._type=a?a:b.Type.Item,this._type===b.Type.Divider?this._htmlElement.addClass("g-menu-item-divider"):(this._htmlElement.append($("<span></span>").addClass("g-menu-item-icon").css("display","none")).append($("<span></span>").addClass("g-menu-item-caption")).append($("<span></span>").addClass("g-menu-item-shortcut").css("display","none")).append($("<span></span>").addClass("g-menu-item-tail")),this._type===b.Type.Menu&&(this._htmlElement.addClass("g-menu-item-menu"),this.setMenu(new GMenu(this)))),this._htmlElement.on("mouseover",this._mouseOver.bind(this)),this._htmlElement.on("mouseout",this._mouseOut.bind(this)),this._htmlElement.on("mousedown",this._mouseDown.bind(this)),this._htmlElement.on("mouseup",this._mouseUp.bind(this))}IFObject.inherit(b,GEventTarget),b.Type={Item:0,Menu:1,Divider:2},b.EnterEvent=function(){},IFObject.inherit(b.EnterEvent,GEvent),b.EnterEvent.prototype.toString=function(){return"[Object GMenuItem.EnterEvent]"},b.ENTER_EVENT=new b.EnterEvent,b.LeaveEvent=function(){},IFObject.inherit(b.LeaveEvent,GEvent),b.LeaveEvent.prototype.toString=function(){return"[Object GMenuItem.LeaveEvent]"},b.LEAVE_EVENT=new b.LeaveEvent,b.ActivateEvent=function(){},IFObject.inherit(b.ActivateEvent,GEvent),b.ActivateEvent.prototype.toString=function(){return"[Object GMenuItem.ActivateEvent]"},b.ACTIVATE_EVENT=new b.ActivateEvent,b.UpdateEvent=function(){},IFObject.inherit(b.UpdateEvent,GEvent),b.UpdateEvent.prototype.toString=function(){return"[Object GMenuItem.UpdateEvent]"},b.UPDATE_EVENT=new b.UpdateEvent,b.prototype._parent=null,b.prototype._type=null,b.prototype._menu=null,b.prototype._icon=null,b.prototype._caption=null,b.prototype._shortcutHint=null,b.prototype._action=null,b.prototype.getParent=function(){return this._parent},b.prototype.getType=function(){return this._type},b.prototype.getIcon=function(){return this._icon},b.prototype.setIcon=function(a){if(a!==this._icon){this._icon=a;var b=this._htmlElement.find(".g-menu-item-icon");b.empty(),this._icon?(b.append("string"==typeof this._icon?$("<i></i>").addClass(a):this._icon),b.css("display","")):b.css("display","none")}},b.prototype.getCaption=function(){return this._caption},b.prototype.setCaption=function(a){if(a!==this._caption){this._caption=a;var b=this._htmlElement.find(".g-menu-item-caption");b.empty(),!this._caption||this._caption instanceof IFLocale.Key||"string"==typeof this._caption?b.text(this._caption?ifLocale.get(this._caption):""):b.append(this._caption)}},b.prototype.getShortcutHint=function(){return this._shortcutHint},b.prototype.setShortcutHint=function(a){this._shortcutHint=a;var b=this._htmlElement.find(".g-menu-item-shortcut");this._shortcutHint&&this._shortcutHint.length>0?(b.text(ifKey.shortcutToString(a)),b.css("display","")):(b.empty(),b.css("display","none"))},b.prototype.getAction=function(){return this._action},b.prototype.setAction=function(a){if(a!==this._action){if(this._action){var b=a.getShortcut();b&&b===this.getShortcutHint()&&this.setShortcutHint(null)}if(this._action=a,this._action){var b=a.getShortcut();b&&this.setShortcutHint(b),this.setCaption(this._action.getTitle()),this.setEnabled(this._action.isEnabled()===!0)}}},b.prototype.isChecked=function(){return this._htmlElement.hasClass("g-menu-item-checked")},b.prototype.setChecked=function(a){a!=this.isChecked()&&(a?this._htmlElement.addClass("g-menu-item-checked"):this._htmlElement.removeClass("g-menu-item-checked"))},b.prototype.isEnabled=function(){return!this._htmlElement.hasClass("g-disabled")},b.prototype.setEnabled=function(a){a!=this.isEnabled()&&(a?this._htmlElement.removeClass("g-disabled"):this._htmlElement.addClass("g-disabled"))},b.prototype.isRootItem=function(){return this._parent&&this._parent instanceof GMenu&&null!=this._parent._parent&&!(this._parent._parent instanceof b)},b.prototype.isRootMenuBarItem=function(){return this.isRootItem()&&this._parent._parent instanceof GMenuBar},b.prototype.getMenuBar=function(){return this.isRootMenuBarItem()?this._parent._parent:null},b.prototype.getMenu=function(){return this._menu},b.prototype.setMenu=function(a){a&&a!==this._menu&&this._type===b.Type.Menu&&(this._menu=a,this._menu._parent=this,this._menu.addEventListener(GMenu.OPEN_EVENT,this._menuOpen.bind(this)),this._menu.addEventListener(GMenu.CLOSE_EVENT,this._menuClose.bind(this)))},b.prototype.update=function(){this._action&&(this.setCaption(this._action.getTitle()),this.setEnabled(this._action.isEnabled()),this.setChecked(this._action.isChecked())),this.hasEventListeners(b.UpdateEvent)&&this.trigger(b.UPDATE_EVENT)},b.prototype.toString=function(){return"[Object GMenuItem]"},b.prototype._mouseOver=function(){this._parent&&this._parent instanceof GMenu&&!this.isRootItem()&&this._parent.closeMenus(),this.isEnabled()&&(this._type==b.Type.Menu&&ifSystem.hardware===IFSystem.Hardware.Desktop&&(!this.isRootItem()||this.isRootMenuBarItem()&&this.getMenuBar().isActive())&&this._openMenu(),this._type!=b.Type.Divider&&(this._htmlElement.addClass("g-hover"),this.hasEventListeners(b.EnterEvent)&&this.trigger(b.ENTER_EVENT)))},b.prototype._mouseOut=function(){this.isEnabled()&&this._type!=b.Type.Divider&&(this._htmlElement.removeClass("g-hover"),this.hasEventListeners(b.LeaveEvent)&&this.trigger(b.LEAVE_EVENT))},b.prototype._mouseDown=function(a){this.isEnabled()&&a.button==GUIMouseEvent.BUTTON_LEFT&&(a.stopPropagation(),a.preventDefault(),this._type!==b.Type.Menu||!this.isRootItem()&&ifSystem.hardware===IFSystem.Hardware.Desktop||(this._htmlElement.hasClass("g-active")?this.getMenu().close():this._openMenu()))},b.prototype._mouseUp=function(a){a.stopPropagation(),a.preventDefault(),this.isRootMenuBarItem()||(this._mouseOut(a),GMenu.setActiveMenu(null)),this._type==b.Type.Item&&(this._action&&this._action.isAvailable()&&this._action.isEnabled()&&this._action.execute(),this.isEnabled()&&this.hasEventListeners(b.ActivateEvent)&&this.trigger(b.ACTIVATE_EVENT))},b.prototype._openMenu=function(){this.getMenu().open(this._htmlElement,this.isRootItem()?GMenu.Position.Center:GMenu.Position.Right_Bottom,this.isRootItem()?GMenu.Position.Right_Bottom:GMenu.Position.Center)},b.prototype._menuOpen=function(){this._htmlElement.addClass("g-active"),this.isRootItem()&&this._parent._parent._htmlElement.addClass("g-active")},b.prototype._menuClose=function(){this._htmlElement.removeClass("g-active"),this.isRootItem()&&this._parent._parent._htmlElement.removeClass("g-active")},a.GMenuItem=b}(this),function(a){var b={margin:"0px 1px",transform:"rotate(-45deg)",position:"absolute",bottom:"3px","font-size":"10px"},c={"margin-left":"3px"},d={init:function(e){return e=a.extend({menu:null,defaultAction:null,arrow:!0},e),this.each(function(){var f=this,g=null,h=a(this).data("gmenubutton",{options:e}).on("mousedown",function(a){a.stopPropagation(),e.defaultAction?g=setTimeout(function(){d.open.call(f),g=null}.bind(this),250):d.open.call(f)}).on("mouseup",function(a){a.stopPropagation(),null!==g&&(clearTimeout(g),g=null),!e.menu.isOpen()&&e.defaultAction&&e.defaultAction()});e.arrow&&h.append(a("<span></span>").addClass("fa fa-caret-down").css(e.defaultAction?b:c))})},open:function(){var b=a(this),c=b.data("gmenubutton").options.menu;c.isOpen()||c.open(b,GMenu.Position.Center,GMenu.Position.Right_Bottom)},close:function(){var a=$this.data("gmenubutton").options.menu;a.isOpen()&&a.close()}};a.fn.gMenuButton=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.myPlugin"):d.init.apply(this,arguments)}}(jQuery),function(a){function b(){}IFObject.inherit(b,IFObject),b.prototype.getId=function(){throw new Error("Not Supported")},b.prototype.getTitle=function(){throw new Error("Not Supported")},b.prototype.getCategory=function(){return null},b.prototype.getGroup=function(){return null},b.prototype.getShortcut=function(){return null},b.prototype.isEnabled=function(){return!0},b.prototype.isCheckable=function(){return!1},b.prototype.isChecked=function(){return!1},b.prototype.isAvailable=function(){return!0},b.prototype.execute=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[Object GAction]"},a.GAction=b}(this),function(a){function b(){}b.CATEGORY_HARMONY=new IFLocale.Key(b,"category.harmony"),b.CATEGORY_PALETTE=new IFLocale.Key(b,"category.palette"),b.prototype.getTitle=function(){throw new Error("Not Supported")},b.prototype.getCategory=function(){return null},b.prototype.match=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[Object GColorMatcher]"},a.GColorMatcher=b}(this),function(a){function b(){}b.parseSize=function(a){var b=a.split("@"),c=function(a){if("?"===a)return null;var b=ifUtil.parseNumber(a);if("number"!=typeof b)return null;var c=a.substr(b.toString().length);return c&&c.length>0&&(c=c.trim().toLowerCase(),"x"===c)?b:IFLength.parseLength(a)};return{width:c(b[0]),height:b.length>1?c(b[1]):null}},b.prototype.isStandalone=function(){throw new Error("Not Supported.")},b.prototype.getName=function(){throw new Error("Not Supported.")},b.prototype.getExtensions=function(){throw new Error("Not Supported.")},b.prototype.exportPart=function(){throw new Error("Not Supported.")},a.GExporter=b}(this),function(a){function b(){}b.prototype.init=function(){},a.GModule=b
}(this),function(a){function b(){}IFObject.inherit(b,GEventTarget),b.UpdateEvent=function(){},IFObject.inherit(b.UpdateEvent,GEvent),b.UpdateEvent.prototype.toString=function(){return"[Object GView.UpdateEvent]"},b.UPDATE_EVENT=new b.UpdateEvent,b.DocumentState=function(a){this.document=a},b.DocumentState.prototype.document=null,b.DocumentState.prototype.activate=function(){},b.DocumentState.prototype.deactivate=function(){},b.DocumentState.prototype.init=function(){},b.DocumentState.prototype.release=function(){},b.prototype._documentStates=null,b.prototype.getId=function(){throw new Error("Not Supported")},b.prototype.getTitle=function(){throw new Error("Not Supported")},b.prototype._createDocumentState=function(){return null},b.prototype._activateDocumentState=function(){},b.prototype._deactivateDocumentState=function(){},b.prototype._documentEvent=function(a){switch(a.type){case GApplication.DocumentEvent.Type.Added:var c=this._createDocumentState(a.document);c&&(c.init(),this._documentStates||(this._documentStates=[]),this._documentStates.push(c),this.trigger(b.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Removed:var c=this._findDocumentState(a.document);c&&(c.release(),this._documentStates.splice(this._documentStates.indexOf(c),1),0===this._documentStates.length&&(this._documentStates=null),this.trigger(b.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Activated:var c=this._findDocumentState(a.document);c&&(c.activate(),this._activateDocumentState(c),this.trigger(b.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Deactivated:var c=this._findDocumentState(a.document);c&&(c.deactivate(),this._deactivateDocumentState(c),this.trigger(b.UPDATE_EVENT))}},b.prototype._findDocumentState=function(a){if(!this._documentStates)return null;for(var b=0;b<this._documentStates.length;++b)if(this._documentStates[b].document===a)return this._documentStates[b]},b.prototype.toString=function(){return"[Object GView]"},a.GView=b}(this),function(a){function b(){GView.call(this)}IFObject.inherit(b,GView),b.prototype.getGroup=function(){return null},b.prototype.isEnabled=function(){return!0},b.prototype.init=function(){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},b.prototype.toString=function(){return"[Object GPalette]"},a.GPalette=b}(this),function(a){function b(){GView.call(this)}IFObject.inherit(b,GView),b.prototype.getIcon=function(){return null},b.prototype.init=function(){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},b.prototype.activate=function(){},b.prototype.deactivate=function(){},b.prototype.toString=function(){return"[Object GSidebar]"},a.GSidebar=b}(this),function(a){function b(){}b.prototype.getCategory=function(){throw new Error("Not Supported.")},b.prototype.init=function(){throw new Error("Not Supported.")},b.prototype.update=function(){throw new Error("Not Supported.")},b.prototype.toString=function(){return"[Object GProperties]"},a.GProperties=b}(this),function(a){function b(){}b.prototype.isAvailable=function(){throw new Error("Not supported.")},b.prototype.isSaving=function(){throw new Error("Not supported.")},b.prototype.isPrompting=function(){throw new Error("Not supported.")},b.prototype.isDirectory=function(){throw new Error("Not supported.")},b.prototype.getProtocol=function(){throw new Error("Not supported.")},b.prototype.getExtensions=function(){throw new Error("Not Supported.")},b.prototype.getName=function(){throw new Error("Not supported.")},b.prototype.openResourcePrompt=function(){throw new Error("Not supported.")},b.prototype.saveResourcePrompt=function(){throw new Error("Not supported.")},b.prototype.openDirectoryPrompt=function(){throw new Error("Not supported.")},b.prototype.saveDirectoryPrompt=function(){throw new Error("Not supported.")},b.prototype.load=function(){throw new Error("Not Supported.")},b.prototype.save=function(){throw new Error("Not Supported.")},b.prototype.releaseUrl=function(){},b.prototype.resolveUrl=function(){throw new Error("Not Supported.")},a.GStorage=b}(this),function(a){function b(){}b.prototype.getEntryClass=function(){throw new Error("Not Supported.")},b.prototype.getEntryName=function(){throw new Error("Not Supported.")},b.prototype.createContent=function(){throw new Error("Not Supported.")},b.prototype.updateProperties=function(){throw new Error("Not Supported.")},b.prototype.assignProperties=function(){throw new Error("Not Supported.")},b.prototype.toString=function(){return"[Object GStyleEntry]"},a.GStyleEntry=b}(this),function(a){function b(){}b.prototype.getCategory=function(){throw new Error("Not Supported.")},b.prototype.init=function(){throw new Error("Not Supported.")},b.prototype.update=function(){throw new Error("Not Supported.")},b.prototype.toString=function(){return"[Object GTransformer]"},a.GTransformer=b}(this),function(a){function b(a){this._htmlElement=a}b.prototype._htmlElement=null,b.prototype.init=function(){},b.prototype.relayout=function(){},a.GHeader=b}(this),function(a){function b(a){this._htmlElement=a,this._palettesInfo=[],this._groupsInfo=[]}b.prototype._htmlElement=null,b.prototype._palettesInfo=null,b.prototype._groupsInfo=null,b.prototype.groupPalettes=function(a){for(var b=0;b<a.length;++b)this._detachPaletteFromGroup(a[b].getId());for(var c=this._addGroupInfo(),b=0;b<a.length;++b)this._attachPaletteToGroup(c,a[b].getId())},b.prototype.isPaletteActive=function(a){var b=this._getGroupInfoForPalette(a);return b?b.activePalette===a&&b.visible&&b.expanded:!1},b.prototype.setPaletteActive=function(a,b){var c=this._getGroupInfoForPalette(a);if(!(!c||c.activePalette===a&&b&&c.visible&&c.expanded))if(b){var d=this._getPaletteInfo(a);c.activePalette=a,c.container.find(".palette-group-tabs > button").each(function(){var b=$(this);b.attr("data-palette-id")===a?b.addClass("g-active"):b.removeClass("g-active")}),c.container.find(".palette-group-panels > div").each(function(){var b=$(this);b.attr("data-palette-id")===a?b.css("display",""):b.css("display","none")});var e=c.container.find(".palette-group-controls");e.children().detach(),e.append(d.controls),this._setGroupVisible(c,!0),this._setGroupExpanded(c,!0)}else this._setGroupVisible(c,!1)},b.prototype.isPaletteEnabled=function(a){var b=this._getPaletteInfo(a);return b?0==b.panel.find(".panel-disabled-overlay").length:!1},b.prototype.setPaletteEnabled=function(a,b){var c=this._getPaletteInfo(a);if(c){var d=c.panel.find(".panel-disabled-overlay");b&&d.length>0?d.remove():b||0!==d.length||(d=$("<div></div>").addClass("panel-disabled-overlay").appendTo(c.panel))}},b.prototype.init=function(){for(var a=[],b=null,c=null,d=0;d<gravit.palettes.length;++d){var e=gravit.palettes[d];this._addPaletteInfo(e);var f=e.getGroup();f||(f=e.getId()),b&&b===f||(c&&a.push(c),c=[],b=f),c.push(e)}c&&a.push(c);for(var d=0;d<a.length;++d){this.groupPalettes(a[d]),this.setPaletteActive(a[d][0].getId(),!0);for(var g=0;g<a[d].length;++g){var e=a[d][g];this.setPaletteEnabled(e.getId(),e.isEnabled())}}},b.prototype.relayout=function(){},b.prototype._addPaletteInfo=function(a){var b=$("<div></div>").attr("data-palette-id",a.getId()).addClass("palette-panel").addClass("palette-"+a.getId()).css("display","none"),c=$("<div></div>");a.init(b,c);var d={palette:a,panel:b,controls:c};return this._palettesInfo.push(d),a.addEventListener(GView.UpdateEvent,function(){this.setPaletteEnabled(a.getId(),a.isEnabled())}.bind(this)),d},b.prototype._getPaletteInfo=function(a){for(var b=0;b<this._palettesInfo.length;++b)if(this._palettesInfo[b].palette.getId()===a)return this._palettesInfo[b];return null},b.prototype._detachPaletteFromGroup=function(a){var b=this._getGroupInfoForPalette(a),c=this._getPaletteInfo(a);b&&c&&(b.container.find('.palette-group-tabs > button[data-palette-id="'+a+'"]').remove(),b.container.find('.palette-group-panels > div[data-palette-id="'+a+'"]').detach(),b.palettes.slice(b.palettes.indexOf(a)))},b.prototype._attachPaletteToGroup=function(a,b){var c=this._getPaletteInfo(b);if(c){var d=a.container.find(".palette-group-tabs"),e=a.container.find(".palette-group-panels");d.append($("<button></button>").attr("data-palette-id",c.palette.getId()).text(ifLocale.get(c.palette.getTitle())).on("click",function(){this.isPaletteActive(c.palette.getId())?this._setGroupExpanded(a,!a.expanded):this.setPaletteActive(c.palette.getId(),!0)}.bind(this))),e.append(c.panel),a.palettes.push(b)}},b.prototype._addGroupInfo=function(){var a={expanded:!0,visible:!0,activePalette:null,palettes:[]};return a.container=$("<div></div>").addClass("palette-group").append($("<div></div>").addClass("palette-group-header").append($("<div></div>").addClass("palette-group-collapse").append($("<button></button>").append($("<span></span>").addClass("fa fa-angle-double-down fa-fw")).on("click",function(){this._setGroupExpanded(a,!a.expanded)}.bind(this)))).append($("<div></div>").addClass("palette-group-tabs")).append($("<div></div>").addClass("palette-group-controls"))).append($("<div></div>").addClass("palette-group-panels")).appendTo(this._htmlElement),this._groupsInfo.push(a),a},b.prototype._getGroupInfoForPalette=function(a){for(var b=0;b<this._groupsInfo.length;++b)if(this._groupsInfo[b].palettes.indexOf(a)>=0)return this._groupsInfo[b];return null},b.prototype._setGroupExpanded=function(a,b){if(b!==a.expanded){a.expanded=b;var c=a.container.find(".palette-group-collapse > button > span");if(a.expanded)a.container.css("height",""),a.container.removeClass("collapsed-palette"),c.attr("class","fa  fa-angle-double-down fa-fw");else{var d=a.container.find(".palette-group-header");a.container.height(d.outerHeight()),a.container.addClass("collapsed-palette"),c.attr("class","fa  fa-angle-double-right fa-fw")}}},b.prototype._setGroupVisible=function(a,b){b!==a.visible&&(a.visible=b,a.visible?a.container.css("display",""):a.container.css("display","none"))},a.GPalettes=b}(this),function(a){function b(a){this._htmlElement=a}b.prototype._htmlElement=null,b.prototype._sidebars=null,b.prototype._activeSidebar=null,b.prototype.getActiveSidebar=function(){return this._activeSidebar},b.prototype.setActiveSidebar=function(a){if(a!==this._activeSidebar)for(var b=0;b<this._sidebars.length;++b){var c=this._sidebars[b],d=c.sidebar.getId();d===a?(c.panel.css("display",""),c.sidebar.activate()):(c.panel.css("display","none"),d===this._activeSidebar&&c.sidebar.deactivate())}},b.prototype.init=function(){if(this._sidebars=[],gravit.sidebars)for(var a=0;a<gravit.sidebars.length;++a){var b=gravit.sidebars[a],c=$("<div></div>").addClass("sidebar-panel sidebar-"+b.getId()).css("display","none").appendTo(this._htmlElement);b.init(c),this._sidebars.push({panel:c,sidebar:b})}},b.prototype.relayout=function(){},a.GSidebars=b}(this),function(a){function b(a){this._htmlElement=a,a.append($("<div></div>").addClass("section sidebars")).append($("<div></div>").addClass("section toolpanel"))}b.prototype._htmlElement=null,b.prototype._groupedTools=null,b.prototype.init=function(){if(gravit.sidebars&&gravit.sidebars.length>0)for(var a=this._htmlElement.find(".sidebars"),b=0;b<gravit.sidebars.length;++b){var c=gravit.sidebars[b];$("<button></button>").append($(c.getIcon())).attr("title",ifLocale.get(c.getTitle())).attr("data-sidebar-id",c.getId()).on("click",function(){var b=$(this),c=b.hasClass("g-active");a.find("button").each(function(a,b){$(b).removeClass("g-active")}),c?(gApp.getSidebars().setActiveSidebar(null),gApp.setPartVisible(GApplication.Part.Sidebars,!1)):(gApp.getSidebars().setActiveSidebar(b.attr("data-sidebar-id")),gApp.setPartVisible(GApplication.Part.Sidebars,!0),b.addClass("g-active"))}).appendTo(a)}var d=this._htmlElement.find(".toolpanel");this._groupedTools=[];for(var b=0;b<gravit.tools.length;++b){for(var e=gravit.tools[b],f=!1,g=0;g<this._groupedTools.length;++g)this._groupedTools[g].group===e.group&&(this._groupedTools[g].tools.push(e),f=!0);f||this._groupedTools.push({group:e.group,tools:[e]})}for(var h=null,b=0;b<this._groupedTools.length;++b){var i=this._groupedTools[b].group,j=this._groupedTools[b].tools,k=j[0],l=ifLocale.get(k.category);l!=h&&($("<div></div>").addClass("divider").text(l).appendTo(d),h=l,k.category===GApplication.TOOL_CATEGORY_VIEW&&$("<div></div>").addClass("zoom").append($("<button></button>").on("click",function(){gApp.executeAction(GZoomOutAction.ID)}).append($("<span></span>").addClass("fa fa-minus"))).append($("<input>").css("border","none").on("click",function(){$(this).select()}).on("change",function(){var a=ifUtil.parseNumber($(this).val());if(!isNaN(a)&&0!==a){var b=gApp.getWindows().getActiveWindow().getView(),c=b.getViewTransform().mapPoint(new IFPoint(b.getWidth()/2,b.getHeight()/2));b.zoomAtCenter(c,a)}})).append($("<button></button>").on("click",function(){gApp.executeAction(GZoomInAction.ID)}).append($("<span></span>").addClass("fa fa-plus"))).appendTo(d));{$("<button></button>").attr("data-group",i).appendTo(d)}j.length>1,this._updateGroupTool(k.instance)}gApp.getToolManager().addEventListener(IFToolManager.ToolChangedEvent,this._toolChanged,this),gApp.getWindows().addEventListener(GWindows.WindowEvent,this._windowEvent,this),this._updateZoomFromWindow()},b.prototype.relayout=function(){},b.prototype._toolChanged=function(a){a.previousTool&&this._updateGroupTool(a.previousTool),a.newTool&&this._updateGroupTool(a.newTool)},b.prototype._windowEvent=function(a){a.type===GWindows.WindowEvent.Type.Activated?a.window.getView().addEventListener(IFView.TransformEvent,this._updateZoomFromWindow,this):a.type===GWindows.WindowEvent.Type.Deactivated&&a.window&&a.window.getView().removeEventListener(IFView.TransformEvent,this._updateZoomFromWindow,this),this._updateZoomFromWindow()},b.prototype._updateZoomFromWindow=function(){var a=this._htmlElement.find(".toolpanel > .zoom"),b=gApp.getWindows().getActiveWindow();a.find("*").prop("disabled",!b),b&&a.find("input").val(ifUtil.formatNumber(b.getView().getZoom())+"x")},b.prototype._updateGroupTool=function(a){for(var b=this._getToolInfo(a),c=[],d=0;d<this._groupedTools.length;++d)this._groupedTools[d].group===b.group&&(c=this._groupedTools[d].tools.slice());var e=this._htmlElement.find('.toolpanel button[data-group="'+b.group+'"]');e.empty().toggleClass("g-active",a==gApp.getToolManager().getActiveTool()).attr("title",this._getToolTitle(b)).append($(b.icon).attr("width","18px").attr("height","18px")).off("mousedown").on("mousedown",function(){if(gApp.getToolManager().activateTool(a),c.length>1){var b=setTimeout(function(){for(var a=$("<div></div>").gOverlay({releaseOnClose:!0}),b=function(b){$("<button></button>").addClass("toolbar-tool-button").append($("<span></span>").addClass("fa fa-check fa-fw").css("visibility",b.instance!==gApp.getToolManager().getActiveTool()?"hidden":"")).append($(b.icon).attr("width","18px").attr("height","18px")).append($("<span></span>").html("&nbsp;"+this._getToolTitle(b))).on("mouseenter",function(){$(this).addClass("g-hover")}).on("mouseleave",function(){$(this).removeClass("g-hover")}).on("mouseup",function(){gApp.getToolManager().activateTool(b.instance),a.gOverlay("close")}).on("click",function(){gApp.getToolManager().getActiveTool()!==b.instance&&(gApp.getToolManager().activateTool(b.instance),a.gOverlay("close"))}).appendTo(a)}.bind(this),d=0;d<c.length;++d)b(c[d]);a.gOverlay("open",e)}.bind(this),250);e.off("mouseup").on("mouseup",function(){clearTimeout(b),b=null})}}.bind(this)),c.length>1&&e.append($("<span></span>").addClass("fa fa-caret-down"))},b.prototype._getToolTitle=function(a){var b=ifLocale.get(a.title);if(a.keys&&a.keys.length>0){for(var c=0;c<a.keys.length;++c)b+=0==c?" (":", ",b+=a.keys[c];b+=")"}return b},b.prototype._getToolInfo=function(a){for(var b=0;b<gravit.tools.length;++b)if(gravit.tools[b].instance===a)return gravit.tools[b];return null},a.GToolbar=b}(this),function(a){function b(a){this._container=$("<div></div>"),this._document=a,this._view=new IFEditorView(this._document.getEditor()),this._view.setViewMargin([b.VIEW_MARGIN,b.VIEW_MARGIN,b.VIEW_MARGIN,b.VIEW_MARGIN]),this._container.append(this._view._htmlElement),this._container.on("mousedown",function(){this._view.focus()}.bind(this));var c=this._createContextMenu();this._container.on("contextmenu",function(a){var b=gApp.getToolManager(),d=b.getActiveTool();return d&&d.catchesContextMenu()?void 0:(this._contextMenuClientPosition=new IFPoint(a.clientX,a.clientY),c.open({x:a.pageX,y:a.pageY}),!0)}.bind(this))}IFObject.inherit(b,GEventTarget),b.VIEW_MARGIN=10,b.prototype._container=null,b.prototype._document=null,b.prototype._view=null,b.prototype._contextMenuClientPosition=null,b.prototype.getDocument=function(){return this._document},b.prototype.getView=function(){return this._view},b.prototype.getTitle=function(){var a=this._document.getTitle(),b=this._document._windows.indexOf(this);return b>0&&(a+=":"+b.toString()),a},b.prototype.activate=function(){},b.prototype.deactivate=function(){this._document.getEditor().closeInlineEditor()},b.prototype.release=function(){this._view.release()},b.prototype._createContextMenu=function(){var a=new GMenu,b=new GMenuItem(GMenuItem.Type.Menu);return b.setCaption("Select"),b.addEventListener(GMenuItem.UpdateEvent,function(){b.getMenu().clearItems(),b.setEnabled(!1);var a=this._document.getScene().hitTest(this._contextMenuClientPosition,this._view.getWorldTransform(),function(){return!0}.bind(this),!0,-1,this._document.getScene().getProperty("pickDist"),!0);if(a&&a.length>0){b.setEnabled(!0);for(var c=0;c<a.length;++c){var d=this,e=a[c].element,f=e instanceof IFBlock?e.getLabel():e.getNodeNameTranslated();b.getMenu().createAddItem((c+1).toString()+". "+f,function(){this.element.removeFlag(IFNode.Flag.Highlighted),d._document.getEditor().updateSelection(ifPlatform.modifiers.shiftKey,[this.element])},function(){this.element.setFlag(IFNode.Flag.Highlighted)},function(){this.element.removeFlag(IFNode.Flag.Highlighted)}).element=e}}}.bind(this)),a.addItem(b),a},a.GWindow=b}(this),function(a){function b(a){this._htmlElement=a,this._windows=[]}IFObject.inherit(b,GEventTarget),b.WindowEvent=function(a,b){this.type=a,this.window=b},IFObject.inherit(b.WindowEvent,GEvent),b.WindowEvent.Type={Added:0,Removed:1,Deactivated:10,Activated:11},b.WindowEvent.prototype.type=null,b.WindowEvent.prototype.window=null,b.WindowEvent.prototype.toString=function(){return"[Object GWindows.WindowEvent]"},b.prototype._htmlElement=null,b.prototype._windows=null,b.prototype._activeWindow=null,b.prototype._viewOffset=null,b.prototype.getWindows=function(){return this._windows},b.prototype.getActiveWindow=function(){return this._activeWindow},b.prototype.activateWindow=function(a){if(a!=this._activeWindow){this._activeWindow&&(this._activeWindow.deactivate(),this._activeWindow.getDocument()._activeWindow=null,this._activeWindow._container.detach()),null===a?gApp.activateDocument(null,!0):(a&&this._activeWindow&&a.getDocument()!==this._activeWindow.getDocument()||!this._activeWindow)&&gApp.activateDocument(a.getDocument(),!0);var c=this._activeWindow;this._activeWindow=a,this._activeWindow&&this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Deactivated,c)),a&&(this._activeWindow.activate(),a.getDocument()._activeWindow=a,this._htmlElement.append(a._container),this._relayoutWindow(a),a.getView().focus(),this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Activated,a)))}},b.prototype.addWindow=function(a){var b=a instanceof GWindow?a.getDocument():a,c=this._addWindow(b);if(a instanceof GWindow){var d=a.getView();c.getView().transform(d.getScrollX(),d.getScrollY(),d.getZoom())}else c.getView().zoomActivePage();return c},b.prototype.closeWindow=function(a){var c=a.getDocument();if(a===this._activeWindow){var d=this._windows.indexOf(a);this.activateWindow(d>0?this._windows[d-1]:d+1<this._windows.length?this._windows[d+1]:null)}c._windows.splice(c._windows.indexOf(a),1),this._windows.splice(this._windows.indexOf(a),1),a._container.remove(),this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Removed,a)),a.release(),0===c._windows.length&&gApp.closeDocument(c)},b.prototype.init=function(){},b.prototype.relayout=function(a){this._viewOffset=a,this._activeWindow&&this._relayoutWindow(this._activeWindow)},b.prototype._relayoutWindow=function(a){var b=this._htmlElement.width(),c=this._htmlElement.height();a._container.width(b),a._container.height(c),a.getView().setViewOffset(this._viewOffset),a.getView().resize(b,c)},b.prototype._addWindow=function(a){var c=new GWindow(a);return a._windows.push(c),this._windows.push(c),this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Added,c)),this.activateWindow(c),c},a.GWindows=b}(this),function(a){function b(a,b){var l=a.L,m=a.a,n=a.b,o=b.L,p=b.a,q=b.b,r=1,s=1,t=1,u=e(f(m,2)+f(n,2)),v=e(f(p,2)+f(q,2)),w=(u+v)/2,x=.5*(1-e(f(w,7)/(f(w,7)+f(25,7)))),y=(1+x)*m,z=(1+x)*p,A=e(f(y,2)+f(n,2)),B=e(f(z,2)+f(q,2)),C=function(a,b){if(0==a&&0==b)return 0;var d=c(h(a,b));return d>=0?d:d+360},D=C(n,y),E=C(q,z),F=o-l,G=B-A,H=function(a,b,c,d){if(a*b==0)return 0;if(j(d-c)<=180)return d-c;if(d-c>180)return d-c-360;if(-180>d-c)return d-c+360;throw new Error},I=H(u,v,D,E),J=2*e(A*B)*i(d(I)/2),K=(l+o)/2,L=(A+B)/2,M=function(a,b,c,d){if(a*b==0)return c+d;if(j(c-d)<=180)return(c+d)/2;if(j(c-d)>180&&360>c+d)return(c+d+360)/2;if(j(c-d)>180&&c+d>=360)return(c+d-360)/2;throw new Error},N=M(u,v,D,E),O=1-.17*g(d(N-30))+.24*g(d(2*N))+.32*g(d(3*N+6))-.2*g(d(4*N-63)),P=30*k(-f((N-275)/25,2)),Q=e(f(L,7)/(f(L,7)+f(25,7))),R=1+.015*f(K-50,2)/e(20+f(K-50,2)),S=1+.045*L,T=1+.015*L*O,U=-2*Q*i(d(2*P)),V=e(f(F/(R*r),2)+f(G/(S*s),2)+f(J/(T*t),2)+U*(G/(S*s))*(J/(T*t)));return V}function c(a){return a*(180/l)}function d(a){return a*(l/180)}a.ciede2000=b;var e=Math.sqrt,f=Math.pow,g=Math.cos,h=Math.atan2,i=Math.sin,j=Math.abs,k=Math.exp,l=Math.PI}(this),function(a){a.image2Canvas=function(b,c){if("string"==typeof b&&"data:"!==b.substr(0,5)){var d=new Image;d.src=b,d.onload=function(){a.image2Canvas(d,c)}}else{var e=document.createElement("canvas");e.width=b.naturalWidth,e.height=b.naturalHeight;var f=e.getContext("2d");f.drawImage(b,0,0),c(e)}},a.image2Base64=function(b,c){a.image2Canvas(b,function(a){c(a.toDataURL("image/png"))})},a.image2ArrayBuffer=function(b,c){a.image2Canvas(b,function(a){a.toBlob(function(a){var b=new FileReader;b.onload=function(a){c(a.target.result)},b.readAsArrayBuffer(a)})})}}(this),function(a){a.expr[":"].editable=function(b){var c=a(b);return c.is(":input")||"true"===c.attr("contenteditable")||b.isContentEditable}}(jQuery),function(a){function b(){}IFObject.inherit(b,GEventTarget),b.prototype.isDevelopment=function(){return!1},b.prototype.prepare=function(){},b.prototype.start=function(){gApp.createNewDocument()},b.prototype.addMenu=function(){throw new Error("Not Supported.")},b.prototype.addMenuSeparator=function(){throw new Error("Not Supported.")},b.prototype.addMenuItem=function(){throw new Error("Not Supported.")},b.prototype.updateMenuItem=function(){throw new Error("Not Supported.")},b.prototype.removeMenuItem=function(){throw new Error("Not Supported.")},b.prototype.getClipboardMimeTypes=function(){throw new Error("Not Supported.")},b.prototype.getClipboardContent=function(){throw new Error("Not Supported.")},b.prototype.setClipboardContent=function(){throw new Error("Not Supported.")},a.GShell=b,a.gShell=null}(this),function(a){function b(){this._actions=[],this._toolManager=new IFToolManager,this._documents=[],this._windowMenuMap=[],document.addEventListener("touchstart",this._touchHandler,!0),document.addEventListener("touchmove",this._touchHandler,!0),document.addEventListener("touchend",this._touchHandler,!0),document.addEventListener("touchcancel",this._touchHandler,!0),document.addEventListener("keydown",function(){var a=this._windows.getActiveWindow();!a||document.activeElement&&$(document.activeElement).is(":editable")||a.getView().focus()}.bind(this),!1),document.addEventListener("contextmenu",function(a){return $(a.target).is(":editable")?(a.stopPropagation(),!0):(a.preventDefault(),!1)},!0)}IFObject.inherit(b,GEventTarget),b.CATEGORY_FILE=new IFLocale.Key(b,"category.file"),b.CATEGORY_EDIT=new IFLocale.Key(b,"category.edit"),b.CATEGORY_MODIFY=new IFLocale.Key(b,"category.modify"),b.CATEGORY_MODIFY_ARRANGE=new IFLocale.Key(b,"category.modify.arrange"),b.CATEGORY_MODIFY_ALIGN=new IFLocale.Key(b,"category.modify.align"),b.CATEGORY_MODIFY_TRANSFORM=new IFLocale.Key(b,"category.modify.transform"),b.CATEGORY_MODIFY_PAGE=new IFLocale.Key(b,"category.modify.page"),b.CATEGORY_MODIFY_LAYER=new IFLocale.Key(b,"category.modify.layer"),b.CATEGORY_VIEW=new IFLocale.Key(b,"category.view"),b.CATEGORY_VIEW_MAGNIFICATION=new IFLocale.Key(b,"category.view.magnification"),b.CATEGORY_WINDOW=new IFLocale.Key(b,"category.window"),b.CATEGORY_HELP=new IFLocale.Key(b,"category.help"),b.TOOL_CATEGORY_SELECT=new IFLocale.Key(b,"tool-category.select"),b.TOOL_CATEGORY_IMAGE=new IFLocale.Key(b,"tool-category.image"),b.TOOL_CATEGORY_VECTOR=new IFLocale.Key(b,"tool-category.vector"),b.TOOL_CATEGORY_OTHER=new IFLocale.Key(b,"tool-category.other"),b.TOOL_CATEGORY_COLOR=new IFLocale.Key(b,"tool-category.color"),b.TOOL_CATEGORY_VIEW=new IFLocale.Key(b,"tool-category.view"),b.Part={Header:{id:"header"},Toolbar:{id:"toolbar"},Sidebars:{id:"sidebars"},Windows:{id:"windows"},Palettes:{id:"palettes"}},b.DocumentEvent=function(a,b){this.type=a,this.document=b},IFObject.inherit(b.DocumentEvent,GEvent),b.DocumentEvent.Type={Added:0,Removed:1,Deactivated:10,Activated:11,UrlUpdated:12},b.DocumentEvent.prototype.type=null,b.DocumentEvent.prototype.document=null,b.DocumentEvent.prototype.toString=function(){return"[Object GApplication.DocumentEvent]"},b.prototype._initialized=!1,b.prototype._toolManager=null,b.prototype._documentUntitledCount=0,b.prototype._documents=null,b.prototype._activeDocument=null,b.prototype._view=null,b.prototype._header=null,b.prototype._toolbar=null,b.prototype._sidebars=null,b.prototype._windows=null,b.prototype._palettes=null,b.prototype._resizeTimerId=null,b.prototype._actions=null,b.prototype._windowMenu=null,b.prototype._windowMenuMap=null,b.prototype.getToolManager=function(){return this._toolManager},b.prototype.getDocuments=function(){return this._documents},b.prototype.getActiveDocument=function(){return this._activeDocument?this._activeDocument:null},b.prototype.getHeader=function(){return this._header},b.prototype.getToolbar=function(){return this._toolbar},b.prototype.getSidebars=function(){return this._sidebars},b.prototype.getWindows=function(){return this._windows},b.prototype.getPalettes=function(){return this._palettes},b.prototype.isPartVisible=function(a){return"none"!==this.getPart(a).css("display")},b.prototype.setPartVisible=function(a,b){b!=this.isPartVisible(a)&&this.getPart(a).css("display",b?"block":"none")},b.prototype.getPart=function(a){return this._view.find("#"+a.id)},b.prototype.getActions=function(){return this._actions},b.prototype.getAction=function(a){for(var b=0;b<this._actions.length;++b)if(this._actions[b].getId()===a)return this._actions[b];return null},b.prototype.getStorage=function(a){var b=new URI(a).protocol();if(b&&b.length)for(var c=0;c<gravit.storages.length;++c)if(gravit.storages[c].getProtocol()===b)return gravit.storages[c];return null},b.prototype.getMatchingStorage=function(a,b,c,d,e){var f=[];e&&f.push(e);for(var g=0;g<gravit.storages.length;++g){var h=gravit.storages[g];h!==e&&f.push(h)}for(var g=0;g<f.length;++g){var h=f[g];if(!(a&&!h.isPrompting()||b&&!h.isSaving())){if(c&&""!==c){var i=h.getExtensions();if(i&&i.length&&i.indexOf(c)<0)continue}if(!d||h.isDirectory())return h}}return null},b.prototype.createNewDocument=function(){var a=new IFScene;a.setProperty("unit",IFLength.Unit.PX);var b=this.addDocument(a);b.createNewPage(!0)},b.prototype.addDocument=function(a,b){var c=new GDocument(a,null,b?b:"Untitled-"+(++this._documentUntitledCount).toString());return this._addDocument(c),c},b.prototype.openDocument=function(a){for(var b=!1,c=0;c<this._documents.length;++c){var d=this._documents[c];d.getUrl()===a&&(this.activateDocument(d),b=!0)}if(!b){var e=this.getStorage(a);e&&e.load(a,!0,function(b,c){var d=new IFScene,e=new GDocument(d,a,c);try{var f=pako.inflate(new Uint8Array(b),{to:"string"}),g=JSON.parse(f);if(!d.restore(g))throw new Error("Failure.")}catch(h){e.close(),d=null,e=null,console.log(h),alert("An error has ocurred while trying to open the document.")}e&&this._addDocument(e)}.bind(this))}},b.prototype.openDocumentFrom=function(a){var b=gApp.getActiveDocument()?gApp.getActiveDocument().getUrl():null;a.openResourcePrompt(b&&""!==b?b:null,["gravit"],function(a){gApp.openDocument(a)})},b.prototype.saveDocumentAs=function(a,c){var c=c||this.getActiveDocument();c&&a.saveResourcePrompt(null,c.getTitle(),"gravit",function(a){c.setUrl(a),c.save();for(var d=c.getWindows(),e=0;e<d.length;++e)this._updateWindowMenuItem(d[e]);this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.UrlUpdated,this))}.bind(this))},b.prototype.activateDocument=function(a,c){a!=this._activeDocument&&(this._activeDocument&&(this._activeDocument&&(this._activeDocument.deactivate(),this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Deactivated,this._activeDocument))),this._activeDocument=null),a&&(c||this._windows.activateWindow(a.getActiveWindow()),a.activate(),this._activeDocument=a,this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Activated,a))))},b.prototype.closeDocument=function(a){if(a._windows.length)for(;a._windows.length>0;)this._windows.closeWindow(a._windows[0]);else a===this.getActiveDocument()&&this.activateDocument(null),a.release(),this._documents.splice(this._documents.indexOf(a),1),this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Removed,a))},b.prototype.canExecuteAction=function(a,b){var c=this.getAction(a);return c?c.isAvailable()&&c.isEnabled.apply(c,b):!1},b.prototype.executeAction=function(a,b){var c=this.getAction(a);if(!c)throw new Error("Unable to execute action '"+a+"' - not registered.");if(c.isAvailable()&&c.isEnabled.apply(c,b)){var d=c.execute.apply(c,b);return"undefined"!=typeof d?d:!0}return!1},b.prototype.init=function(){for(var a=$("body"),c=0;c<gravit.modules.length;++c){var d=gravit.modules[c];console.log("Init module <"+d.toString()+">"),d.init()}this._view=$("<div></div>").attr("id","workspace").css("display","none").prependTo(a);var e=$("<div></div>").attr("id",b.Part.Windows.id).appendTo(this._view);this._windows=new GWindows(e);var f=$("<div></div>").attr("id",b.Part.Header.id).appendTo(this._view);this._header=new GHeader(f);var g=$("<div></div>").attr("id",b.Part.Toolbar.id).appendTo(this._view);this._toolbar=new GToolbar(g);var h=$("<div></div>").attr("id",b.Part.Sidebars.id).appendTo(this._view);this._sidebars=new GSidebars(h);var i=$("<div></div>").attr("id",b.Part.Palettes.id).appendTo(this._view);switch(this._palettes=new GPalettes(i),ifSystem.hardware){case IFSystem.Hardware.Desktop:a.addClass("g-desktop");break;case IFSystem.Hardware.Tablet:a.addClass("g-touch"),a.addClass("g-tablet");break;case IFSystem.Hardware.Phone:a.addClass("g-touch"),a.addClass("g-phone")}if($(window).resize(function(){null!=this._resizeTimerId&&(clearTimeout(this._resizeTimerId),this._resizeTimerId=null),this._resizeTimerId=setTimeout(function(){this.relayout(),this._resizeTimerId=null}.bind(this),200)}.bind(this)),this._actions=gravit.actions.slice(),this._createMainMenu(),gravit.tools)for(var j=function(a){return function(){this._toolManager.activateTool(a)}.bind(this)}.bind(this),c=0;c<gravit.tools.length;++c){var k=gravit.tools[c];if(this._toolManager.addTool(k.instance),k.keys&&k.keys.length>0)for(var l=j(k.instance),m=0;m<k.keys.length;++m)this.registerShortcut([k.keys[m]],l)
}this._header.init(),this._toolbar.init(),this._sidebars.init(),this._windows.init(),this._palettes.init(),this.setPartVisible(b.Part.Sidebars,!1),this._view.css("display",""),this._initialized=!0,this._windows.addEventListener(GWindows.WindowEvent,this._windowEvent,this)},b.prototype.relayout=function(){this._initialized&&setTimeout(function(){var a=0,c=0,d=0,e=0,f=this.getPart(b.Part.Header);a+=this.isPartVisible(b.Part.Header)?f.outerHeight():0;var g=this.getPart(b.Part.Toolbar);g.css("top",a.toString()+"px"),g.height(this._view.height()-a),c+=this.isPartVisible(b.Part.Toolbar)?g.outerWidth():0;var h=this.getPart(b.Part.Sidebars);h.css("top",a.toString()+"px"),h.css("left",(this.isPartVisible(b.Part.Toolbar)?g.outerWidth():0).toString()+"px"),h.height(this._view.height()-a),c+=this.isPartVisible(b.Part.Sidebars)?h.outerWidth():0;var i=this.getPart(b.Part.Palettes);i.css("top",a.toString()+"px"),i.height(this._view.height()-a),d+=this.isPartVisible(b.Part.Palettes)?i.outerWidth():0,this._header.relayout(),this._toolbar.relayout(),this._sidebars.relayout(),this._windows.relayout([c,a,d,e]),this._palettes.relayout()}.bind(this),0)},b.prototype.registerShortcut=function(a,b){Mousetrap.bind(this._shortcutToMouseTrapShortcut(a),function(){return b(),!1}.bind(this))},b.prototype._addDocument=function(a){this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Added,a)),this._windows.addWindow(a)},b.prototype._createMainMenu=function(){for(var a=[],c={items:[]},d=function(b){for(var c=0;c<a.length;++c)if(a[c].item===b)return a[c].group},e=function(b,c,e){if(b.items.length>0){var f=d(b.items[b.items.length-1]);f!==e&&b.items.push({type:"divider"})}a.push({item:c,group:e})},f=0;f<this._actions.length;++f){var g=this._actions[f];if(g.isAvailable()){var h=ifLocale.get(g.getCategory()),i=g.getGroup(),j=h?h.split("/"):null,k=i?[""].concat(i.split("/")):null;if(k&&j&&j.length!==k.length-1)throw new Error("Number of categories different thant number of groups.");var l=c;if(j)for(var m=0;m<j.length;++m){for(var h=j[m],i=k?k[m]:null,n=null,o=0;o<l.items.length;++o)h==l.items[o].caption&&(n=l.items[o]);n||(n={type:"menu",caption:h,items:[],windowMenu:b.CATEGORY_WINDOW===g.getCategory()&&l===c},e(l,n,i),l.items.push(n)),l=n}var p={type:"item",action:g};e(l,p,k?k[k.length-1]:null),l.items.push(p)}}for(var q=function(a,b){"menu"===a.type?a.menu=r(a,b):"divider"===a.type?a.separator=gShell.addMenuSeparator(b):"item"===a.type&&(a.item=gShell.addMenuItem(b,ifLocale.get(a.action.getTitle()),a.action.isCheckable(),a.action.getShortcut(),function(){this.executeAction(a.action.getId())}.bind(this)))}.bind(this),r=function(a,b){for(var c=gShell.addMenu(b,a.caption,function(){for(var b=0;b<a.items.length;++b){var c=a.items[b];"item"===c.type&&gShell.updateMenuItem(c.item,ifLocale.get(c.action.getTitle()),c.action.isEnabled(),c.action.isCheckable()?c.action.isChecked():!1)}}),d=0;d<a.items.length;++d)q(a.items[d],c);return c},f=0;f<c.items.length;++f){var n=c.items[f],s=r(c.items[f],null);n.windowMenu&&(this._windowMenu=s,gShell.addMenuSeparator(this._windowMenu))}},b.prototype._windowEvent=function(a){switch(a.type){case GWindows.WindowEvent.Type.Added:this._addWindowMenuItem(a.window);break;case GWindows.WindowEvent.Type.Removed:this._removeWindowMenuItem(a.window);break;case GWindows.WindowEvent.Type.Activated:this._updateWindowMenuItem(a.window),this._toolManager.setView(a.window.getView());break;case GWindows.WindowEvent.Type.Deactivated:this._updateWindowMenuItem(a.window),this._toolManager.setView(null)}},b.prototype._addWindowMenuItem=function(a){this._windowMenuMap.push({window:a,item:gShell.addMenuItem(this._windowMenu,a.getTitle(),!0,null,function(){this._windows.activateWindow(a)}.bind(this))}),this._updateWindowMenuItem(a)},b.prototype._removeWindowMenuItem=function(a){for(var b=0;b<this._windowMenuMap.length;++b){var c=this._windowMenuMap[b];if(c.window===a){gShell.removeMenuItem(this._windowMenu,c.item),this._windowMenuMap.splice(b,1);break}}this._updateTitle()},b.prototype._updateWindowMenuItem=function(a){for(var b=0;b<this._windowMenuMap.length;++b){var c=this._windowMenuMap[b];if(c.window===a){gShell.updateMenuItem(c.item,c.window.getTitle(),!0,c.window===this._windows.getActiveWindow());break}}this._updateTitle()},b.prototype._updateTitle=function(){var a="Gravit",b=this.getWindows().getActiveWindow();b&&(a+=" - "+b.getTitle()),document.title=a},b.prototype._touchHandler=function(a){function b(a,b){var c=document.createEvent("MouseEvent");c.initMouseEvent(a,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c)}if(!(a.touches.length>1)){var c=a.changedTouches[0];switch(a.type){case"touchstart":b("mousedown",c);break;case"touchmove":b("mousemove",c);break;case"touchend":b("mouseup",c),b("click",c);break;default:return}a.preventDefault(),a.stopPropagation()}},b.prototype._shortcutToMouseTrapShortcut=function(a){for(var b="",c=0;c<a.length;++c){c>0&&(b+="+");var d=a[c];if("number"==typeof d)switch(d){case IFKey.Constant.META:b+="meta";break;case IFKey.Constant.OPTION:b+="option";break;case IFKey.Constant.REMOVE:b+="del";break;case IFKey.Constant.SPACE:b+="space";break;case IFKey.Constant.ENTER:b+="enter";break;case IFKey.Constant.TAB:b+="tab";break;case IFKey.Constant.BACKSPACE:b+="backspace";break;case IFKey.Constant.CONTROL:b+="ctrl";break;case IFKey.Constant.SHIFT:b+="shift";break;case IFKey.Constant.ALT:b+="alt";break;case IFKey.Constant.LEFT:b+="left";break;case IFKey.Constant.UP:b+="up";break;case IFKey.Constant.RIGHT:b+="right";break;case IFKey.Constant.DOWN:b+="down";break;case IFKey.Constant.PAGE_UP:b+="pageup";break;case IFKey.Constant.PAGE_DOWN:b+="pagedown";break;case IFKey.Constant.HOME:b+="home";break;case IFKey.Constant.END:b+="end";break;case IFKey.Constant.INSERT:b+="ins";break;case IFKey.Constant.DELETE:b+="del";break;case IFKey.Constant.COMMAND:b+="meta";break;case IFKey.Constant.F1:b+="f1";break;case IFKey.Constant.F2:b+="f2";break;case IFKey.Constant.F3:b+="f3";break;case IFKey.Constant.F4:b+="f4";break;case IFKey.Constant.F5:b+="f5";break;case IFKey.Constant.F6:b+="f6";break;case IFKey.Constant.F7:b+="f7";break;case IFKey.Constant.F8:b+="f8";break;case IFKey.Constant.F9:b+="f9";break;case IFKey.Constant.F10:b+="f10";break;case IFKey.Constant.F11:b+="f11";break;case IFKey.Constant.F12:b+="f12";break;default:throw new Error("Unknown key code")}else b+=d.toLowerCase()}return b},a.GApplication=b}(this),function(a){function b(a,b,c){this.setUrl(b),this._scene=a,this._editor=new IFEditor(a),this._windows=[],this._activeWindow=null,this._title=c,this._scene.addEventListener(IFScene.ResolveUrlEvent,this._resolveUrl,this)}IFObject.inherit(b,GEventTarget),b.prototype._scene=null,b.prototype._url=null,b.prototype._editor=null,b.prototype._windows=null,b.prototype._activeWindow=null,b.prototype._title=null,b.prototype.getScene=function(){return this._scene},b.prototype.getStorage=function(){return this._storage},b.prototype.getUrl=function(){return this._url},b.prototype.setUrl=function(a){a!==this._url&&(this._storage&&this._storage.releaseUrl(this._url),this._url=a,this._storage=a?gApp.getStorage(a):null)},b.prototype.getEditor=function(){return this._editor},b.prototype.getWindows=function(){return this._windows},b.prototype.getActiveWindow=function(){return this._activeWindow},b.prototype.getTitle=function(){return this._title},b.prototype.isSaveable=function(){return!!this._storage},b.prototype.save=function(){if(this._url){var a=IFNode.serialize(this._scene),b=pako.deflate(a);this._storage.save(this._url,b.buffer,!0,function(a){this._title=a}.bind(this))}},b.prototype.createNewPage=function(a){var b=this._scene,c=this._scene.getPageInsertPosition(),d=new IFPage;d.setProperties(["name","x","y","w","h"],["Page "+(b.queryCount("> page")+1).toString(),c.getX(),c.getY(),800,600]);var e=new IFLayer;e.setProperties(["name"],["Background"]),d.appendChild(e);var f=function(){b.appendChild(d),b.setActiveLayer(e)};return a?f():IFEditor.tryRunTransaction(b,f,"Add new Page"),d},b.prototype.activate=function(){},b.prototype.deactivate=function(){},b.prototype.release=function(){this._editor.release(),this._scene.removeEventListener(IFScene.ResolveUrlEvent,this._resolveUrl,this),this._storage&&this._storage.releaseUrl(this._url)},b.prototype._resolveUrl=function(a){var b=new URI(a.url);if(0===b.protocol().length&&(b=b.absoluteTo(this._url)),b.protocol().length>0){var c=gApp.getStorage(b.protocol()+":");c&&c.resolveUrl(b.toString(),a.resolved)}},a.GDocument=b}(this);var gravit={modules:[],storages:[],exporters:[],actions:[],palettes:[],sidebars:[],tools:[],colorMatchers:[],properties:[],styleEntries:[],transformers:[]},gLoaderCode='<div style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; background: rgb(213, 223, 0);">\n    <style type="text/css">\n        .spinner {\n            width: 120px;\n            height: 120px;\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            margin: -80px 0 0 -60px;\n            text-align: center;\n            -webkit-animation: rotate 2.0s infinite linear;\n            animation: rotate 2.0s infinite linear;\n        }\n\n        .spinner-dot1, .spinner-dot2 {\n            width: 60%;\n            height: 60%;\n            display: inline-block;\n            position: absolute;\n            top: 0;\n            background-color: rgb(229, 71, 97);\n            border-radius: 100%;\n            -webkit-animation: bounce 2.0s infinite ease-in-out;\n            animation: bounce 2.0s infinite ease-in-out;\n        }\n\n        .spinner-dot1 {\n            top: auto;\n            bottom: 0px;\n            -webkit-animation-delay: -1.0s;\n            animation-delay: -1.0s;\n        }\n\n        @-webkit-keyframes rotate { 100% { -webkit-transform: rotate(360deg) }}\n        @keyframes rotate { 100% { transform: rotate(360deg); -webkit-transform: rotate(360deg) }}\n\n        @-webkit-keyframes bounce {\n            0%, 100% { -webkit-transform: scale(0.0) }\n            50% { -webkit-transform: scale(1.0) }\n        }\n\n        @keyframes bounce {\n            0%, 100% {\n                transform: scale(0.0);\n                -webkit-transform: scale(0.0);\n            } 50% {\n                  transform: scale(1.0);\n                  -webkit-transform: scale(1.0);\n              }\n        }\n    </style>\n    <div class="spinner">\n        <div class="spinner-dot1"></div>\n        <div class="spinner-dot2"></div>\n    </div>\n</div>',gShell=null,gApp=null,__loader=null;$(document).ready(function(){if(!gShell)throw new Error("Shell needs to be initialized, first.");__loader=$(gLoaderCode).appendTo($("body")),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.Light,"font/OpenSans-Light.ttf",IFFont.Category.Serif),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.Light,"font/OpenSans-LightItalic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.Regular,"font/OpenSans-Regular.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.Regular,"font/OpenSans-Italic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.SemiBold,"font/OpenSans-Semibold.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.SemiBold,"font/OpenSans-SemiboldItalic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.Bold,"font/OpenSans-Bold.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.Bold,"font/OpenSans-BoldItalic.ttf"),ifFont.addType("Open Sans",IFFont.Style.Normal,IFFont.Weight.ExtraBold,"font/OpenSans-ExtraBold.ttf"),ifFont.addType("Open Sans",IFFont.Style.Italic,IFFont.Weight.ExtraBold,"font/OpenSans-ExtraBoldItalic.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.ExtraLight,"font/SourceSansPro-ExtraLight.ttf",IFFont.Category.Serif),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.ExtraLight,"font/SourceSansPro-ExtraLightIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Light,"font/SourceSansPro-Light.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Light,"font/SourceSansPro-LightIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Regular,"font/SourceSansPro-Regular.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Regular,"font/SourceSansPro-It.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.SemiBold,"font/SourceSansPro-Semibold.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.SemiBold,"font/SourceSansPro-SemiboldIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Bold,"font/SourceSansPro-Bold.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Bold,"font/SourceSansPro-BoldIt.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Normal,IFFont.Weight.Heavy,"font/SourceSansPro-Black.ttf"),ifFont.addType("Source Sans Pro",IFFont.Style.Italic,IFFont.Weight.Heavy,"font/SourceSansPro-BlackIt.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.ExtraLight,"font/SourceCodePro-ExtraLight.ttf",IFFont.Category.Monospace),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Light,"font/SourceCodePro-Light.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Regular,"font/SourceCodePro-Regular.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Medium,"font/SourceCodePro-Medium.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.SemiBold,"font/SourceCodePro-Semibold.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Bold,"font/SourceCodePro-Bold.ttf"),ifFont.addType("Source Code Pro",IFFont.Style.Normal,IFFont.Weight.Heavy,"font/SourceCodePro-Black.ttf"),ifFont.addType("FontAwesome",IFFont.Style.Normal,IFFont.Weight.Regular,gShell.isDevelopment()?"../bower_components/font-awesome/fonts/FontAwesome-webfont.ttf":"font/FontAwesome-webfont.ttf",IFFont.Category.Iconic)}),$(window).load(function(){rangy.init()}),ifLocale.setValues(GColorMatcher,IFLocale.Language.English,["category.harmony","category.palette"],["Harmony","Palette"]),ifLocale.setValues(GApplication,IFLocale.Language.English,["category.window","category.file","category.edit","category.modify","category.modify.arrange","category.modify.align","category.modify.transform","category.modify.page","category.modify.layer","category.arrange","category.arrange.transform","category.view","category.view.magnification","category.help","tool-category.select","tool-category.image","tool-category.vector","tool-category.other","tool-category.color","tool-category.view"],["Window","File","Edit","Modify","Modify/Arrange","Modify/Align","Modify/Transform","Modify/Page","Modify/Layer","Arrange","Arrange/Transform","View","View/Magnification","Help","Select","Image","Vector","Other","Color","View"]),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="modify.add-layer",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_LAYER},b.prototype.getGroup=function(){return"structure/modify"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){var a=gApp.getActiveDocument().getScene(),b=a.getActivePage();IFEditor.tryRunTransaction(b,function(){var c=new IFLayer;c.setProperty("name","Layer "+a.queryCount("layer").toString()),b.appendChild(c),a.setActiveLayer(c)},ifLocale.get(this.getTitle()))},b.prototype.toString=function(){return"[Object GAddLayerAction]"},a.GAddLayerAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="modify.delete-layer",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_LAYER},b.prototype.getGroup=function(){return"structure/modify"},b.prototype.isEnabled=function(a){return a||(a=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActiveLayer():null),!!a},b.prototype.execute=function(a){var a=a||gApp.getActiveDocument().getScene().getActiveLayer(),b=a.getScene();if(!b)throw new Error("No scene on layer.");for(var c=null,d=a.getPrevious();null!==d;d=d.getPrevious())if(d instanceof IFLayer){c=d;break}if(!c)for(var d=a.getNext();null!==d;d=d.getNext())if(d instanceof IFLayer){c=d;break}return!c&&a.getParent()instanceof IFLayer&&(c=a.getParent()),c?(a.hasFlag(IFNode.Flag.Active)&&b.setActiveLayer(c),void IFEditor.tryRunTransaction(b,function(){a.getParent().removeChild(a)},ifLocale.get(this.getTitle()))):void alert("Unable to delete - the page needs to contain at least one layer.")},b.prototype.toString=function(){return"[Object GDeleteLayerAction]"},a.GDeleteLayerAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="modify.add-page",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_PAGE},b.prototype.getGroup=function(){return"structure/modify"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){gApp.getActiveDocument().createNewPage()},b.prototype.toString=function(){return"[Object GAddPageAction]"},a.GAddPageAction=b}(this),function(a){function b(a){this._type=a,this._title=new IFLocale.Key(b,"title."+a)}IFObject.inherit(b,GAction),b.Type={AlignLeft:"align-left",AlignCenter:"align-center",AlignRight:"align-right",AlignTop:"align-top",AlignMiddle:"align-middle",AlignBottom:"align-bottom",AlignJustifyHorizontal:"align-justify-horizontal",AlignJustifyVertical:"align-justify-vertical"},b.ID="arrange.align",b.prototype._type=null,b.prototype._title=null,b.prototype.getId=function(){return b.ID+"."+this._type},b.prototype.getTitle=function(){return this._title},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ALIGN},b.prototype.getGroup=function(){var a="";switch(this._type){case b.Type.AlignLeft:case b.Type.AlignCenter:case b.Type.AlignRight:case b.Type.AlignJustifyHorizontal:a="horizontal";break;case b.Type.AlignTop:case b.Type.AlignMiddle:case b.Type.AlignBottom:case b.Type.AlignJustifyVertical:a="vertical"}return"arrange/align-"+a},b.prototype.getShortcut=function(){return null},b.prototype.isEnabled=function(a,b,c,d){return a=a||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null),a?d?a.length>0:a.length>1:!1},b.prototype.execute=function(a,c,d,e){var f=gApp.getActiveDocument(),g=f.getScene();a||(a=f.getEditor().getSelection());for(var h=a,a=[],i=null,j=0;j<h.length;++j){var k=h[j];if(k.hasMixin(IFElement.Transform)){var l=d?k.getGeometryBBox():k.getPaintBBox();if(!l||l.isEmpty())continue;i=i?i.united(l):l,a.push({bbox:l,element:k})}}if(!e)for(var j=0;j<a.length;++j){var l=a[j].element.getPaintBBox();l&&!l.isEmpty()&&(e=e?e.united(l):l)}e&&!e.isEmpty()&&IFEditor.tryRunTransaction(g,function(){for(var d=0;d<a.length;++d){var f=c?i:a[d].bbox,g=a[d].element;switch(this._type){case b.Type.AlignLeft:e.getX()!==f.getX()&&g.transform(new IFTransform(1,0,0,1,e.getX()-f.getX(),0));break;case b.Type.AlignCenter:var h=e.getX()+e.getWidth()/2;h!==f.getX()+f.getWidth()/2&&g.transform(new IFTransform(1,0,0,1,h-f.getX()-f.getWidth()/2,0));break;case b.Type.AlignRight:var j=e.getX()+e.getWidth();j!==f.getX()+f.getWidth()&&g.transform(new IFTransform(1,0,0,1,j-f.getWidth()-f.getX(),0));break;case b.Type.AlignTop:e.getY()!==f.getY()&&g.transform(new IFTransform(1,0,0,1,0,e.getY()-f.getY()));break;case b.Type.AlignMiddle:var h=e.getY()+e.getHeight()/2;h!==f.getY()+f.getHeight()/2&&g.transform(new IFTransform(1,0,0,1,0,h-f.getY()-f.getHeight()/2));break;case b.Type.AlignBottom:var k=e.getY()+e.getHeight();k!==f.getY()+f.getHeight()&&g.transform(new IFTransform(1,0,0,1,0,k-f.getHeight()-f.getY()));break;case b.Type.AlignJustifyHorizontal:(e.getX()!==f.getX()||f.getWidth()!==e)&&g.transform(new IFTransform(1,0,0,1,0,0).translated(-f.getX(),-f.getY()).scaled(e.getWidth()/f.getWidth(),1).translated(f.getX(),f.getY()).translated(e.getX()-f.getX(),0));break;case b.Type.AlignJustifyVertical:(e.getY()!==f.getY()||f.getHeight()!==e)&&g.transform(new IFTransform(1,0,0,1,0,0).translated(-f.getX(),-f.getY()).scaled(1,e.getHeight()/f.getHeight()).translated(f.getX(),f.getY()).translated(0,e.getY()-f.getY()))}}}.bind(this),ifLocale.get(this.getTitle()))},b.prototype.toString=function(){return"[Object GAlignAction]"},a.GAlignAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.clone",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"selection"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"D"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();return a&&null!=a.getEditor().getSelection()},b.prototype.execute=function(){var a=gApp.getActiveDocument().getEditor();a.beginTransaction();try{a.cloneSelection()}finally{a.commitTransaction(ifLocale.get(this.getTitle()))}},b.prototype.toString=function(){return"[Object GCloneAction]"},a.GCloneAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.close",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"close"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"Q"]},b.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},b.prototype.execute=function(){gApp.getWindows().closeWindow(gApp.getWindows().getActiveWindow())},b.prototype.toString=function(){return"[Object GCloseAction]"},a.GCloseAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.close-all",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"close"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){for(;gApp.getActiveDocument();)gApp.closeDocument(gApp.getActiveDocument())},b.prototype.toString=function(){return"[Object GCloseAllAction]"},a.GCloseAllAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.copy",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"C"]},b.prototype.isEnabled=function(){return document.activeElement&&$(document.activeElement).is(":editable")?!0:gApp.getActiveDocument()&&gApp.getActiveDocument().getEditor().getSelection()?!0:!1},b.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("copy");else{var a=IFNode.order(gApp.getActiveDocument().getEditor().getSelection()),b=IFNode.serialize(a);gShell.setClipboardContent(IFNode.MIME_TYPE,b)}},b.prototype.toString=function(){return"[Object GCopyAction]"},a.GCopyAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.copy-attributes",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp_special"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.F4]},b.prototype.isEnabled=function(){return!1},b.prototype.execute=function(){for(var a=gApp.getActiveDocument().getEditor().getSelection(),b=0;b<a.length;++b)if(a[b].hasMixin(IFElement.Attributes)){var c=a[b].getAttributes();if(c&&c.hasMixin(IFNode.Container)&&c.getFirstChild()){var d=IFNode.serialize(c);gShell.setClipboardContent(IFAttribute.MIME_TYPE,d);break}}},b.prototype.toString=function(){return"[Object GCopyAttributesAction]"},a.GCopyAttributesAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.cut",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"X"]},b.prototype.isEnabled=function(){return document.activeElement&&$(document.activeElement).is(":editable")?!0:gApp.getActiveDocument()&&gApp.getActiveDocument().getEditor().getSelection()?!0:!1},b.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("cut");else{var a=gApp.getActiveDocument().getEditor();gApp.executeAction(GCopyAction.ID),a.beginTransaction();try{a.deleteSelection(!0)}finally{a.commitTransaction("Cut Selection")}}},b.prototype.toString=function(){return"[Object GCutAction]"},a.GCutAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.delete",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp"},b.prototype.getShortcut=function(){return[IFKey.Constant.REMOVE]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();if(a){var b=a.getEditor().getSelection();if(b)for(var c=0;c<b.length;++c)if(b[c]instanceof IFItem)return!0}return!1},b.prototype.execute=function(){var a=gApp.getActiveDocument().getEditor();a.deleteSelection()},b.prototype.toString=function(){return"[Object GDeleteAction]"},a.GDeleteAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="modify.delete-page",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_PAGE},b.prototype.getGroup=function(){return"structure/modify"},b.prototype.isEnabled=function(a){return a||(a=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActivePage():null),!!a},b.prototype.execute=function(a){var a=a||gApp.getActiveDocument().getScene().getActivePage(),b=a.getScene();if(!b)throw new Error("No scene on page.");for(var c=null,d=a.getPrevious();null!==d;d=d.getPrevious())if(d instanceof IFPage){c=d;break}if(!c)for(var d=a.getNext();null!==d;d=d.getNext())if(d instanceof IFPage){c=d;break}return c?(a.hasFlag(IFNode.Flag.Active)&&b.setActivePage(c),void IFEditor.tryRunTransaction(b,function(){a.getParent().removeChild(a)},ifLocale.get(this.getTitle()))):void alert("Unable to delete - the document needs to contain at least one page.")},b.prototype.toString=function(){return"[Object GDeletePageAction]"},a.GDeletePageAction=b}(this),function(a){function b(a){this._type=a,this._title=new IFLocale.Key(b,"title."+a)}IFObject.inherit(b,GAction),b.Type={Horizontal:"horizontal",Vertical:"vertical"},b.ID="arrange.distribute",b.prototype._type=null,b.prototype._title=null,b.prototype.getId=function(){return b.ID+"."+this._type},b.prototype.getTitle=function(){return this._title},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ALIGN},b.prototype.getGroup=function(){return"arrange/align-distribute"},b.prototype.getShortcut=function(){return null},b.prototype.isEnabled=function(a,b,c){return a=a||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null),a?c?a.length>1:a.length>2:!1},b.prototype.execute=function(a,c,d,e){var f=gApp.getActiveDocument(),g=f.getScene();a||(a=f.getEditor().getSelection());for(var h=a,a=[],i=0;i<h.length;++i){var j=h[i];if(j.hasMixin(IFElement.Transform)){var k=c?j.getGeometryBBox():j.getPaintBBox();if(!k||k.isEmpty())continue;a.push({bbox:k,element:j})}}if(!d)for(var i=0;i<a.length;++i){var k=a[i].element.getPaintBBox();k&&!k.isEmpty()&&(d=d?d.united(k):k)}if(d&&!d.isEmpty())if(this._type===b.Type.Horizontal){if(a.sort(function(a,b){return a.bbox.getX()>b.bbox.getX()}),!e){for(var l=0,i=0;i<a.length;++i)l+=a[i].bbox.getWidth();e=(d.getWidth()-l)/(a.length-1)}IFEditor.tryRunTransaction(g,function(){for(var b=d.getX(),c=0;c<a.length;++c)b!==a[c].bbox.getX()&&a[c].element.transform(new IFTransform(1,0,0,1,b-a[c].bbox.getX(),0)),b+=a[c].bbox.getWidth()+e}.bind(this),ifLocale.get(this.getTitle()))}else if(this._type===b.Type.Vertical){if(a.sort(function(a,b){return a.bbox.getY()>b.bbox.getY()}),!e){for(var l=0,i=0;i<a.length;++i)l+=a[i].bbox.getHeight();e=(d.getHeight()-l)/(a.length-1)}IFEditor.tryRunTransaction(g,function(){for(var b=d.getY(),c=0;c<a.length;++c)b!==a[c].bbox.getY()&&a[c].element.transform(new IFTransform(1,0,0,1,0,b-a[c].bbox.getY())),b+=a[c].bbox.getHeight()+e}.bind(this),ifLocale.get(this.getTitle()))}},b.prototype.toString=function(){return"[Object GDistributeAction]"},a.GDistributeAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.duplicate",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"selection"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"D"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();return a&&null!=a.getEditor().getSelection()},b.prototype.execute=function(){var a=gApp.getActiveDocument().getEditor();a.beginTransaction();try{a.cloneSelection(!0,!0)}finally{a.commitTransaction(ifLocale.get(this.getTitle()))}},b.prototype.toString=function(){return"[Object GDuplicateAction]"},a.GDuplicateAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.zoom.fit.all",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"zoom"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"O"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument(),b=a?a.getScene().getPaintBBox():null;return b&&!b.isEmpty()},b.prototype.execute=function(){var a=gApp.getActiveDocument();if(a.getScene().getProperty("singlePage")){var b=a.getScene().getActivePage();a.getActiveWindow().getView().zoomAll(b.getPaintBBox(),!1)}else a.getActiveWindow().getView().zoomAll(a.getScene().getPaintBBox(),!1)},b.prototype.toString=function(){return"[Object GFitAllAction]"},a.GFitAllAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.zoom.fit-current-layer",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"zoom"},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument(),b=a?a.getScene().getActiveLayer():null;return b&&b.getPaintBBox()&&!b.getPaintBBox().isEmpty()},b.prototype.execute=function(){var a=gApp.getActiveDocument(),b=a.getScene().getActiveLayer();a.getActiveWindow().getView().zoomAll(b.getPaintBBox(),!1)},b.prototype.toString=function(){return"[Object GFitCurrentLayerAction]"},a.GFitCurrentLayerAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.zoom.fit-current-page",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID
},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"zoom"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.SHIFT,"W"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument(),b=a?a.getScene().getActivePage():null;return b&&b.getPaintBBox()&&!b.getPaintBBox().isEmpty()},b.prototype.execute=function(){var a=gApp.getActiveDocument(),b=a.getScene().getActivePage();a.getActiveWindow().getView().zoomAll(b.getPaintBBox(),!1)},b.prototype.toString=function(){return"[Object GFitCurrentPageAction]"},a.GFitCurrentPageAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.zoom.fit-selection",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"zoom"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"O"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument(),b=a?a.getEditor():null;return b&&b.hasSelection()},b.prototype.execute=function(){for(var a=gApp.getActiveDocument(),b=a?a.getEditor():null,c=b.getSelection(),d=null,e=0;e<c.length;++e){var f=c[e].getPaintBBox();f&&!f.isEmpty()&&(d=d?d.united(f):f)}d&&!d.isEmpty()&&a.getActiveWindow().getView().zoomAll(d,!1)},b.prototype.toString=function(){return"[Object GFitSelectionAction]"},a.GFitSelectionAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="modify.group",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY},b.prototype.getGroup=function(){return"structure-group"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"G"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();if(a){var b=a.getEditor().getSelection();return b&&b.length>1}return!1},b.prototype.execute=function(){var a=gApp.getActiveDocument().getEditor(),b=a.getSelection();a.beginTransaction();try{for(var c=new IFShapeSet,d=[],e=0;e<b.length;++e){var f=b[e];f.validateInsertion(c)&&d.push(f)}if(d.length>0){for(var e=0;e<d.length;++e){var f=d[e];f.getParent().removeChild(f),c.appendChild(f)}a.insertElements([c],!0,!0)}}finally{a.commitTransaction("Group")}},b.prototype.toString=function(){return"[Object GGroupAction]"},a.GGroupAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.place-image",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"insert"},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();return a&&a.isSaveable()?!0:!1},b.prototype.execute=function(){var a=gApp.getActiveDocument();a.getStorage().openResourcePrompt(a.getUrl(),["jpg","jpeg","png","gif"],function(b){var c=new URI(b);alert("uri: "+c.toString()),alert("make_relative_to: "+a.getUrl()),b=c.relativeTo(a.getUrl()).toString();var d=c.filename(),e=c.suffix(),f=e.length>0?d.substr(0,d.length-e.length-1):d,g=a.getScene().getActivePage().getGeometryBBox().getSide(IFRect.Side.TOP_LEFT),h=new IFImage;h.setProperties(["name","url","transform"],[f,b,new IFTransform(1,0,0,1,g.getX(),g.getY())]),h.transform(),a.getEditor().insertElements([h])})},b.prototype.toString=function(){return"[Object GPlaceImageAction]"},a.GPlaceImageAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.invert-selection",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"select"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"A"]},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){var a=gApp.getActiveDocument(),b=a.getScene(),c=null;c=b.getProperty("singlePage")?b.getActivePage():b;var d=[];c.accept(function(a){a instanceof IFItem&&a.getParent()instanceof IFLayer&&!a.hasFlag(IFNode.Flag.Selected)&&d.push(a)}),a.getEditor().updateSelection(!1,d)},b.prototype.toString=function(){return"[Object GInvertSelectionAction]"},a.GInvertSelectionAction=b}(this),function(a){function b(a){this._layerType=a}IFObject.inherit(b,GAction),b.ID="modify.layer-type",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._layerType=null,b.prototype.getId=function(){return b.ID+"."+this._layerType},b.prototype.getTitle=function(){return ifLocale.get(b.TITLE).replace("%name%",ifLocale.get(IFLayer.TypeName[this._layerType]))},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_LAYER},b.prototype.getGroup=function(){return"structure/type"},b.prototype.isCheckable=function(){return!0},b.prototype.isChecked=function(){var a=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActiveLayer():null;return a?a.getProperty("tp")===this._layerType:!1},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){var a=gApp.getActiveDocument()?gApp.getActiveDocument().getScene().getActiveLayer():null;a&&a.setProperty("tp",this._layerType)},b.prototype.toString=function(){return"[Object GLayerTypeAction]"},a.GLayerTypeAction=b}(this),function(a){function b(a,b){this._magnification=a,this._shortcut=b}IFObject.inherit(b,GAction),b.ID="view.magnification",b.prototype._magnification=null,b.prototype._shortcut=null,b.prototype.getId=function(){return b.ID+"."+this._magnification.toString()},b.prototype.getTitle=function(){return this._magnification.toString()+"%"},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW_MAGNIFICATION},b.prototype.getGroup=function(){return"zoom/magnification-level"},b.prototype.getShortcut=function(){return this._shortcut},b.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},b.prototype.execute=function(){var a=gApp.getWindows().getActiveWindow().getView(),b=this._magnification/100,c=a.getViewTransform().mapPoint(new IFPoint(a.getWidth()/2,a.getHeight()/2));a.zoomAt(c,b)},b.prototype.toString=function(){return"[Object GMagnificationAction]"},a.GMagnificationAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.new",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"file"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"N"]},b.prototype.execute=function(){gApp.createNewDocument()},b.prototype.toString=function(){return"[Object GNewAction]"},a.GNewAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.clone",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_WINDOW},b.prototype.getGroup=function(){return"view"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"N"]},b.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},b.prototype.execute=function(){gApp.getWindows().addWindow(gApp.getWindows().getActiveWindow())},b.prototype.toString=function(){return"[Object GNewWindowAction]"},a.GNewWindowAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.open",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"file"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"O"]},b.prototype.isEnabled=function(){return!!this._getViableStorage()},b.prototype.execute=function(){gApp.openDocumentFrom(this._getViableStorage())},b.prototype._getViableStorage=function(){for(var a=0;a<gravit.storages.length;++a){var b=gravit.storages[a];if(b.isAvailable()&&b.isPrompting()){var c=b.getExtensions();if(!c||c.isEmpty()||c.indexOf("gravit")>=0)return b}}return null},b.prototype.toString=function(){return"[Object GOpenAction]"},a.GOpenAction=b}(this),function(a){function b(a){this._type=a,this._title=new IFLocale.Key(b,"title."+a)}IFObject.inherit(b,GAction),b.Type={SendToFront:"send-front",BringForward:"bring-forward",SendBackward:"send-backward",SendToBack:"send-back"},b.ID="arrange.order",b.prototype._type=null,b.prototype._title=null,b.prototype.getId=function(){return b.ID+"."+this._type},b.prototype.getTitle=function(){return this._title},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ARRANGE},b.prototype.getGroup=function(){return"arrange/arrange"},b.prototype.getShortcut=function(){switch(this._type){case b.Type.SendToFront:return[IFKey.Constant.SHIFT,IFKey.Constant.META,IFKey.Constant.UP];case b.Type.BringForward:return[IFKey.Constant.META,IFKey.Constant.UP];case b.Type.SendBackward:return[IFKey.Constant.META,IFKey.Constant.DOWN];case b.Type.SendToBack:return[IFKey.Constant.SHIFT,IFKey.Constant.META,IFKey.Constant.DOWN]}return null},b.prototype.isEnabled=function(a){return a=a||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null),a&&a.length>0},b.prototype.execute=function(a){var c=gApp.getActiveDocument(),d=c.getScene(),e=null;a||(e=c.getEditor().getSelection().slice(),a=e),a=IFNode.order(a,!0),IFEditor.tryRunTransaction(d,function(){for(var c=0;c<a.length;++c){var d=a[c],e=d.getParent();switch(this._type){case b.Type.SendToFront:null!==d.getNext()&&(e.removeChild(d),e.appendChild(d));break;case b.Type.BringForward:if(null!==d.getNext()){var f=d.getNext()?d.getNext().getNext():null;e.removeChild(d),e.insertChild(d,f)}break;case b.Type.SendBackward:if(null!==d.getPrevious()){var f=d.getPrevious()?d.getPrevious():e.getFirstChild();e.removeChild(d),e.insertChild(d,f)}break;case b.Type.SendToBack:null!==d.getPrevious()&&(e.removeChild(d),e.insertChild(d,e.getFirstChild()))}}}.bind(this),ifLocale.get(this.getTitle())),e&&c.getEditor().updateSelection(!1,e)},b.prototype.toString=function(){return"[Object GArrangeAction]"},a.GArrangeAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.zoom.original",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"zoom"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"0"]},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){var a=gApp.getActiveDocument(),b=a.getScene().getPaintBBox();a.getActiveWindow().getView().zoomAtCenter(b&&!b.isEmpty()?b.getSide(IFRect.Side.CENTER):new IFPoint(0,0),1)},b.prototype.toString=function(){return"[Object GOriginalViewAction]"},a.GOriginalViewAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.pixel-preview",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"render"},b.prototype.isCheckable=function(){return!0},b.prototype.isChecked=function(){var a=gApp.getWindows().getActiveWindow();return a?a.getView().getViewConfiguration().pixelMode:!1},b.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},b.prototype.execute=function(){var a=gApp.getWindows().getActiveWindow().getView();a.getViewConfiguration().pixelMode=!a.getViewConfiguration().pixelMode,a.invalidate()},b.prototype.toString=function(){return"[Object GPixelPreviewAction]"},a.GPixelPreviewAction=b}(this),function(a){function b(a){this._paintMode=a}IFObject.inherit(b,GAction),b.ID="view.page.decoration",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._paintMode=null,b.prototype.getId=function(){return b.ID+"."+this._paintMode},b.prototype.getTitle=function(){return ifLocale.get(b.TITLE).replace("%name%",ifLocale.get(IFScenePaintConfiguration.PaintModeName[this._paintMode]))},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"paint-mode"},b.prototype.isCheckable=function(){return!0},b.prototype.isChecked=function(){var a=gApp.getWindows().getActiveWindow();return a?a.getView().getViewConfiguration().paintMode===this._paintMode:!1},b.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},b.prototype.execute=function(){var a=gApp.getWindows().getActiveWindow().getView();a.getViewConfiguration().paintMode=this._paintMode,a.invalidate()},b.prototype.toString=function(){return"[Object GPaintModeAction]"},a.GPaintModeAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.paste",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"V"]},b.prototype.isEnabled=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))return!0;var a=gShell.getClipboardMimeTypes();return a&&a.indexOf(IFNode.MIME_TYPE)>=0?!!gApp.getActiveDocument():!1},b.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("paste");else{var a=IFNode.deserialize(gShell.getClipboardContent(IFNode.MIME_TYPE));if(a&&a.length>0){for(var b=[],c=0;c<a.length;++c)a[c]instanceof IFElement&&b.push(a[c]);if(b.length>0){var d=gApp.getActiveDocument().getEditor();d.beginTransaction();try{d.insertElements(b,!0,!0)}finally{d.commitTransaction("Paste")}}}}},b.prototype.toString=function(){return"[Object GPasteAction]"},a.GPasteAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.paste-inside",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"V"]},b.prototype.isEnabled=function(){var a=gShell.getClipboardMimeTypes();if(a&&a.indexOf(IFNode.MIME_TYPE)>=0){var b=gApp.getActiveDocument();if(b){var c=b.getEditor().getSelection();if(c)for(var d=0;d<c.length;++d)if(c[d].hasMixin(IFNode.Container))return!0}}return!1},b.prototype.execute=function(){var a=IFNode.deserialize(gShell.getClipboardContent(IFNode.MIME_TYPE));if(a&&a.length>0){for(var b=[],c=0;c<a.length;++c)a[c]instanceof IFElement&&b.push(a[c]);if(b.length>0){var d=gApp.getActiveDocument().getEditor(),e=d.getSelection(),f=[];d.beginTransaction();try{for(var c=0;c<e.length;++c){var g=e[c];if(g.hasMixin(IFNode.Container))for(var h=0;h<b.length;++h)if(b[h].validateInsertion(g)){var i=b[h].clone();g.appendChild(i),f.push(i)}}d.updateSelection(!1,f)}finally{d.commitTransaction("Paste Inside")}}}},b.prototype.toString=function(){return"[Object GPasteInsideAction]"},a.GPasteInsideAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.paste-attributes",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"ccp_special"},b.prototype.getShortcut=function(){return[IFKey.Constant.F4]},b.prototype.isEnabled=function(){return!1},b.prototype.execute=function(){var a=IFNode.deserialize(gShell.getClipboardContent(IFAttribute.MIME_TYPE));if(a){var b=gApp.getActiveDocument().getEditor(),c=b.getSelection();b.beginTransaction();try{for(var d=0;d<c.length;++d){var e=c[d];e.hasMixin(IFElement.Attributes)&&e.getAttributes().assignAttributesFrom(a)}}finally{b.commitTransaction("Paste Attributes")}}},b.prototype.toString=function(){return"[Object GPasteAttributesAction]"},a.GPasteAttributesAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.redo",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){var a=ifLocale.get(b.TITLE),c=gApp.getActiveDocument();return c&&c.getEditor().hasRedoState()&&(a+=" "+c.getEditor().getRedoStateName()),a},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"undo_redo"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"z"]},b.prototype.isEnabled=function(){return document.activeElement&&$(document.activeElement).is(":editable")?!0:gApp.getActiveDocument()&&gApp.getActiveDocument().getEditor().hasRedoState()?!0:!1},b.prototype.execute=function(){document.activeElement&&$(document.activeElement).is(":editable")?document.execCommand("redo"):gApp.getActiveDocument().getEditor().redoState()},b.prototype.toString=function(){return"[Object GRedoAction]"},a.GRedoAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.save",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"file"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"S"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();return a&&a.isSaveable()},b.prototype.execute=function(){gApp.getActiveDocument().save()},b.prototype.toString=function(){return"[Object GSaveAction]"},a.GSaveAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.save-all",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"file"},b.prototype.isEnabled=function(){for(var a=gApp.getDocuments(),b=0;b<a.length;++b)if(a[b].isSaveable())return!0;return!1},b.prototype.execute=function(){for(var a=gApp.getDocuments(),b=0;b<a.length;++b)a[b].isSaveable()&&a[b].save()},b.prototype.toString=function(){return"[Object GSaveAllAction]"},a.GSaveAllAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="file.save-as",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_FILE},b.prototype.getGroup=function(){return"file"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"S"]},b.prototype.isEnabled=function(){return!!this._getViableStorage()&&!!gApp.getActiveDocument()},b.prototype.execute=function(){gApp.saveDocumentAs(this._getViableStorage(),gApp.getActiveDocument())},b.prototype._getViableStorage=function(){for(var a=0;a<gravit.storages.length;++a){var b=gravit.storages[a];if(b.isAvailable()&&b.isPrompting()&&b.isSaving()){var c=b.getExtensions();if(!c||c.isEmpty()||c.indexOf("gravit")>=0)return b}}return null},b.prototype.toString=function(){return"[Object GSaveAsAction]"},a.GSaveAsAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.show-rulers",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"show"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"R"]},b.prototype.isEnabled=function(){return!1},b.prototype.isCheckable=function(){return!0},b.prototype.isChecked=function(){return!1},b.prototype.execute=function(){return!1},b.prototype.toString=function(){return"[Object GShowRulersAction]"},a.GShowRulersAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.select-all",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"select"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"A"]},b.prototype.isEnabled=function(){return document.activeElement&&$(document.activeElement).is(":editable")?!0:gApp.getActiveDocument()?!0:!1},b.prototype.execute=function(){if(document.activeElement&&$(document.activeElement).is(":editable"))document.execCommand("selectAll");else{var a=gApp.getActiveDocument().getEditor(),b=gApp.getActiveDocument().getScene(),c=null;c=b.getProperty("singlePage")?b.getActivePage():b;var d=[];c.accept(function(a){a instanceof IFItem&&a.getParent()instanceof IFLayer&&d.push(a)}),a.updateSelection(!1,d)}},b.prototype.toString=function(){return"[Object GSelectAllAction]"},a.GSelectAllAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.show-all-pages",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"render"},b.prototype.isCheckable=function(){return!0},b.prototype.isChecked=function(){var a=gApp.getActiveDocument();return a?!a.getScene().getProperty("singlePage"):!1},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.execute=function(){var a=gApp.getActiveDocument().getScene();a.setProperty("singlePage",!a.getProperty("singlePage"))},b.prototype.toString=function(){return"[Object GShowAllPagesAction]"},a.GShowAllPagesAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.show-grid",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW},b.prototype.getGroup=function(){return"show"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,IFKey.Constant.OPTION,"G"]},b.prototype.isEnabled=function(){return!!gApp.getWindows().getActiveWindow()},b.prototype.isCheckable=function(){return!0},b.prototype.isChecked=function(){var a=gApp.getWindows().getActiveWindow();return a?a.getView().getViewConfiguration().gridVisible===!0:!1},b.prototype.execute=function(){var a=gApp.getWindows().getActiveWindow().getView();a.getViewConfiguration().gridVisible=!a.getViewConfiguration().gridVisible,a.invalidate()},b.prototype.toString=function(){return"[Object GShowGridAction]"},a.GShowGridAction=b}(this),function(a){function b(a){this._type=a,this._title=new IFLocale.Key(b,"title."+a)}IFObject.inherit(b,GAction),b.Type={FullUnit:"full",HalfUnit:"half"},b.ID="arrange.snap-unit",b.prototype._type=null,b.prototype._title=null,b.prototype.getId=function(){return b.ID+"."+this._type},b.prototype.getTitle=function(){return this._title},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_ALIGN},b.prototype.getGroup=function(){return"arrange/snap-unit"},b.prototype.getShortcut=function(){return null},b.prototype.isEnabled=function(a){return a=a||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null),a&&a.length>0},b.prototype.execute=function(a){var c=gApp.getActiveDocument(),d=c.getScene();a||(a=c.getEditor().getSelection()),IFEditor.tryRunTransaction(d,function(){for(var c=0;c<a.length;++c){var d=a[c];if(d.hasMixin(IFElement.Transform)){var e=d.getGeometryBBox();if(e&&!e.isEmpty()){var f=ifMath.round(e.getX(),!0),g=ifMath.round(e.getY(),!0),h=ifMath.round(e.getWidth(),!0),i=ifMath.round(e.getHeight(),!0);this._type===b.Type.HalfUnit&&(f+=.5,g+=.5,h+=.5,i+=.5);var j=(new IFTransform).translated(-e.getX(),-e.getY()).scaled(h/e.getWidth(),i/e.getHeight()).translated(e.getX(),e.getY()).translated(f-e.getX(),g-e.getY());d.transform(j)}}}}.bind(this),ifLocale.get(this.getTitle()))},b.prototype.toString=function(){return"[Object GSnapUnitAction]"},a.GSnapUnitAction=b}(this),function(a){function b(a){this._type=a,this._title=new IFLocale.Key(b,"title."+a)}IFObject.inherit(b,GAction),b.Type={Rotate45Left:"rotate-45-left",Rotate90Left:"rotate-90-left",Rotate180Left:"rotate-180-left",Rotate45Right:"rotate-45-right",Rotate90Right:"rotate-90-right",Rotate180Right:"rotate-180-right",FlipVertical:"flip-vertical",FlipHorizontal:"flip-horizontal"},b.ID="arrange.transform",b.prototype._type=null,b.prototype._title=null,b.prototype.getId=function(){return b.ID+"."+this._type},b.prototype.getTitle=function(){return this._title},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY_TRANSFORM},b.prototype.getGroup=function(){var a="";switch(this._type){case b.Type.Rotate45Left:case b.Type.Rotate90Left:case b.Type.Rotate180Left:a="rotate-left";break;case b.Type.Rotate45Right:case b.Type.Rotate90Right:case b.Type.Rotate180Right:a="rotate-right";break;case b.Type.FlipVertical:case b.Type.FlipHorizontal:a="flip"}return"arrange/transform-"+a},b.prototype.getShortcut=function(){return null},b.prototype.isEnabled=function(a){return a=a||(gApp.getActiveDocument()?gApp.getActiveDocument().getEditor().getSelection():null),a&&a.length>0},b.prototype.execute=function(a){var c=gApp.getActiveDocument(),d=c.getScene();a||(a=c.getEditor().getSelection()),IFEditor.tryRunTransaction(d,function(){for(var c=0;c<a.length;++c){var d=a[c],e=d.getGeometryBBox();if(d.hasMixin(IFElement.Transform)&&e&&!e.isEmpty()){var f=e.getSide(IFRect.Side.CENTER),g=0,h=1,i=1;switch(this._type){case b.Type.Rotate45Left:g=-45;break;case b.Type.Rotate90Left:g=-90;break;case b.Type.Rotate180Left:g=-180;break;case b.Type.Rotate45Right:g=45;break;case b.Type.Rotate90Right:g=90;break;case b.Type.Rotate180Right:g=180;break;case b.Type.FlipVertical:i=-1;break;case b.Type.FlipHorizontal:h=-1}var j=(new IFTransform).translated(-f.getX(),-f.getY()).scaled(h,i).rotated(ifMath.toRadians(g)).translated(f.getX(),f.getY());d.transform(j)}}}.bind(this),ifLocale.get(this.getTitle()))},b.prototype.toString=function(){return"[Object GTransformAction]"},a.GTransformAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="edit.undo",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){var a=ifLocale.get(b.TITLE),c=gApp.getActiveDocument();return c&&c.getEditor().hasUndoState()&&(a+=" "+c.getEditor().getUndoStateName()),a},b.prototype.getCategory=function(){return GApplication.CATEGORY_EDIT},b.prototype.getGroup=function(){return"undo_redo"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"z"]},b.prototype.isEnabled=function(){return document.activeElement&&$(document.activeElement).is(":editable")?!0:gApp.getActiveDocument()&&gApp.getActiveDocument().getEditor().hasUndoState()?!0:!1},b.prototype.execute=function(){document.activeElement&&$(document.activeElement).is(":editable")?document.execCommand("undo"):gApp.getActiveDocument().getEditor().undoState()},b.prototype.toString=function(){return"[Object GUndoAction]"},a.GUndoAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="modify.ungroup",b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_MODIFY},b.prototype.getGroup=function(){return"structure-group"},b.prototype.getShortcut=function(){return[IFKey.Constant.SHIFT,IFKey.Constant.META,"G"]},b.prototype.isEnabled=function(){var a=gApp.getActiveDocument();if(a){var b=a.getEditor().getSelection();if(b)for(var c=0;c<b.length;++c)if(b[c]instanceof IFShapeSet)return!0}return!1},b.prototype.execute=function(){var a=gApp.getActiveDocument().getEditor(),b=a.getSelection();a.beginTransaction();try{for(var c=[],d=0;d<b.length;++d){var e=b[d];if(e instanceof IFShapeSet){var f=e.getParent(),g=e.getNext(),h=e.getChildren();f.removeChild(e);for(var i=0;i<h.length;++i){var j=h[i];e.removeChild(j),f.insertChild(j,g),c.push(j)}}}c.length>0&&a.updateSelection(!1,c)}finally{a.commitTransaction("Ungroup")}},b.prototype.toString=function(){return"[Object GUngroupAction]"},a.GUngroupAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="view.zoom.in",b.TITLE=new IFLocale.Key(b,"title"),b.ZOOM_STEP=2,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW_MAGNIFICATION},b.prototype.getGroup=function(){return"zoom/magnification"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"+"]},b.prototype.isEnabled=function(){var a=gApp.getWindows().getActiveWindow(),b=a?a.getView():null;return b&&b.getZoom()<IFView.options.maxZoomFactor},b.prototype.execute=function(){var a=gApp.getWindows().getActiveWindow().getView(),c=a.getZoom()*b.ZOOM_STEP,d=a.getViewTransform().mapPoint(new IFPoint(a.getWidth()/2,a.getHeight()/2));a.zoomAt(d,c)},b.prototype.toString=function(){return"[Object GZoomInAction]"},a.GZoomInAction=b}(this),function(a){function b(){}IFObject.inherit(b,GAction),b.ID="zoom.out",b.TITLE=new IFLocale.Key(b,"title"),b.ZOOM_STEP=2,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GApplication.CATEGORY_VIEW_MAGNIFICATION},b.prototype.getGroup=function(){return"zoom/magnification"},b.prototype.getShortcut=function(){return[IFKey.Constant.META,"-"]},b.prototype.isEnabled=function(){var a=gApp.getWindows().getActiveWindow(),b=a?a.getView():null;return b&&b.getZoom()>IFView.options.minZoomFactor},b.prototype.execute=function(){var a=gApp.getWindows().getActiveWindow().getView(),c=a.getZoom()/b.ZOOM_STEP,d=a.getViewTransform().mapPoint(new IFPoint(a.getWidth()/2,a.getHeight()/2));a.zoomAt(d,c)},b.prototype.toString=function(){return"[Object GZoomOutAction]"},a.GZoomOutAction=b}(this),function(a){function b(){}IFObject.inherit(b,GColorMatcher),b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GColorMatcher.CATEGORY_HARMONY},b.prototype.match=function(a){for(var b=[],c=a.asHSL(),d=c.slice(),e=22.5,f=3;f>=0;--f)d[0]=ifMath.normalizeAngleDegrees(d[0]+e),b[f]=new IFColor(IFColor.Type.HSL,d);for(var f=0;4>f;++f)c[0]=ifMath.normalizeAngleDegrees(c[0]-e),b.push(new IFColor(IFColor.Type.HSL,c));return b},b.prototype.toString=function(){return"[Object GAnalogousMatcher]"},a.GAnalogousMatcher=b}(this),function(a){function b(){}IFObject.inherit(b,GColorMatcher),b.TITLE=new IFLocale.Key(b,"title"),b.prototype.getTitle=function(){return b.TITLE},b.prototype.getCategory=function(){return GColorMatcher.CATEGORY_HARMONY},b.prototype.match=function(a){var b=a.asHSL();return b[0]=ifMath.normalizeAngleDegrees(b[0]+180),[new IFColor(IFColor.Type.HSL,b)]},b.prototype.toString=function(){return"[Object GComplementaryMatcher]"},a.GComplementaryMatcher=b}(this),function(a){function b(){GExporter.call(this)}IFObject.inherit(b,GExporter),b.prototype.isStandalone=function(){return!1},b.prototype.getName=function(){return"Raster Image"},b.prototype.getExtensions=function(){return["png","jpg"]},b.prototype.exportPart=function(a,b,c,d,e){b=GExporter.parseSize(b);var f=a.getPaintBBox(),g=b.width;"number"==typeof dimension&&(g=dimension);var h=new IFPaintCanvas;h.resize(f.getWidth()*g,f.getHeight()*g);var i=new IFPaintContext;i.canvas=h;
var j=new IFScenePaintConfiguration;j.paintMode=IFScenePaintConfiguration.PaintMode,j.annotations=!1,i.configuration=j,j.clipArea=f,j.pagesClip=a instanceof IFPage,h.prepare(),h.setOrigin(new IFPoint(f.getX()*g,f.getY()*g)),h.setScale(g);try{a instanceof IFSlice?a.getScene().render(i):a.render(i)}finally{h.finish()}var k=h.getBitmap();a instanceof IFSlice&&a.getProperty("trm")&&k.trim();var l=function(a){c.save(d,a,!0)};k.toImageBuffer(this._getImageTypeByExt(e),l)},b.prototype._getImageTypeByExt=function(a){if("png"===a)return IFBitmap.ImageType.PNG;if("jpg"===a)return IFBitmap.ImageType.JPEG;throw new Error("Unknown image extension - "+a)},a.GImageExporter=b}(this),function(a){function b(){GPalette.call(this),this._extensions=[]}IFObject.inherit(b,GPalette),b.ID="export",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._htmlElement=null,b.prototype._controls=null,b.prototype._document=null,b.prototype._element=null,b.prototype._extensions=null,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getGroup=function(){return"properties"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.init=function(a,b){GPalette.prototype.init.call(this,a,b);for(var c=0;c<gravit.exporters.length;++c){var d=gravit.exporters[c];if(!d.isStandalone())for(var e=d.getExtensions(),f=0;f<e.length;++f)this._extensions.push({extension:e[f].toLowerCase(),exporter:d})}this._htmlElement=a,this._controls=b,$("<button></button>").attr("data-action","add").attr("title","Add Export").on("click",function(){var a=this._element.getProperty("export",!0);a=a?a.slice():[],a.push({sz:"1x",sf:"",ex:gravit.exporters[0].getExtensions()[0]}),this._element.setProperty("export",a,!0)}.bind(this)).append($("<span></span>").addClass("fa fa-plus")).appendTo(b)},b.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.Activated){this._document=a.document;var b=this._document.getScene(),c=this._document.getEditor();b.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),c.addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT)}else if(a.type===GApplication.DocumentEvent.Type.Deactivated){var b=this._document.getScene(),c=this._document.getEditor();b.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),c.removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._document=null,this._elements=null,this._updateExports(),this.trigger(GPalette.UPDATE_EVENT)}},b.prototype._afterPropertiesChange=function(a){a.node===this._element&&(a.properties.indexOf("export")>=0||a.properties.indexOf("name")>=0)&&this._updateExports()},b.prototype._updateFromSelection=function(){this._element=null;var a=this._document?this._document.getEditor().getSelection():null;a&&1===a.length?this._element=a[0]:this._document&&(this._element=this._document.getScene().getActivePage()),this._updateExports()},b.prototype._updateExports=function(){if(this._htmlElement.empty(),this._element){var a=this._element.getProperty("name"),b="Export "+this._element.getNodeNameTranslated();a&&""!==a.trim()&&(b+=' "'+a+'"'),b+=" as:",$("<div></div>").addClass("title").text(b).appendTo(this._htmlElement);var c=$("<div></div>").addClass("export-table").appendTo(this._htmlElement),d=function(a,b){for(var d=$("<select></select>"),e=0;e<this._extensions.length;++e){var f=this._extensions[e];$("<option></option>").text(f.extension.toUpperCase()).val(f.extension).appendTo(d)}$("<div></div>").addClass("export-row").data("export-index",e).append($("<div></div>").addClass("export-cell").append($("<input>").css("width","8em").attr("placeholder","Size").val(a.sz).on("change",function(b){a.sz=$(b.target).val()})).append($("<input>").css("width","4em").attr("placeholder","Suffix").val(a.sf).on("change",function(b){a.sf=$(b.target).val()})).append(d.val(a.ex).on("change",function(b){a.ex=$(b.target).val()}))).append($("<div></div>").addClass("export-cell").append($("<button></button>").attr("title","Export this item only").on("click",function(){var b=gApp.getMatchingStorage(!0,!0,a.ex,!1,this._document.getStorage());b&&b.saveResourcePrompt(this._document.getUrl(),this._element.getLabel()+a.sf,[a.ex],function(c){this._getExporterByExt(a.ex).exportPart(this._element,a.sz,b,c,a.ex)}.bind(this))}.bind(this)).append($("<span></span>").addClass("fa fa-external-link-square"))).append($("<button></button>").append($("<span></span>").addClass("fa fa-trash-o")).on("click",function(){var a=this._element.getProperty("export",!0).slice();a.splice(b,1),this._element.setProperty("export",a,!0)}.bind(this)))).appendTo(c)}.bind(this),e=this._element.getProperty("export",!0);if(e&&e.length>0){for(var f=0;f<e.length;++f)d(e[f],f);$("<div></div>").addClass("controls").append($("<button></button>").on("click",function(){var a=gApp.getMatchingStorage(!0,!0,null,!0,this._document.getStorage());a&&a.openDirectoryPrompt(this._document.getUrl(),function(b){for(var c=this._element.getProperty("export",!0),d=0;d<c.length;++d){var e=c[d],f=new URI(b).filename(this._element.getLabel()+e.sf+"."+e.ex).toString();this._getExporterByExt(e.ex).exportPart(this._element,e.sz,a,f,e.ex)}}.bind(this))}.bind(this)).append($("<span></span>").text("Export All..."))).appendTo(this._htmlElement)}}this._controls.find('[data-action="add"]').prop("disabled",!this._element)},b.prototype._getExporterByExt=function(a){a=a.toLowerCase();for(var b=0;b<this._extensions.length;++b)if(this._extensions[b].extension===a)return this._extensions[b].exporter;return null},b.prototype.toString=function(){return"[Object GExportPalette]"},a.GExportPalette=b}(this),function(a){function b(){GPalette.call(this),this._propertyPanels=[]}IFObject.inherit(b,GPalette),b.ID="properties",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._htmlElement=null,b.prototype._propertyPanels=null,b.prototype._document=null,b.prototype._elements=null,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getGroup=function(){return"properties"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.init=function(a,b){GPalette.prototype.init.call(this,a,b),this._htmlElement=a;for(var c=$("<div></div>").addClass("properties-panels").appendTo(this._htmlElement),d=function(a){var b=$("<div></div>").css("display","none").attr("data-available","false").addClass("properties-panel-content"),d=$("<div></div>").addClass("properties-panel-category").css("display","none").attr("data-expanded","true").append($("<div></div>").addClass("title").append($("<i></i>").addClass("fa fa-angle-down")).append($("<span></span>").text(ifLocale.get(a.getCategory()))).on("click",function(){if("true"===b.attr("data-available")){var a=$(this).parents(".properties-panel-category"),c=a.find("i.fa");"none"!==b.css("display")?(b.css("display","none"),c.attr("class","fa fa-angle-right"),a.attr("data-expanded","false")):(b.css("display",""),c.attr("class","fa fa-angle-down"),a.attr("data-expanded","true"))}})).append($("<div></div>").addClass("controls")).appendTo(c);a.init(b,d.find(".controls")),b.appendTo(c),this._propertyPanels.push({category:d,panel:b,properties:a})}.bind(this),e=0;e<gravit.properties.length;++e)d(gravit.properties[e])},b.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.Activated){this._document=a.document;var b=this._document.getScene(),c=this._document.getEditor();c.addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),b.addEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT)}else if(a.type===GApplication.DocumentEvent.Type.Deactivated){var b=this._document.getScene(),c=this._document.getEditor();c.removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),b.removeEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),this._document=null,this._elements=null,this._updatePropertyPanels(),this.trigger(GPalette.UPDATE_EVENT)}},b.prototype._updateFromSelection=function(){this._elements=this._document.getEditor().getSelection(),this._elements&&0!==this._elements.length||(this._elements=[this._document.getScene()]),this._updatePropertyPanels()},b.prototype._afterFlagChange=function(a){a.flag===IFNode.Flag.Active&&this._elements&&1===this._elements.length&&this._elements[0]instanceof IFScene&&this._updatePropertyPanels()},b.prototype._updatePropertyPanels=function(){for(var a=null,b=0;b<this._propertyPanels.length;++b){var c=this._propertyPanels[b],d=this._elements&&0!==this._elements.length?c.properties.update(this._document,this._elements):!1;c.panel.removeClass("last-visible"),d?(c.category.css("display",""),"true"==c.category.attr("data-expanded")&&c.panel.css("display",""),c.panel.attr("data-available","true"),a=c):(c.category.css("display","none"),c.panel.css("display","none"),c.panel.attr("data-available","false"))}a&&a.panel.addClass("last-visible")},b.prototype.toString=function(){return"[Object GPropertiesPalette]"},a.GPropertiesPalette=b}(this),function(a){function b(){GPalette.call(this),this._styleEntries={}}IFObject.inherit(b,GPalette),b.ID="style",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._styleEntries=null,b.prototype._htmlElement=null,b.prototype._document=null,b.prototype._styleDeleteControl=null,b.prototype._styleAddControl=null,b.prototype._styleSelector=null,b.prototype._styleSettings=null,b.prototype._paintsPanel=null,b.prototype._filtersPanel=null,b.prototype._effectsPanel=null,b.prototype._styleElements=null,b.prototype._styles=null,b.prototype._selectedStyleIndex=-1,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getGroup=function(){return"style"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.init=function(a,b){GPalette.prototype.init.call(this,a,b),this._htmlElement=a,this._styleAddControl=$("<button></button>").attr("title","Add new style").on("click",function(a){$("<div></div>").css({width:"250px"}).addClass("g-style-list").gStylePanel({nullStyle:$("<span></span>").addClass("fa fa-plus-circle").css({"font-size":"24px","line-height":"30px"}),nullName:"Add new style to element"}).gStylePanel("attach",this._document.getScene().getStyleCollection()).gOverlay({releaseOnClose:!0}).gOverlay("open",a.target).on("close",function(){$(this).gStylePanel("detach")}).on("stylechange",function(a,b){$(a.target).gOverlay("close");var c=-1,d=this._document.getEditor();d.beginTransaction();try{for(var e=0;e<this._styleElements.length;++e){var f=null;b?(f=new IFLinkedStyle,f.setProperty("ref",b.getReferenceId())):f=new IFInlineStyle,this._styleElements[e].getStyleSet().appendChild(f),0>c&&(c=this._getStyleIndex(f),this._setSelectedStyle(c))}}finally{d.commitTransaction("Add Style")}}.bind(this))}.bind(this)).append($("<span></span>").addClass("fa fa-plus")).appendTo(b),this._styleDeleteControl=$("<button></button>").attr("title","Remove hidden styles").on("click",function(){var a=this._document.getEditor();a.beginTransaction();try{for(var b=this._styles.slice(),c=0;c<b.length;++c)for(var d=b[c].slice(),e=0;e<d.length;++e)d[e].getProperty("vs")===!1&&d[e].getParent().removeChild(d[e])}finally{a.commitTransaction("Removed Hidden Styles")}}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")).appendTo(b);for(var c=[],d=[],e=0;e<gravit.styleEntries.length;++e){var f=gravit.styleEntries[e],g=f.getEntryClass();this._styleEntries[IFObject.getTypeId(g)]=f,IFFilterEntry.prototype.isPrototypeOf(f.getEntryClass().prototype)?c.push({entry:f,name:ifLocale.get(f.getEntryName())}):IFEffectEntry.prototype.isPrototypeOf(f.getEntryClass().prototype)?d.push({entry:f,name:ifLocale.get(f.getEntryName()),rootClass:IFEffectEntry}):IFVEffectEntry.prototype.isPrototypeOf(f.getEntryClass().prototype)&&d.push({entry:f,name:ifLocale.get(f.getEntryName()),rootClass:IFVEffectEntry})}c.sort(function(a,b){return a.name.localeCompare(b.name)}),d.sort(function(a,b){return a.rootClass===b.rootClass?a.name.localeCompare(b.name):a.rootClass===IFVEffectEntry?-1:1});var h=function(a,b,c){c.createAddItem("Add "+b,function(){this._modifyEachSelectedStyle(function(b){b.getActualStyle().appendChild(new a)})}.bind(this))}.bind(this);this._styleSelector=$("<div></div>").addClass("style-selector").gStylePanel({allowDrop:!0,previewWidth:40,previewHeight:40}).on("stylechange",function(a,b){this._setSelectedStyle(this._getStyleIndex(b))}.bind(this)).on("styledragaway",function(a,b){var c=this._getStyleIndex(b),d=this._styles[c],e=this._document.getEditor();e.beginTransaction();try{for(var f=0;f<d.length;++f)d[f].getParent().removeChild(d[f])}finally{e.commitTransaction("Remove Style")}}.bind(this)).on("stylemove",function(a,b,c){var d=this._getStyleIndex(b),e=this._getStyleIndex(c),f=this._styles[d].slice(),g=this._styles[e].slice();this._selectedStyleIndex=-1;var h=this._document.getEditor();h.beginTransaction();try{for(var i=0;i<f.length;++i){var j=f[i].getParent();j.removeChild(f[i]),j.insertChild(f[i],e>d?g[i].getNext():g[i])}}finally{h.commitTransaction("Move Style")}this._setSelectedStyle(this._getStyleIndex(b))}.bind(this)).appendTo(this._htmlElement),this._styleSettings=$("<div></div>").addClass("style-settings").append($("<div></div>").addClass("visibility").append($("<span></span>").addClass("fa").attr("title","Toggle Style Visibility").on("click",function(){var a=this._styles[this._selectedStyleIndex][0].getProperty("vs")===!1;this._modifyEachSelectedStyle(function(b){b.setProperty("vs",a)})}.bind(this)))).append($("<div></div>").css("width","100%").append($("<select></select>").attr("data-property","blm").gBlendMode().on("change",function(a){var b=$(a.target).val();this._modifyEachSelectedStyle(function(a){a.setProperty("blm",b)})}.bind(this))).append($("<input>").attr("data-property","opc").css("width","3em").on("change",function(a){var b=IFLength.parseEquationValue($(a.target).val());null!==b?(b=0>b?0:b>100?100:b,b/=100,this._modifyEachSelectedStyle(function(a){a.setProperty("opc",b)})):this._updateStyleSettings()}.bind(this))).append($("<select></select>").attr("data-property","tp").append($("<option></option>").attr("value",IFAppliedStyle.Type.Content).text("Content")).append($("<option></option>").attr("value",IFAppliedStyle.Type.Knockout).text("Knockout")).on("change",function(a){var b=$(a.target).val();this._modifyEachSelectedStyle(function(a){a.setProperty("tp",b)})}.bind(this)))).append($("<div></div>").css("text-align","right").append($("<button></button>").attr("data-property","__link").on("click",function(){this._toggleStyleLink()}.bind(this)).append($("<span></span>").addClass("fa")))).appendTo(this._htmlElement),this._paintsPanel=$("<div></div>").addClass("style-entries-panel").append($("<div></div>").addClass("style-entries-panel-table")),$("<div></div>").gPanel({title:"Fills & Borders",content:this._paintsPanel,controls:[$("<button></button>").attr("title","Add Stroke").on("click",function(){this._modifyEachSelectedStyle(function(a){a.getActualStyle().appendChild(new IFStrokePaint)})}.bind(this)).append($("<span></span>").addClass("fa fa-pencil")),$("<button></button>").attr("title","Add Fill").on("click",function(){this._modifyEachSelectedStyle(function(a){a.getActualStyle().appendChild(new IFFillPaint)})}.bind(this)).append($("<span></span>").addClass("fa fa-stop")),$("<button></button>").attr("title","Remove hidden entries").on("click",function(){this._removeHiddenEntries([IFPaintEntry])}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o"))]}).appendTo(this._htmlElement);for(var i=new GMenu,e=0;e<c.length;++e)h(c[e].entry.getEntryClass(),c[e].name,i);this._filtersPanel=$("<div></div>").addClass("style-entries-panel").append($("<div></div>").addClass("style-entries-panel-table")).appendTo(this._htmlElement),$("<div></div>").gPanel({title:"Filters",content:this._filtersPanel,controls:[$("<button></button>").gMenuButton({menu:i,arrow:!1}).append($("<span></span>").addClass("fa fa-plus")),$("<button></button>").attr("title","Remove hidden entries").on("click",function(){this._removeHiddenEntries([IFFilterEntry])}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o"))]}).appendTo(this._htmlElement);for(var j=new GMenu,k=!1,e=0;e<d.length;++e){var g=d[e].entry.getEntryClass(),l=d[e].rootClass;k||l!==IFEffectEntry||(j.createAddDivider(),k=!0),h(g,d[e].name,j)}this._effectsPanel=$("<div></div>").addClass("style-entries-panel").append($("<div></div>").addClass("style-entries-panel-table")).appendTo(this._htmlElement),$("<div></div>").gPanel({title:"Effects",content:this._effectsPanel,controls:[$("<button></button>").gMenuButton({menu:j,arrow:!1}).append($("<span></span>").addClass("fa fa-plus")),$("<button></button>").attr("title","Remove hidden entries").on("click",function(){this._removeHiddenEntries([IFEffectEntry,IFVEffectEntry])}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o"))]}).appendTo(this._htmlElement)},b.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.Activated){this._document=a.document;var b=this._document.getScene(),c=this._document.getEditor();b.addEventListener(IFNode.AfterInsertEvent,this._afterInsert,this),b.addEventListener(IFNode.BeforeRemoveEvent,this._beforeRemove,this),b.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),b.addEventListener(IFStyle.StyleChangeEvent,this._styleChange,this),c.addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT)}else if(a.type===GApplication.DocumentEvent.Type.Deactivated){var b=this._document.getScene(),c=this._document.getEditor();c.removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection),b.removeEventListener(IFNode.AfterInsertEvent,this._afterInsert,this),b.removeEventListener(IFNode.BeforeRemoveEvent,this._beforeRemove,this),b.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),b.removeEventListener(IFNode.StyleChangeEvent,this._styleChange,this),this._document=null,this._styleElements=null,this._styles=null,this._selectedStyleIndex=-1,this._updateSelectedStyle(),this.trigger(GPalette.UPDATE_EVENT)}},b.prototype._afterInsert=function(a){if(a.node instanceof IFStyleEntry){var b=a.node.getOwnerStyle();b&&this._isSelectedStyle(b)&&this._insertEntryRow(a.node)}else a.node instanceof IFStyle&&this._insertStyles(a.node)},b.prototype._beforeRemove=function(a){if(a.node instanceof IFStyleEntry){var b=a.node.getOwnerStyle();b&&this._isSelectedStyle(b)&&this._removeEntryRow(a.node)}else a.node instanceof IFStyle&&this._removeStyle(a.node)},b.prototype._afterPropertiesChange=function(a){if(a.node instanceof IFStyleEntry){var b=a.node.getOwnerStyle();b&&this._isSelectedStyle(b)&&this._updateEntryRow(a.node)}else a.node instanceof IFStyle&&this._isSelectedStyle(a.node)&&this._updateStyleSettings()},b.prototype._styleChange=function(a){var b=this._getStyleIndex(a.style,!1);if(b>=0&&b===this._selectedStyleIndex){var c=this._styles[b][0];this._styleSelector.gStylePanel("updateStyle",c)}},b.prototype._updateFromSelection=function(){this._styleElements=null,this._styles=null,this._selectedStyleIndex=-1;var a=this._document.getEditor().getSelection();if(a&&a.length>0)for(var b=0;b<a.length;++b){var c=a[b];c.hasMixin(IFElement.Style)&&(this._styleElements||(this._styleElements=[]),this._styleElements.push(c))}this._styleSelector.gStylePanel("clear"),this._styleElements&&this._insertStyles(),this._styles||this._setSelectedStyle(-1)},b.prototype._setSelectedStyle=function(a){this._styleSelector.gStylePanel("value",a>=0?this._styles[a][0]:null),this._selectedStyleIndex=a,this._updateSelectedStyle()},b.prototype._modifyEachSelectedStyle=function(a,b){if("number"==typeof b||this._selectedStyleIndex>=0){var c=this._document.getEditor();c.beginTransaction();try{this._visitEachSelectedStyle(a,b)}finally{c.commitTransaction("Modify Style(s)")}}},b.prototype._visitEachSelectedStyle=function(a,b){if("number"==typeof b||this._selectedStyleIndex>=0)for(var c=this._styles[this._selectedStyleIndex>=0?this._selectedStyleIndex:b].slice(),d=0;d<c.length;++d)a(c[d])},b.prototype._insertStyles=function(){var a=function(a,b){this._styleSelector.gStylePanel("insertStyle",a,b)}.bind(this),b=function(b){var c=!1;if(e){for(var d=0;d<b.length;++d)if(b[d]===e){c=!0;break}}else c=!0;if(c&&this._styles&&this._styles.length>0)for(var d=0;d<this._styles.length;++d)if(this._styles[d][0]===b[0]){c=!1;break}if(c){for(var e=b[0],f=-1,g=e.getNext();null!==g;g=g.getNext())if(g instanceof IFStyle){f=this._getStyleIndex(g);break}this._styles||(this._styles=[]),f>=0?this._styles.splice(f,0,b):this._styles.push(b),a(b[0],f)}}.bind(this);if(this._styleElements&&0!==this._styleElements.length){if(1===this._styleElements.length)for(var c=this._styleElements[0].getStyleSet(),d=c.getFirstChild();null!==d;d=d.getNext())d instanceof IFStyle&&b([d]);else{for(var e=[],f=[],g=0;g<this._styleElements.length;++g)for(var c=this._styleElements[g].getStyleSet(),h=!1,d=c.getFirstChild();null!==d;d=d.getNext())if(d instanceof IFLinkedStyle){for(var i=!1,j=0;j<e.length;++j)if(e[j][0].getProperty("ref")===d.getProperty("ref")){e[j].push(d),i=!0;break}i||e.push([d])}else d instanceof IFInlineStyle&&(h||f.push(d),h=!0);f.length===this._styleElements.length&&b(f);for(var g=0;g<e.length;++g)e[g].length===this._styleElements.length&&b(e[g])}this._selectedStyleIndex<0&&this._styles&&this._styles.length>0&&this._setSelectedStyle(0)}},b.prototype._removeStyle=function(a){if(this._styles){var b=this._getStyleIndex(a);b>=0&&(this._styleSelector.gStylePanel("removeStyle",this._styles[b][0]),this._styles.splice(b,1),b===this._selectedStyleIndex?this._setSelectedStyle(this._styles.length>0?0:-1):b<this._selectedStyleIndex&&(this._selectedStyleIndex-=1),0===this._styles.length&&(this._styles=null,this._styleSelector.css("display","none")))}},b.prototype._isSelectedStyle=function(a){return this._selectedStyleIndex>=0&&this._getStyleIndex(a,!0)===this._selectedStyleIndex},b.prototype._getStyleIndex=function(a,b){if(!this._styles||0===this._styles.length)return-1;for(var c=0;c<this._styles.length;++c)for(var d=0;d<this._styles[c].length;++d)if(a instanceof IFSharedStyle&&b){if(this._styles[c][d]instanceof IFLinkedStyle&&this._styles[c][d].getProperty("ref")===a.getReferenceId())return c}else if(this._styles[c][d]===a)return c;return-1},b.prototype._removeHiddenEntries=function(a){this._modifyEachSelectedStyle(function(b){for(var b=b.getActualStyle(),c=[],d=b.getFirstChild();null!==d;d=d.getNext())if(d instanceof IFStyleEntry&&d.getProperty("vs")===!1)for(var e=0;e<a.length;++e)if(a[e].prototype.isPrototypeOf(d)){c.push(d);break}for(var f=0;f<c.length;++f)b.removeChild(c[f])})},b.prototype._toggleStyleLink=function(){var a=this._styles[this._selectedStyleIndex][0];if(a instanceof IFLinkedStyle){var b=this._document.getEditor(),c=this._document.getScene();b.beginTransaction();try{var d=a.getActualStyle(),e=this._selectedStyleIndex;this._visitEachSelectedStyle(function(a){var b=new IFInlineStyle;b.transferProperties(a,[IFAppliedStyle.GeometryProperties,IFAppliedStyle.VisualProperties]);for(var c=d.getFirstChild();null!==c;c=c.getNext())c instanceof IFStyleEntry&&b.appendChild(c.clone());a.getParent().insertChild(b,a),a.getParent().removeChild(a)}),this._setSelectedStyle(e)}finally{b.commitTransaction("Unlink Style")}}else{var c=this._document.getScene(),f="Style-"+(c.getStyleCollection().queryCount("> sharedStyle")+1).toString(),g=prompt("Enter a name for the new style:",f);if(null!==g){""===g.trim()&&(g=f);var b=this._document.getEditor();b.beginTransaction();try{var d=new IFSharedStyle;d.setProperty("name",g);for(var h=a.getFirstChild();null!==h;h=h.getNext())h instanceof IFStyleEntry&&d.appendChild(h.clone());c.getStyleCollection().appendChild(d);var e=this._selectedStyleIndex;this._visitEachSelectedStyle(function(a){var b=new IFLinkedStyle;b.transferProperties(a,[IFAppliedStyle.GeometryProperties,IFAppliedStyle.VisualProperties]),b.setProperty("ref",d.getReferenceId()),a.getParent().insertChild(b,a),a.getParent().removeChild(a)}),this._setSelectedStyle(e)}finally{b.commitTransaction("Link Style")}}}},b.prototype._updateSelectedStyle=function(){this._styleSelector.css("display",this._styles?"":"none"),this._updateStyleSettings(),this._updateEntries()},b.prototype._updateStyleSettings=function(){if(this._styleSettings.css("display","none"),this._styleDeleteControl.prop("disabled",!0),this._styleAddControl.prop("disabled",null===this._styleElements||0===this._styleElements.length),this._selectedStyleIndex>=0){this._styleSettings.css("display","");var a=this._styles[this._selectedStyleIndex][0];this._styleSettings.find(".visibility > span").toggleClass("fa-eye",1==a.getProperty("vs")).toggleClass("fa-eye-slash",0==a.getProperty("vs")),this._styleSettings.find('[data-property="__link"]').attr("title",a instanceof IFLinkedStyle?"Unlink style":"Link style").find("> span").toggleClass("fa-link",!(a instanceof IFLinkedStyle)).toggleClass("fa-unlink",a instanceof IFLinkedStyle),this._styleDeleteControl.prop("disabled",!1),this._styleSettings.find('[data-property="blm"]').val(a.getProperty("blm")),this._styleSettings.find('[data-property="opc"]').val(ifUtil.formatNumber(100*a.getProperty("opc"))),this._styleSettings.find('[data-property="tp"]').val(a.getProperty("tp"))}},b.prototype._updateEntries=function(){if(this._paintsPanel.closest(".g-panel").css("display","none"),this._paintsPanel.find(".style-entries-panel-table").empty(),this._filtersPanel.closest(".g-panel").css("display","none"),this._filtersPanel.find(".style-entries-panel-table").empty(),this._effectsPanel.closest(".g-panel").css("display","none"),this._effectsPanel.find(".style-entries-panel-table").empty(),this._selectedStyleIndex>=0){this._paintsPanel.closest(".g-panel").css("display",""),this._filtersPanel.closest(".g-panel").css("display",""),this._effectsPanel.closest(".g-panel").css("display","");for(var a=this._styles[this._selectedStyleIndex][0].getActualStyle(),b=a.getFirstChild();null!==b;b=b.getNext())b instanceof IFStyleEntry&&this._insertEntryRow(b)}};var c=null,d=!1;b.prototype._insertEntryRow=function(a){var b=this._styleEntries[IFObject.getTypeId(a)];if(b){var e=this._getPanelFromEntry(a),f=e.find(".style-entries-panel-table"),g=function(){this._assignEntryRow(a)}.bind(this),h=function(){this._updateEntryRow(a)}.bind(this),i=b.createContent(this._document.getScene(),g,h),j=function(a,b){return a&&b&&a!==b&&a.parentNode===b.parentNode},k=$("<div></div>").data("entry",a).attr("draggable","true").on("dragstart",function(a){var b=$(this),e=a.originalEvent;e.stopPropagation(),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",""),this.className="drag",c=this,d=!1,b.closest(".style-entries-panel-table").find("> div").each(function(a,b){$(b).append($("<div></div>").addClass("drag-overlay").on("dragenter",function(){j(c,this.parentNode)&&$(this).parent().addClass("drop")}).on("dragleave",function(){j(c,this.parentNode)&&$(this).parent().removeClass("drop")}).on("dragover",function(a){var b=a.originalEvent;b.preventDefault(),b.stopPropagation(),b.dataTransfer.dropEffect="move"}).on("drop",function(){var a=($(this),$(this.parentNode));d=!0,a.removeClass("drop"),a.closest(".style-entries-panel-table").find(".drag-overlay").remove(),j(c,this.parentNode)}))})}).on("dragend",function(b){var e=$(this),f=b.originalEvent;f.stopPropagation(),e.closest(".style-entries-panel-table").find(".drag-overlay").remove(),d||a.getParent().removeChild(a),this.className="",c=null,d=!1}).append($("<div></div>").addClass("visibility").append($("<span></span>").attr("title","Toggle visibility").on("click",function(){a.setProperty("vs",!a.getProperty("vs"))}))).append($("<div></div>").addClass("contents").append(i)).appendTo(f);this._updateEntryRow(a,k)}},b.prototype._removeEntryRow=function(a,b){b=b||this._getRowForEntry(a),b&&b.remove()},b.prototype._updateEntryRow=function(a,b){var c=this._styleEntries[IFObject.getTypeId(a)];c&&(b=b||this._getRowForEntry(a),b&&(b.find(".visibility span").attr("class","fa fa-eye"+(a.getProperty("vs")?"":"-slash")),c.updateProperties(b.find(".contents > :first-child"),b.data("entry"),this._document.getScene())))},b.prototype._assignEntryRow=function(a,b){var c=this._styleEntries[IFObject.getTypeId(a)];if(c&&(b=b||this._getRowForEntry(a))){var d=this._document.getEditor();d.beginTransaction();try{c.assignProperties(b.find(".contents > :first-child"),a,this._document.getScene())}finally{d.commitTransaction("Modify "+c.getEntryName()+" Style")}}},b.prototype._getRowForEntry=function(a){var b=this._getPanelFromEntry(a),c=b.find(".style-entries-panel-table"),d=null;return c.find("> div").each(function(b,c){var e=$(c);return e.data("entry")===a?(d=e,!1):void 0}),d},b.prototype._getPanelFromEntry=function(a){return a instanceof IFPaintEntry?this._paintsPanel:a instanceof IFFilterEntry?this._filtersPanel:a instanceof IFEffectEntry||a instanceof IFVEffectEntry?this._effectsPanel:void 0},b.prototype.toString=function(){return"[Object GStylePalette]"},a.GStylePalette=b}(this),function(a){function b(){GPalette.call(this),this._transformPanels=[]}IFObject.inherit(b,GPalette),b.ID="transform",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._htmlElement=null,b.prototype._transformPanels=null,b.prototype._document=null,b.prototype._elements=null,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getGroup=function(){return"properties"},b.prototype.isEnabled=function(){return!!gApp.getActiveDocument()},b.prototype.init=function(a,b){GPalette.prototype.init.call(this,a,b),this._htmlElement=a;for(var c=$("<div></div>").addClass("transform-panels").appendTo(this._htmlElement),d=function(a){var b=$("<div></div>").css("display","none").attr("data-available","false").addClass("transform-panel-content"),d=$("<div></div>").addClass("transform-panel-category").css("display","none").attr("data-expanded","true").append($("<div></div>").addClass("title").append($("<i></i>").addClass("fa fa-angle-down")).append($("<span></span>").text(ifLocale.get(a.getCategory()))).on("click",function(){if("true"===b.attr("data-available")){var a=$(this).parents(".transform-panel-category"),c=a.find("i.fa");"none"!==b.css("display")?(b.css("display","none"),c.attr("class","fa fa-angle-right"),a.attr("data-expanded","false")):(b.css("display",""),c.attr("class","fa fa-angle-down"),a.attr("data-expanded","true"))}})).append($("<div></div>").addClass("controls")).appendTo(c);a.init(b,d.find(".controls")),b.appendTo(c),this._transformPanels.push({category:d,panel:b,transformer:a})}.bind(this),e=0;e<gravit.transformers.length;++e)d(gravit.transformers[e])},b.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.Activated){this._document=a.document;var b=this._document.getEditor();b.addEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._updateFromSelection(),this.trigger(GPalette.UPDATE_EVENT)}else if(a.type===GApplication.DocumentEvent.Type.Deactivated){var b=this._document.getEditor();b.removeEventListener(IFEditor.SelectionChangedEvent,this._updateFromSelection,this),this._document=null,this._elements=null,this._updateTransformPanels(),this.trigger(GPalette.UPDATE_EVENT)}},b.prototype._updateFromSelection=function(){this._elements=null;var a=this._document.getEditor().getSelection();if(a)for(var b=0;b<a.length;++b)a[b].hasMixin(IFElement.Transform)&&(this._elements||(this._elements=[]),this._elements.push(a[b]));this._updateTransformPanels()},b.prototype._updateTransformPanels=function(){for(var a=null,b=0;b<this._transformPanels.length;++b){var c=this._transformPanels[b],d=this._elements&&0!==this._elements.length?c.transformer.update(this._document,this._elements):!1;
c.panel.removeClass("last-visible"),d?(c.category.css("display",""),"true"==c.category.attr("data-expanded")&&c.panel.css("display",""),c.panel.attr("data-available","true"),a=c):(c.category.css("display","none"),c.panel.css("display","none"),c.panel.attr("data-available","false"))}a&&a.panel.addClass("last-visible")},b.prototype.toString=function(){return"[Object GTransformPalette]"},a.GTransformPalette=b}(this),function(a){function b(){this._elements=[]}IFObject.inherit(b,GProperties),b.prototype._controls=null,b.prototype._panel=null,b.prototype._document=null,b.prototype._elements=null,b.prototype._elementsBBox=null,b.prototype._firstElementsBBox=null,b.prototype.getCategory=function(){return"Dimensions"},b.prototype.init=function(a,b){this._controls=b,this._panel=a;var c=function(a){var b=this;return $("<input>").attr("type","text").attr("data-dimension",a).css("width","5em").on("change",function(){b._assignDimension(a,$(this).val())})}.bind(this),d=function(a){var b=this,c="selection"===a?"Selection Dimensions":"Individual Elements' Dimensions",d="selection"===a?"Selection":"Individual";return $("<button></button>").addClass("g-button "+("selection"===a?"g-active":"")).attr("title",c).attr("data-apply",a).text(d).on("click",function(){$(this).hasClass("g-active")||("selection"===a?(b._controls.find('button[data-apply="objects"]').removeClass("g-active"),b._controls.find('button[data-apply="selection"]').addClass("g-active")):(b._controls.find('button[data-apply="selection"]').removeClass("g-active"),b._controls.find('button[data-apply="objects"]').addClass("g-active")),b._updateDimensions(!0))})}.bind(this);b.append(d("selection")).append(d("objects")),$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("X:")).append($("<td></td>").append(c("x"))).append($("<td></td>").addClass("label").text("Y:")).append($("<td></td>").append(c("y")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("W:")).append($("<td></td>").append(c("w"))).append($("<td></td>").addClass("label").text("H:")).append($("<td></td>").append(c("h")))).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFElement.GeometryChangeEvent,this._geometryChange),this._document=null),this._elements=[];for(var c=0;c<b.length;++c)b[c]instanceof IFElement&&b[c].hasMixin(IFElement.Transform)&&this._elements.push(b[c]);return this._elements.length>0?(this._document=a,this._document.getScene().addEventListener(IFElement.GeometryChangeEvent,this._geometryChange,this),this._controls.find('button[data-apply="selection"]').css("display",this._elements.length>1?"":"none"),this._controls.find('button[data-apply="objects"]').css("display",this._elements.length>1?"":"none"),this._updateDimensions(),!0):!1},b.prototype._geometryChange=function(a){(a.type===IFElement.GeometryChangeEvent.Type.After||a.type===IFElement.GeometryChangeEvent.Type.Child)&&this._elements.indexOf(a.element)>=0&&this._updateDimensions()},b.prototype._updateDimensions=function(a){var b=function(a,b){this._panel.find('input[data-dimension="'+a+'"]').val(this._document.getScene().pointToString(b))}.bind(this);if(!a){this._elementsBBox=null,this._firstElementsBBox=null;for(var c=0;c<this._elements.length;++c){var d=this._elements[c].getGeometryBBox();d&&!d.isEmpty()&&(this._elementsBBox=this._elementsBBox?this._elementsBBox.united(d):d,this._firstElementsBBox||(this._firstElementsBBox=d))}this._elementsBBox||(this._elementsBBox=new IFRect(0,0,0,0),this._firstElementsBBox=this._elementsBBox)}var e=this._controls.find('button[data-apply="selection"]').hasClass("g-active");e?(b("x",this._elementsBBox.getX()),b("y",this._elementsBBox.getY()),b("w",this._elementsBBox.getWidth()),b("h",this._elementsBBox.getHeight())):(b("x",this._firstElementsBBox.getX()),b("y",this._firstElementsBBox.getY()),b("w",this._firstElementsBBox.getWidth()),b("h",this._firstElementsBBox.getHeight()))},b.prototype._assignDimension=function(a,b){var c=this._document.getScene().stringToPoint(b);if(null===c||"number"!=typeof c||("w"===a||"h"==a)&&0>=c)return void this._updateDimensions();var d=function(b){switch(a){case"x":return(new IFTransform).translated(c-b.getX(),0);case"y":return(new IFTransform).translated(0,c-b.getY());case"w":return(new IFTransform).translated(-b.getX(),-b.getY()).scaled(c/b.getWidth(),1).translated(b.getX(),b.getY());case"h":return(new IFTransform).translated(-b.getX(),-b.getY()).scaled(1,c/b.getHeight()).translated(b.getX(),b.getY())}},e=this._controls.find('button[data-apply="selection"]').hasClass("g-active"),f=this._document.getEditor();f.beginTransaction();try{if(e)for(var g=d(this._elementsBBox),h=0;h<this._elements.length;++h)this._elements[h].transform(g);else for(var h=0;h<this._elements.length;++h){var g=d(this._elements[h].getGeometryBBox());this._elements[h].transform(g)}}finally{f.commitTransaction("Modify Dimensions")}},b.prototype.toString=function(){return"[Object GDimensionsProperties]"},a.GDimensionsProperties=b}(this),function(a){function b(){}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype.getCategory=function(){return"Document"},b.prototype.init=function(a,b){this._panel=a,$("<button></button>").attr("title","More Settings").on("click",function(a){var b=$(a.target).closest("button");b.toggleClass("g-active",!b.hasClass("g-active")),this._showMore(b.hasClass("g-active"))}.bind(this)).append($("<span></span>").addClass("fa fa-cog")).appendTo(b);var c=function(a){var b=this;if("unit"===a)return $("<select></select>").attr("data-property",a).gUnit().on("change",function(){b._assignProperty(a,$(this).val())});if("unitSnap"===a)return $("<select></select>").attr("data-property",a).append($("<option></option>").attr("value",IFScene.UnitSnap.None).text("None")).append($("<option></option>").attr("value",IFScene.UnitSnap.Full).text("Full")).append($("<option></option>").attr("value",IFScene.UnitSnap.Half).text("Half")).on("change",function(){b._assignProperty(a,$(this).val())});if("gridSizeX"===a||"gridSizeY"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","3em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null!==c&&"number"==typeof c&&c>=1?b._assignProperty(a,0>c?0:c):b._updateProperties()});if("gridActive"===a)return $("<div></div>").css("width","4em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property",a).on("change",function(){b._assignProperty(a,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"On","data-off":"Off"})));if("crDistSmall"===a||"crDistBig"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","3em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null!==c&&"number"==typeof c&&c>=1?b._assignProperty(a,0>c?0:c):b._updateProperties()});if("crConstraint"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","3em").on("change",function(){var c=IFLength.parseEquationValue($(this).val());null!==c?(c=ifMath.normalizeAngleRadians(ifMath.toRadians(c)),b._assignProperty(a,c)):b._updateProperties()});if("snapDist"===a||"pickDist"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","3em").on("change",function(){var c=parseInt($(this).val());isNaN(c)?b._updateProperties():b._assignProperty(a,c)});if("clspace"===a)return $("<select></select>").attr("data-property",a).append($("<option></option>").attr("value",IFColorSpace.RGB).text("RGB")).append($("<option></option>").attr("value",IFColorSpace.CMYK).text("CMYK")).on("change",function(){b._assignProperty(a,$(this).val())});if("pathImage"===a||"pathFont"===a||"pathExport"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","100%").on("change",function(){b._assignProperty(a,$(this).val())});throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Unit/Snap:")).append($("<td></td>").attr("colspan","3").append(c("unit")).append(c("unitSnap")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Grid:")).append($("<td></td>").append(c("gridSizeX").attr("title","Horizontal Grid-Size")).append(c("gridSizeY").attr("title","Vertical Grid-Size"))).append($("<td></td>").attr("colspan","2").css("text-align","right").append(c("gridActive")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<h1></h1>").addClass("g-divider").text("Defaults")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Cursor:")).append($("<td></td>").append(c("crDistSmall").attr("title","Small Distance when moving via Arrow-Keys")).append(c("crDistBig").attr("title","Large Distance when moving via Arrow-Keys"))).append($("<td></td>").addClass("label").text("Â°")).append($("<td></td>").append(c("crConstraint").attr("title","Constraints when moving via Shift in Degrees")))).append($("<tr></tr>").append($("<td></td>").addClass("label").html('<span class="fa fa-arrows"></span> / <span class="fa fa-magnet"></span>')).append($("<td></td>").attr("colspan","3").append(c("pickDist").attr("title","Pick Distance in Pixels")).append(c("snapDist").attr("title","Snap Distance")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").attr("colspan","3").append($("<h1></h1>").addClass("g-divider").text("Color")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Color:")).append($("<td></td>").attr("colspan","3").append(c("clspace").attr("title","Default Colorspace of document")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").attr("colspan","3").append($("<h1></h1>").addClass("g-divider").text("Pathes")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Images")).append($("<td></td>").attr("colspan","3").append(c("pathImage").attr("title","Path for imported image assets")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Fonts")).append($("<td></td>").attr("colspan","3").append(c("pathFont").attr("title","Path for imported font assets")))).append($("<tr></tr>").attr("data-more","yes").append($("<td></td>").addClass("label").text("Export")).append($("<td></td>").attr("colspan","3").append(c("pathExport").attr("title","Path for exported assets")))).appendTo(a),this._showMore(!1)},b.prototype.update=function(a,b){return this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),1===b.length&&b[0]instanceof IFScene?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){a.node===this._document.getScene()&&this._updateProperties()},b.prototype._updateProperties=function(){var a=this._document.getScene();this._panel.find('select[data-property="unit"]').val(a.getProperty("unit")),this._panel.find('select[data-property="unitSnap"]').val(a.getProperty("unitSnap")),this._panel.find('input[data-property="gridSizeX"]').val(a.pointToString(a.getProperty("gridSizeX"))),this._panel.find('input[data-property="gridSizeY"]').val(a.pointToString(a.getProperty("gridSizeY"))),this._panel.find('input[data-property="gridActive"]').prop("checked",a.getProperty("gridActive")),this._panel.find('input[data-property="crDistSmall"]').val(a.pointToString(a.getProperty("crDistSmall"))),this._panel.find('input[data-property="crDistBig"]').val(a.pointToString(a.getProperty("crDistBig"))),this._panel.find('input[data-property="crConstraint"]').val(ifUtil.formatNumber(ifMath.toDegrees(a.getProperty("crConstraint")),2)),this._panel.find('input[data-property="snapDist"]').val(a.pointToString(a.getProperty("snapDist"))),this._panel.find('input[data-property="pickDist"]').val(a.pointToString(a.getProperty("pickDist"))),this._panel.find('select[data-property="clspace"]').val(a.getProperty("clspace")),this._panel.find('input[data-property="pathImage"]').val(a.getProperty("pathImage")),this._panel.find('input[data-property="pathFont"]').val(a.getProperty("pathFont")),this._panel.find('input[data-property="pathExport"]').val(a.getProperty("pathExport"))},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{this._document.getScene().setProperties(a,b)}finally{c.commitTransaction("Modify Document Properties")}},b.prototype._showMore=function(a){this._panel.find("[data-more]").each(function(b,c){$(c).css("display",a?"":"none")})},b.prototype.toString=function(){return"[Object GDocumentProperties]"},a.GDocumentProperties=b}(this),function(a){function b(){this._polygons=[]}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._polygons=null,b.prototype.getCategory=function(){return"Polygon"},b.prototype.init=function(a){this._panel=a;var b=function(a){var b=this;if("pts"===a)return $("<input>").attr("type","text").attr("data-property","pts").css("width","3em").on("change",function(){var c=parseInt($(this).val());if(isNaN(c))b._updateProperties();else{var d=ifMath.normalizeAngleRadians(b._polygons[0].getProperty("oa")+Math.PI/c);b._assignProperties([a,"ia"],[ifMath.normalizeValue(c,2,360),d])}});if("evenodd"===a)return $("<div></div>").css("width","6em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property",a).on("change",function(){b._assignProperty(a,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"Even Fill","data-off":"Odd Fill"})));if("ir"===a||"or"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","5em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null!==c&&"number"==typeof c&&c>=0?b._assignProperty(a,c):b._updateProperties()});if("ia"===a||"oa"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=IFLength.parseEquationValue($(this).val());null!==c?(c=ifMath.normalizeAngleRadians(ifMath.toRadians(c)),b._assignProperty(a,ifMath.PI2-c)):b._updateProperties()});if("ict"===a||"oct"===a)return $("<select></select>").attr("data-property",a).css("width","6em").gCornerType().on("change",function(){b._assignProperty(a,$(this).val())});if("icr"===a||"ocr"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null!==c&&"number"==typeof c&&c>=0?b._assignProperty(a,0>c?0:c):b._updateProperties()});throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Points:")).append($("<td></td>").append(b("pts"))).append($("<td></td>").html("&nbsp;")).append($("<td></td>").append(b("evenodd")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<hr>")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Radius:")).append($("<td></td>").append(b("or").attr("title","Outside Radius"))).append($("<td></td>").addClass("label").html('<i class="fa fa-circle"></i>')).append($("<td></td>").append(b("ir").attr("title","Inside Radius")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Angle:")).append($("<td></td>").append(b("oa").attr("title","Outside Angle"))).append($("<td></td>").addClass("label").html("&nbsp;")).append($("<td></td>").append(b("ia").attr("title","Inside Angle")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<hr>")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Corner:")).append($("<td></td>").append(b("oct").attr("title","Outside Corner-Type"))).append($("<td></td>").addClass("label").html('<i class="fa fa-circle"></i>')).append($("<td></td>").append(b("ict").attr("title","Inside Corner-Type")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Smooth:")).append($("<td></td>").append(b("ocr").attr("title","Outside Corner-Smoothness"))).append($("<td></td>").addClass("label").html("&nbsp;")).append($("<td></td>").append(b("icr").attr("title","Inside Corner-Smoothness")))).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),this._polygons=[];for(var c=0;c<b.length;++c)b[c]instanceof IFPolygon&&this._polygons.push(b[c]);return this._polygons.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._polygons.length>0&&this._polygons[0]===a.node&&this._updateProperties()},b.prototype._updateProperties=function(){var a=this._polygons[0];this._panel.find('input[data-property="pts"]').val(a.getProperty("pts")),this._panel.find('input[data-property="evenodd"]').prop("checked",a.getProperty("evenodd")),this._panel.find('input[data-property="or"]').val(this._document.getScene().pointToString(a.getProperty("or"))),this._panel.find('input[data-property="ir"]').val(this._document.getScene().pointToString(a.getProperty("ir"))),this._panel.find('input[data-property="oa"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-a.getProperty("oa")),2)),this._panel.find('input[data-property="ia"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-a.getProperty("ia")),2)),this._panel.find('select[data-property="oct"]').val(a.getProperty("oct")),this._panel.find('select[data-property="ict"]').val(a.getProperty("ict")),this._panel.find('input[data-property="ocr"]').val(this._document.getScene().pointToString(a.getProperty("ocr"))),this._panel.find('input[data-property="icr"]').val(this._document.getScene().pointToString(a.getProperty("icr")))},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._polygons.length;++d)this._polygons[d].setProperties(a,b)}finally{c.commitTransaction("Modify Polygon Properties")}},b.prototype.toString=function(){return"[Object GPolygonProperties]"},a.GPolygonProperties=b}(this),function(a){function b(){this._pathes=[]}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._pathes=null,b.prototype._points=null,b.prototype.getCategory=function(){return"Path"},b.prototype.init=function(a){this._panel=a;var b=function(a){var b=this;if("evenodd"===a||"closed"===a)return $("<div></div>").css("width","6em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-path-property",a).on("change",function(){b._assignPathProperty(a,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"closed"===a?"Closed":"Even Fill","data-off":"closed"===a?"Open":"Odd Fill"})));throw new Error("Unknown input property: "+a)}.bind(this),c=function(a){var b=this;if("x"===a||"y"===a||"cl"===a||"cr"===a)return $("<input>").attr("type","text").attr("data-point-property",a).css("width","5em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null!==c&&"number"==typeof c&&c>=0?b._assignPointProperty(a,c):b._updatePointProperties()});if("type"===a)return $("<select></select>").css("width","100%").attr("data-point-property",a).append($("<optgroup></optgroup>").attr("label","Curve").append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Symmetric).text("Symmetric")).append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Asymmetric).text("Asymmetric")).append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Mirror).text("Mirror")).append($("<option></option>").attr("value",IFPathBase.AnchorPoint.Type.Connector).text("Connector"))).append($("<optgroup></optgroup>").attr("label","Corner")).gCornerType().on("change",function(){var a=$(this).val();"-"===a&&(a=IFPathBase.CornerType.Rounded),b._assignPointProperty("tp",a)});if("ah"===a)return $("<div></div>").css("width","4.5em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-point-property",a).on("change",function(){b._assignPointProperty(a,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"Auto","data-off":"Off"})));if("cu"===a)return $("<button></button>").attr("data-point-property",a).on("click",function(){b._assignPointProperty(a,!$(this).hasClass("g-active")),b._updatePointProperties()}).append($("<span></span>").addClass("fa fa-lock fa-fw"));throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").html("&nbsp;")).append($("<td></td>").attr("colspan","3").append(b("evenodd")).append(b("closed")))).append($("<tr></tr>").attr("data-point-property","_row").append($("<td></td>").attr("colspan",4).append($("<h1></h1>").addClass("g-divider").text("Anchor Point")))).append($("<tr></tr>").attr("data-point-property","_row").append($("<td></td>").addClass("label").text("X:")).append($("<td></td>").append(c("x").attr("title","Horizontal Position of Point"))).append($("<td></td>").addClass("label").text("Y:")).append($("<td></td>").append(c("y").attr("title","Vertical Position of Point")))).append($("<tr></tr>").attr("data-point-property","_row").append($("<td></td>").addClass("label").text("Handles:")).append($("<td></td>").append($("<button></button>").attr("title","Clear Left Handle").on("click",function(){this._assignPointProperties(["hlx","hly"],[null,null])}.bind(this)).append($("<span></span>").addClass("fa fa-forward"))).append($("<button></button>").attr("title","Clear Right Handle").on("click",function(){this._assignPointProperties(["hrx","hry"],[null,null])}.bind(this)).append($("<span></span>").addClass("fa fa-backward"))).append($("<button></button>").attr("title","Clear Handles").on("click",function(){this._assignPointProperties(["hlx","hly","hrx","hry"],[null,null,null,null])}.bind(this)).append($("<span></span>").addClass("fa fa-times")))).append($("<td></td>").attr("colspan","2").css("text-align","right").append(c("ah").attr("title","Toggle automatic calculation of handles")))).append($("<tr></tr>").attr("data-point-property","_row").append($("<td></td>").attr("colspan",4).append($("<hr>")))).append($("<tr></tr>").attr("data-point-property","_row").append($("<td></td>").addClass("label").text("Type:")).append($("<td></td>").attr("colspan","3").append(c("type")))).append($("<tr></tr>").attr("data-point-property","_row").append($("<td></td>").addClass("label").text("Smooth:")).append($("<td></td>").attr("colspan","3").append(c("cl").attr("title","Left Smoothness")).append(c("cu").attr("title","Toggle Lock of Left & Right Smoothness")).append(c("cr").attr("title","Right Smoothness")))).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document.getScene().removeEventListener(IFElement.AfterFlagChangeEvent,this._afterFlagChange),this._document=null),this._pathes=[],this._points=[];for(var c=0;c<b.length;++c)if(b[c]instanceof IFPath){var d=b[c];this._pathes.push(b[c]);for(var e=d.getAnchorPoints().getFirstChild();null!==e;e=e.getNext())e.hasFlag(IFNode.Flag.Selected)&&this._points.push(e)}return this._pathes.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().addEventListener(IFElement.AfterFlagChangeEvent,this._afterFlagChange,this),this._updatePathProperties(),this._updatePointProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._pathes.length>0&&this._pathes[0]===a.node&&this._updatePathProperties(),this._points.length>0&&this._points[0]===a.node&&this._updatePointProperties()},b.prototype._afterFlagChange=function(a){if(a.flag===IFNode.Flag.Selected&&a.node instanceof IFPathBase.AnchorPoint){var b=a.node.getParent().getParent();b&&this._pathes.indexOf(b)>=0&&(a.set?this._points.push(a.node):this._points.splice(this._points.indexOf(a.node),1),this._updatePointProperties())}},b.prototype._updatePathProperties=function(){var a=this._pathes[0];this._panel.find('input[data-path-property="evenodd"]').prop("checked",a.getProperty("evenodd")),this._panel.find('input[data-path-property="closed"]').prop("checked",a.getProperty("closed"))},b.prototype._updatePointProperties=function(){var a=this._points.length>0?this._points[0]:null;if(a){this._panel.find("[data-point-property]").css("visibility",""),this._panel.find('input[data-point-property="x"]').val(this._document.getScene().pointToString(a.getProperty("x"))),this._panel.find('input[data-point-property="y"]').val(this._document.getScene().pointToString(a.getProperty("y"))),this._panel.find('input[data-point-property="ah"]').prop("checked",a.getProperty("ah"));var b=!0,c=a.getProperty("tp");for(var d in IFPathBase.AnchorPoint.Type)if(IFPathBase.AnchorPoint.Type[d]===c){b=!1;break}this._panel.find('select[data-point-property="type"]').val(c),this._panel.find('input[data-point-property="cl"]').prop("disabled",!b).val(this._document.getScene().pointToString(a.getProperty("cl"))),this._panel.find('input[data-point-property="cr"]').prop("disabled",!b||a.getProperty("cu")).val(this._document.getScene().pointToString(a.getProperty("cr"))),this._panel.find('button[data-point-property="cu"]').prop("disabled",!b).toggleClass("g-active",a.getProperty("cu"))}else this._panel.find("[data-point-property]").css("visibility","hidden")},b.prototype._assignPathProperty=function(a,b){this._assignPathProperties([a],[b])},b.prototype._assignPathProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._pathes.length;++d)this._pathes[d].setProperties(a,b)}finally{c.commitTransaction("Modify Path Properties")}},b.prototype._assignPointProperty=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._points.length;++d){var e=this._points[d];if("x"===a){var f=b-e.getProperty("x"),g=e.getProperty("hlx")?e.getProperty("hlx")+f:null,h=e.getProperty("hrx")?e.getProperty("hrx")+f:null;e.setProperties(["x","hlx","hrx"],[b,g,h])}else if("y"===a){var i=b-e.getProperty("y"),j=e.getProperty("hly")?e.getProperty("hly")+i:null,k=e.getProperty("hry")?e.getProperty("hry")+i:null;e.setProperties(["y","hly","hry"],[b,j,k])}else e.setProperties([a],[b])}}finally{c.commitTransaction("Modify Point Properties")}},b.prototype._assignPointProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._points.length;++d)this._points[d].setProperties(a,b)}finally{c.commitTransaction("Modify Point Properties")}},b.prototype.toString=function(){return"[Object GPathProperties]"},a.GPathProperties=b}(this),function(a){function b(){this._rectangles=[]}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._rectangles=null,b.prototype.getCategory=function(){return"Rectangle"},b.prototype.init=function(a){this._panel=a;var b=function(a){var b=this;if("uf"===a)return $("<div></div>").css("width","12em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property",a).on("change",function(){b._assignProperty("uf",$(this).is(":checked")),b._updateCornerProperties()})).append($("<span></span>").addClass("switch").attr({"data-on":"Uniform Corners","data-off":"Separate Corners"})));if("tl_sx"===a||"tl_sy"===a||"tr_sx"===a||"tr_sy"===a||"bl_sx"===a||"bl_sy"===a||"br_sx"===a||"br_sy"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null!==c&&"number"==typeof c&&c>=0?b._assignProperty(a,c):b._updateCornerProperties()});if("tl_ct"===a||"tr_ct"===a||"bl_ct"===a||"br_ct"===a)return $("<select></select>").attr("data-property",a).css("width","2em").gCornerType().on("change",function(){b._assignProperty(a,$(this).val())});if("tl_uf"===a||"tr_uf"===a||"bl_uf"===a||"br_uf"===a)return $("<button></button>").attr("data-property",a).on("click",function(){b._assignProperty(a,!$(this).hasClass("g-active")),b._updateCornerProperties()}).append($("<span></span>").addClass("fa fa-lock fa-fw"));throw new Error("Unknown input property: "+a)}.bind(this),c="Uniform Corner-Smoothness",d="Horizontal Corner-Smoothness",e="Vertical Corner-Smoothness",f="Corner-Type";$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").attr("colspan","2").append(b("uf")))).append($("<tr></tr>").append($("<td></td>").append(b("tl_uf").attr("title",c)).append(b("tl_sx").attr("title",d))).append($("<td></td>").append(b("tr_sx").attr("title",d)).append(b("tr_uf").attr("title",c)))).append($("<tr></tr>").append($("<td></td>").append(b("tl_sy").attr("title",e)).append(b("tl_ct").attr("title",f))).append($("<td></td>").append(b("tr_ct").attr("title",f)).append(b("tr_sy").attr("title",e)))).append($("<tr></tr>").append($("<td></td>").append(b("bl_sy").attr("title",e)).append(b("bl_ct").attr("title",f))).append($("<td></td>").append(b("br_ct").attr("title",f)).append(b("br_sy").attr("title",e)))).append($("<tr></tr>").append($("<td></td>").append(b("bl_uf").attr("title",c)).append(b("bl_sx").attr("title",d))).append($("<td></td>").append(b("br_sx").attr("title",d)).append(b("br_uf").attr("title",c)))).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),this._rectangles=[];for(var c=0;c<b.length;++c)b[c]instanceof IFRectangle&&this._rectangles.push(b[c]);return this._rectangles.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._rectangles.length>0&&this._rectangles[0]===a.node&&this._updateProperties()},b.prototype._updateProperties=function(){this._updateCornerProperties()},b.prototype._updateCornerProperties=function(){var a=this._rectangles[0],b=a.getProperty("uf"),c=function(c){for(var d=0;d<c.length;++d){var e=c[d],f=this._panel.find('button[data-property="'+e+'_uf"]'),g=this._panel.find('input[data-property="'+e+'_sx"]'),h=this._panel.find('input[data-property="'+e+'_sy"]'),i=this._panel.find('select[data-property="'+e+'_ct"]'),j=b&&"tl"!==e;f.css("visibility",j?"hidden":"visible"),g.css("visibility",j?"hidden":"visible"),h.css("visibility",j?"hidden":"visible"),i.css("visibility",j?"hidden":"visible"),j||(g.val(this._document.getScene().pointToString(a.getProperty(e+"_sx"))),h.val(this._document.getScene().pointToString(a.getProperty(e+"_sy"))),a.getProperty(e+"_uf")?(f.addClass("g-active"),h.prop("disabled",!0)):(f.removeClass("g-active"),h.prop("disabled",!1)),f.prop("disabled",b))}}.bind(this);this._panel.find('input[data-property="uf"]').prop("checked",b),c(["tl","tr","bl","br"])},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){var c=this._document.getEditor();
c.beginTransaction();try{for(var d=0;d<this._rectangles.length;++d)this._rectangles[d].setProperties(a,b)}finally{c.commitTransaction("Modify Rectangle Properties")}},b.prototype.toString=function(){return"[Object GRectangleProperties]"},a.GRectangleProperties=b}(this),function(a){function b(){this._ellipses=[]}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._ellipses=null,b.prototype.getCategory=function(){return"Ellipse"},b.prototype.init=function(a){this._panel=a;var b=function(a){var b=this;if("etp"===a)return $("<select></select>").attr("data-property","etp").css("width","100%").append($("<option></option>").attr("value",IFEllipse.Type.Arc).text("Arc")).append($("<option></option>").attr("value",IFEllipse.Type.Chord).text("Chord")).append($("<option></option>").attr("value",IFEllipse.Type.Pie).text("Pie")).on("change",function(){b._assignProperty(a,$(this).val())});if("sa"===a||"ea"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=IFLength.parseEquationValue($(this).val());null!==c?(c=ifMath.normalizeAngleRadians(ifMath.toRadians(c)),b._assignProperty(a,ifMath.PI2-c)):b._updateProperties()});throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Style:")).append($("<td></td>").attr("colspan","3").append(b("etp")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Angle:")).append($("<td></td>").append(b("sa"))).append($("<td></td>").addClass("label").html('<i class="fa fa-circle"></i>')).append($("<td></td>").append(b("ea")))).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document=null),this._ellipses=[];for(var c=0;c<b.length;++c)b[c]instanceof IFEllipse&&this._ellipses.push(b[c]);return this._ellipses.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._ellipses.length>0&&this._ellipses[0]===a.node&&this._updateProperties()},b.prototype._updateProperties=function(){var a=this._ellipses[0];this._panel.find('select[data-property="etp"]').val(a.getProperty("etp")),this._panel.find('input[data-property="sa"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-a.getProperty("sa")),2)),this._panel.find('input[data-property="ea"]').val(ifUtil.formatNumber(ifMath.toDegrees(ifMath.PI2-a.getProperty("ea")),2))},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._ellipses.length;++d)this._ellipses[d].setProperties(a,b)}finally{c.commitTransaction("Modify Ellipse Properties")}},b.prototype.toString=function(){return"[Object GEllipseProperties]"},a.GEllipseProperties=b}(this),function(a){function b(){}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._image=null,b.prototype.getCategory=function(){return"Image"},b.prototype.init=function(a){this._panel=a,$("<div></div>").css("overflow","hidden").append($("<span></span>").addClass("fa fa-image")).append($("<span></span>").css("text-overflow","ellipsis").attr("data-property","url")).appendTo(a),$("<hr>").appendTo(a),$("<button></button>").attr("data-action","embed").text("Embed").on("click",function(){image2Base64(this._image.getImage(),function(a){IFEditor.tryRunTransaction(this._image,function(){this._image.setProperty("url",a)}.bind(this),"Embed Image")}.bind(this))}.bind(this)).appendTo(a),$("<button></button>").attr("data-action","replace").text("Replace...").on("click",function(){var a=this._image.getGeometryBBox().getSide(IFRect.Side.TOP_LEFT);this._document.getStorage().openResourcePrompt(this._document.getUrl(),["jpg","jpeg","png","gif"],function(b){IFEditor.tryRunTransaction(this._image,function(){this._image.setProperties(["url","trf"],[new URI(b).relativeTo(this._document.getUrl()).toString(),new IFTransform(1,0,0,1,a.getX(),a.getY())])}.bind(this),"Replace Image")}.bind(this))}.bind(this)).appendTo(a),$("<button></button>").attr("data-action","export").text("Export...").on("click",function(){var a=gApp.getMatchingStorage(!0,!0,"png",!1,this._document.getStorage());a&&a.saveResourcePrompt(this._document.getUrl(),this._image.getLabel(),["png"],function(b){image2ArrayBuffer(this._image.getImage(),function(c){a.save(b,c,!0)})}.bind(this))}.bind(this)).appendTo(a),$("<button></button>").attr("data-action","reset-size").text("Reset Size").on("click",function(){var a=this._image.getGeometryBBox().getSide(IFRect.Side.TOP_LEFT);IFEditor.tryRunTransaction(this._image,function(){this._image.setProperty("trf",new IFTransform(1,0,0,1,a.getX(),a.getY()))}.bind(this),"Reset Image Size")}.bind(this)).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().removeEventListener(IFImage.StatusEvent,this._imageStatus,this),this._document=null),this._image=null;for(var c=0;c<b.length;++c)if(b[c]instanceof IFImage){if(this._image){this._image=null;break}this._image=b[c]}return this._image?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().addEventListener(IFImage.StatusEvent,this._imageStatus,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._image&&this._image===a.node&&this._updateProperties()},b.prototype._imageStatus=function(a){a.image!==this._image||a.status!==IFImage.ImageStatus.Error&&a.status!==IFImage.ImageStatus.Loaded||this._updateProperties()},b.prototype._updateProperties=function(){var a=this._image.getProperty("url"),b=0===a.indexOf("data:"),c=this._image.getStatus(),d=this._image.getImage(),e=d&&c===IFImage.ImageStatus.Loaded,f=this._image.getGeometryBBox();this._panel.find('[data-property="url"]').text(b?"<Embedded Image>":decodeURIComponent(a)),this._panel.find('button[data-action="embed"]').prop("disabled",!e||b),this._panel.find('button[data-action="replace"]').prop("disabled",!this._document.isSaveable()),this._panel.find('button[data-action="export"]').prop("disabled",!e||!this._document.isSaveable()),this._panel.find('button[data-action="reset-size"]').prop("disabled",!e||d.naturalWidth===f.getWidth()&&d.naturalHeight===f.getHeight())},b.prototype.toString=function(){return"[Object GImageProperties]"},a.GImageProperties=b}(this),function(a){function b(){this._pages=[]}IFObject.inherit(b,GProperties),b.SIZE_PRESETS=[{name:"Paper",sizes:[{name:"A0",width:"841mm",height:"1189mm"},{name:"A1",width:"594mm",height:"841mm"},{name:"A2",width:"420mm",height:"594mm"},{name:"A3",width:"297mm",height:"420mm"},{name:"A4",width:"210mm",height:"297mm"},{name:"A5",width:"148,5mm",height:"210mm"}]},{name:"Phone",sizes:[{name:"Apple iPhone 4 (S)",width:"640px",height:"960px"},{name:"Apple iPhone 5",width:"640px",height:"1136px"}]},{name:"Tablet",sizes:[{name:"Apple iPad 1 & 2 & Mini",width:"768px",height:"1024px"},{name:"Apple iPad 3 & 4",width:"1536px",height:"2048px"}]}],b.prototype._panel=null,b.prototype._document=null,b.prototype._pages=null,b.prototype.getCategory=function(){return"Page"},b.prototype.init=function(a){this._panel=a;var c=function(a){var c=this;if("msref"===a)return $("<select></select>").attr("data-property","msref").css("width","100%").on("change",function(){var b=$(this).val();c._assignProperty(a,""===b?null:b)});if("size-preset"===a){var d=$("<select></select>").attr("data-property","size-preset").css("width","100%").on("change",function(){var a=c._document.getScene(),d=$(this).val();if(d.indexOf(",")>=0){var e=d.split(","),f=b.SIZE_PRESETS[parseInt(e[0])].sizes[parseInt(e[1])],g=a.stringToPoint(f.width),h=a.stringToPoint(f.height);c._panel.find('[name="w"]').val(a.pointToString(g)),c._panel.find('[name="h"]').val(a.pointToString(h)),c._assignProperties(["w","h"],[g,h])}});d.append($("<option></option>").attr("value","x").text("Custom Size"));for(var e=0;e<b.SIZE_PRESETS.length;++e){var f=b.SIZE_PRESETS[e],g=$("<optgroup></optgroup>").attr("label",f.name);d.append(g);for(var h=0;h<f.sizes.length;++h){var i=f.sizes[h];$("<option></option>").attr("value",e.toString()+","+h.toString()).text(i.name).appendTo(g)}}return d}if("cls"===a)return $("<button></button>").attr("data-property",a).gColorButton({allowClear:!0}).on("colorchange",function(b,d){c._assignProperty(a,d)});if("w"===a||"h"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var b=c._document.getScene().stringToPoint($(this).val());null!==b&&"number"==typeof b&&b>=0?c._assignProperty(a,b):c._updateProperties(),c._selectSizePreset()});if("bl"===a||"mt"===a||"mb"===a||"ml"===a||"mr"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var b=c._document.getScene().stringToPoint($(this).val());null!==b&&"number"==typeof b&&b>=0?c._assignProperty(a,b):c._updateProperties()});throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Master:")).append($("<td></td>").attr("colspan","3").append(c("msref")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<hr>")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Bleed:")).append($("<td></td>").append(c("bl"))).append($("<td></td>").addClass("label").text("Color:")).append($("<td></td>").append(c("cls")))).append($("<tr></tr>").append($("<td></td>").addClass("label").html("&nbsp;")).append($("<td></td>").attr("colspan","3").append(c("size-preset")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Width:")).append($("<td></td>").append(c("w"))).append($("<td></td>").addClass("label").text("Height:")).append($("<td></td>").append(c("h")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<h1></h1>").addClass("g-divider").text("Margin")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Top:")).append($("<td></td>").append(c("mt"))).append($("<td></td>").addClass("label").text("Bottom:")).append($("<td></td>").append(c("mb")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Left:")).append($("<td></td>").append(c("ml"))).append($("<td></td>").addClass("label").text("Right:")).append($("<td></td>").append(c("mr")))).appendTo(this._panel)},b.prototype.update=function(a,b){if(this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().removeEventListener(IFNode.AfterInsertEvent,this._updatePages,this),this._document.getScene().removeEventListener(IFNode.AfterRemoveEvent,this._updatePages,this),this._document=null),this._pages=[],1===b.length&&b[0]instanceof IFScene){var c=b[0].getActivePage();c&&this._pages.push(c)}else for(var d=0;d<b.length;++d)b[d]instanceof IFPage&&this._pages.push(b[d]);return this._pages.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getScene().addEventListener(IFNode.AfterInsertEvent,this._updatePages,this),this._document.getScene().addEventListener(IFNode.AfterRemoveEvent,this._updatePages,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._pages.length>0&&(this._pages[0]===a.node||a.node instanceof IFScene&&a.properties.indexOf("unit")>=0)&&this._updateProperties()},b.prototype._updateProperties=function(){var a=this._document.getScene(),b=this._pages[0];this._updatePages(),this._panel.find('select[data-property="msref"]').val(b.getProperty("msref")),this._panel.find('input[data-property="bl"]').val(b.getProperty("bl")),this._panel.find('[data-property="cls"]').gColorButton("value",b.getProperty("cls")).gColorButton("scene",a),this._panel.find('input[data-property="w"]').val(a.pointToString(b.getProperty("w"))),this._panel.find('input[data-property="h"]').val(a.pointToString(b.getProperty("h"))),this._panel.find('input[data-property="mt"]').val(a.pointToString(b.getProperty("mt"))),this._panel.find('input[data-property="mb"]').val(a.pointToString(b.getProperty("mb"))),this._panel.find('input[data-property="ml"]').val(a.pointToString(b.getProperty("ml"))),this._panel.find('input[data-property="mr"]').val(a.pointToString(b.getProperty("mr"))),this._selectSizePreset()},b.prototype._updatePages=function(){var a=this._document.getScene(),b=this._panel.find('select[data-property="msref"]'),c=b.val();b.val(null),b.empty(),$("<option></option>").attr("value","").text("").appendTo(b);for(var d=a.getFirstChild();null!==d;d=d.getNext())d instanceof IFPage&&this._pages.indexOf(d)<0&&$("<option></option>").attr("value",d.getReferenceId()).text(d.getLabel()).appendTo(b);b.val(c)},b.prototype._selectSizePreset=function(){for(var a=this._pages[0],c=!1,d=this._panel.find('[data-property="size-preset"]'),e=a.getProperty("w"),f=a.getProperty("h"),g=0;g<b.SIZE_PRESETS.length;++g)for(var h=b.SIZE_PRESETS[g],i=0;i<h.sizes.length;++i){var j=h.sizes[i],k=a.getScene().stringToPoint(j.width),l=a.getScene().stringToPoint(j.height);if(k===e&&l===f){d.val(g.toString()+","+i.toString()),c=!0;break}}c||d.val("x")},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._pages.length;++d)this._pages[d].setProperties(a,b)}finally{c.commitTransaction("Modify Page Properties")}},b.prototype.toString=function(){return"[Object GPageProperties]"},a.GPageProperties=b}(this),function(a){function b(){this._text=[]}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._text=null,b.prototype._textEditor=null,b.prototype.getCategory=function(){return"Text"},b.prototype.init=function(a){this._panel=a;var b=function(a){var b=this;if("vb"===a)return $("<select></select>").attr("data-property",a).append($("<option></option>").attr("value",IFText.VerticalBox.Auto).text("Auto")).append($("<option></option>").attr("value",IFText.VerticalBox.Fixed).text("Fixed")).append($("<option></option>").attr("value",IFText.VerticalBox.Center).text("Centered")).append($("<option></option>").attr("value",IFText.VerticalBox.Bottom).text("Bottom")).on("change",function(){b._assignProperty(a,$(this).val())});if("aw"===a)return $("<div></div>").css("width","8em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property",a).on("change",function(){b._assignProperty(a,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"Auto Width","data-off":"Fixed Width"})));if("ff"===a){for(var c=$("<select></select>").css("width","100%").attr("data-property",a).append($("<option></option>").attr("value","").text("")).on("change",function(){var c=$(this).val();b._assignProperty(a,""===c?null:c)}),d={},e=ifFont.getFamilies(),f=0;f<e.length;++f){var g=ifFont.getCategory(e[f]),h=null;d.hasOwnProperty(g)?h=d[g]:d[g]=h=$("<optgroup></optgroup>").attr("label",ifLocale.get(IFFont.CategoryName[g])).appendTo(c),$("<option></option>").attr("value",e[f]).text(e[f]).appendTo(h)}return c}if("fi"===a||"ws"===a||"cs"===a||"in"===a||"cg"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=b._document.getScene().stringToPoint($(this).val());null===c||"number"==typeof c&&c>=0?b._assignProperty(a,c):b._updateProperties()});if("fw"===a){for(var c=$("<select></select>").attr("data-property",a).append($("<option></option>").attr("value","").text("")).on("change",function(){var c=$(this).val();b._assignProperty(a,""===c?null:c)}),f=100;900>=f;f+=100)$("<option></option>").attr("value",f).text(ifLocale.get(IFFont.WeightName[f])).appendTo(c);return c}if("fs"===a)return $("<select></select>").attr("data-property",a).append($("<option></option>").attr("value","").text("")).append($("<option></option>").attr("value",IFFont.Style.Normal).text("Normal")).append($("<option></option>").attr("value",IFFont.Style.Italic).text("Italic")).on("change",function(){var c=$(this).val();b._assignProperty(a,""===c?null:c)});if("fc"===a)return $("<button></button>").attr("data-property",a).gColorButton({allowClear:!0,scene:this._document.getScene()}).on("colorchange",function(c,d){b._assignProperty(a,d)});if("al"===a)return $("<select></select>").attr("data-property",a).append($("<option></option>").attr("value","").text("")).append($("<option></option>").attr("value",IFText.Paragraph.Alignment.Left).text("Left")).append($("<option></option>").attr("value",IFText.Paragraph.Alignment.Center).text("Center")).append($("<option></option>").attr("value",IFText.Paragraph.Alignment.Right).text("Right")).append($("<option></option>").attr("value",IFText.Paragraph.Alignment.Justify).text("Justify")).on("change",function(){var c=$(this).val();b._assignProperty(a,""===c?null:c)});if("wm"===a)return $("<select></select>").attr("data-property",a).append($("<option></option>").attr("value","").text("")).append($("<option></option>").attr("value",IFText.Paragraph.WrapMode.None).text("None")).append($("<option></option>").attr("value",IFText.Paragraph.WrapMode.Words).text("Words")).append($("<option></option>").attr("value",IFText.Paragraph.WrapMode.All).text("All")).on("change",function(){var c=$(this).val();b._assignProperty(a,""===c?null:c)});if("lh"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=$(this).val();c=c&&""!==c?IFLength.parseEquationValue(c):null,null===c||c>0?b._assignProperty(a,c):b._updateProperties()});if("cc"===a)return $("<input>").attr("type","text").attr("data-property",a).css("width","4em").on("change",function(){var c=$(this).val();c=c&&""!==c?parseInt(c):null,null===c||c>1?b._assignProperty(a,c):b._updateProperties()});throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Box:")).append($("<td></td>").append(b("vb"))).append($("<td></td>").attr("colspan","2").append(b("aw")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<hr>")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Face:")).append($("<td></td>").attr("colspan","3").append(b("ff")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Style:")).append($("<td></td>").attr("colspan","3").append(b("fw")).append(b("fs")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Size:")).append($("<td></td>").append(b("fi"))).append($("<td></td>").addClass("label").text("Space:")).append($("<td></td>").append(b("ws").css("width","1.5em").attr("title","Word Spacing")).append(b("cs").css("width","1.5em").attr("title","Character Spacing")))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<h1></h1>").addClass("g-divider").text("Paragraph")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Columns:")).append($("<td></td>").append(b("cc"))).append($("<td></td>").addClass("label").text("Gap:")).append($("<td></td>").append(b("cg")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Align:")).append($("<td></td>").append(b("al"))).append($("<td></td>").addClass("label").text("Wrap:")).append($("<td></td>").append(b("wm")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Indent:")).append($("<td></td>").append(b("in"))).append($("<td></td>").addClass("label").text("Line:")).append($("<td></td>").append(b("lh")))).appendTo(a)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange),this._document.getEditor().removeEventListener(IFEditor.InlineEditorEvent,this._inlineEditorEvent),this._document=null),this._text=[];for(var c=0;c<b.length;++c)b[c]instanceof IFText&&this._text.push(b[c]);return this._text.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document.getEditor().addEventListener(IFEditor.InlineEditorEvent,this._inlineEditorEvent,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._text.length>0&&(this._text[0]===a.node||this._text[0].getContent()===a.node)&&this._updateProperties()},b.prototype._inlineEditorEvent=function(a){switch(a.type){case IFEditor.InlineEditorEvent.Type.AfterOpen:this._textEditor=a.editor,this._updateProperties();break;case IFEditor.InlineEditorEvent.Type.AfterClose:this._textEditor=null,this._updateProperties();break;case IFEditor.InlineEditorEvent.Type.SelectionChanged:this._updateProperties()}},b.prototype._updateProperties=function(){var a=this._textEditor?this._textEditor:IFElementEditor.getEditor(this._text[0]);this._panel.find('select[data-property="vb"]').prop("disabled",this._textEditor&&this._textEditor.isInlineEdit()).val(a.getProperty("vb")),this._panel.find('input[data-property="aw"]').prop("disabled",this._textEditor&&this._textEditor.isInlineEdit()).prop("checked",a.getProperty("aw"));var b=a.getProperty("ff",!0);this._panel.find('select[data-property="ff"]').val(a.getProperty("ff")),this._panel.find('input[data-property="fi"]').val(this._document.getScene().pointToString(a.getProperty("fi")));var c=this._panel.find('select[data-property="fw"]');c.val(a.getProperty("fw"));for(var d=ifFont.getWeights(b),e=100;900>=e;e+=100)c.find('[value="'+e+'"]').prop("disabled",!d||d.indexOf(e)<0);var f=this._panel.find('select[data-property="fs"]');f.val(a.getProperty("fs"));var g=ifFont.getStyles(b);f.find("option").each(function(a,b){var c=$(b),d=c.attr("value");""!==d&&c.prop("disabled",g.indexOf(d)<0)}),this._panel.find('input[data-property="ws"]').val(this._document.getScene().pointToString(a.getProperty("ws"))),this._panel.find('input[data-property="cs"]').val(this._document.getScene().pointToString(a.getProperty("cs"))),this._panel.find('input[data-property="cc"]').val(a.getProperty("cc")),this._panel.find('input[data-property="cg"]').val(this._document.getScene().pointToString(a.getProperty("cg"))),this._panel.find('select[data-property="al"]').val(a.getProperty("al")),this._panel.find('select[data-property="wm"]').val(a.getProperty("wm")),this._panel.find('input[data-property="in"]').val(this._document.getScene().pointToString(a.getProperty("in")));var h=a.getProperty("lh");this._panel.find('input[data-property="lh"]').val(null!==h?ifUtil.formatNumber(h):"")},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){if(this._textEditor)this._textEditor.setProperties(a,b);else{var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._text.length;++d){var e=IFElementEditor.getEditor(this._text[d]);e.setProperties(a,b)}}finally{c.commitTransaction("Modify Text Properties")}}},b.prototype.toString=function(){return"[Object GTextProperties]"},a.GTextProperties=b}(this),function(a){function b(){this._slices=[]}IFObject.inherit(b,GProperties),b.prototype._panel=null,b.prototype._document=null,b.prototype._slices=null,b.prototype.getCategory=function(){return"Slice"},b.prototype.init=function(a){this._panel=a;var b=function(a){var b=this;if("cls"===a)return $("<button></button>").attr("data-property",a).gColorButton({allowClear:!0}).on("colorchange",function(c,d){b._assignProperty(a,d)});if("trm"===a)return $("<div></div>").css("width","7em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property",a).on("change",function(){b._assignProperty(a,$(this).is(":checked"))})).append($("<span></span>").addClass("switch").attr({"data-on":"Trim Empty","data-off":"No Trim"})));throw new Error("Unknown input property: "+a)}.bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Color:")).append($("<td></td>").append(b("cls"))).append($("<td></td>").addClass("label").text("On Export:")).append($("<td></td>").append(b("trm")))).appendTo(this._panel)},b.prototype.update=function(a,b){this._document&&(this._document.getScene().removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._document=null),this._slices=[];for(var c=0;c<b.length;++c)b[c]instanceof IFSlice&&this._slices.push(b[c]);return this._slices.length===b.length?(this._document=a,this._document.getScene().addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._updateProperties(),!0):!1},b.prototype._afterPropertiesChange=function(a){this._slices.length>0&&this._slices[0]===a.node&&this._updateProperties()},b.prototype._updateProperties=function(){var a=this._document.getScene(),b=this._slices[0];this._panel.find('[data-property="cls"]').gColorButton("value",b.getProperty("cls")).gColorButton("scene",a),this._panel.find('input[data-property="trm"]').prop("checked",b.getProperty("trm"))},b.prototype._assignProperty=function(a,b){this._assignProperties([a],[b])},b.prototype._assignProperties=function(a,b){var c=this._document.getEditor();c.beginTransaction();try{for(var d=0;d<this._slices.length;++d)this._slices[d].setProperties(a,b)}finally{c.commitTransaction("Modify Slice Properties")}},b.prototype.toString=function(){return"[Object GSliceProperties]"},a.GSliceProperties=b}(this),function(a){function b(a){if(d){var b=$(a).data("page");if(b&&(b!==d||ifPlatform.modifiers.shiftKey))return d.getParent()===b.getParent()}return!1}function c(){GSidebar.call(this)}var d=null;IFObject.inherit(c,GSidebar),c.ID="pages-layers",c.TITLE=new IFLocale.Key(c,"title"),c.prototype._pagesPanel=null,c.prototype._pageAddControl=null,c.prototype._pageDeleteControl=null,c.prototype._layersTree=null,c.prototype._layersTreeNodeMap=null,c.prototype._layerAddControl=null,c.prototype._layerDeleteControl=null,c.prototype.getId=function(){return c.ID},c.prototype.getTitle=function(){return c.TITLE},c.prototype.getIcon=function(){return'<span class="fa fa-fw fa-bars"></span>'},c.prototype.init=function(a){GSidebar.prototype.init.call(this,a),this._pagesPanel=$("<div></div>").addClass("pages"),this._pageAddControl=$("<button></button>").attr("title","Add Page").on("click",function(){gApp.executeAction(GAddPageAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-plus")),this._pageDeleteControl=$("<button></button>").attr("title","Delete Page").on("click",function(){gApp.executeAction(GDeletePageAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")),$("<div></div>").gPanel({title:"Pages",content:this._pagesPanel,controls:[this._pageAddControl,this._pageDeleteControl]}).appendTo(a),this._layersTree=$("<div></div>").addClass("layers").tree({data:[],dragAndDrop:!0,openFolderDelay:500,closedIcon:$('<span class="fa fa-caret-right"></span>'),openedIcon:$('<span class="fa fa-caret-down"></span>'),slide:!1,selectable:!1,onIsMoveHandle:function(a){return a.is(".jqtree-title")},onCreateLi:this._createLayerTreeItem.bind(this),onCanMoveTo:this._canMoveLayerTreeNode.bind(this)}).on("tree.open",function(a){a.node.layerOrItem&&a.node.layerOrItem.setFlag(IFNode.Flag.Expanded)}.bind(this)).on("tree.close",function(a){a.node.layerOrItem&&a.node.layerOrItem.removeFlag(IFNode.Flag.Expanded)}.bind(this)).on("tree.click",this._clickLayerTreeNode.bind(this)).on("tree.move",this._moveLayerTreeNode.bind(this)),this._layerAddControl=$("<button></button>").attr("title","Add Layer").on("click",function(){gApp.executeAction(GAddLayerAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-plus")),this._layerDeleteControl=$("<button></button>").attr("title","Delete Layer").on("click",function(){gApp.executeAction(GDeleteLayerAction.ID)}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")),$("<div></div>").gPanel({title:"Layers",content:this._layersTree,controls:[this._layerAddControl,this._layerDeleteControl]}).appendTo(a)},c.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.Activated){this._document=a.document;var b=this._document.getScene();b.addEventListener(IFNode.AfterInsertEvent,this._afterNodeInsert,this),b.addEventListener(IFNode.BeforeRemoveEvent,this._beforeNodeRemove,this),b.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),b.addEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),b.addEventListener(IFScene.ReferenceEvent,this._referenceEvent,this),this._clear()}else if(a.type===GApplication.DocumentEvent.Type.Deactivated){var b=this._document.getScene();this._document=null,b.removeEventListener(IFNode.AfterInsertEvent,this._afterNodeInsert,this),b.removeEventListener(IFNode.BeforeRemoveEvent,this._beforeNodeRemove,this),b.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),b.removeEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),b.removeEventListener(IFScene.ReferenceEvent,this._referenceEvent,this),this._clear()}},c.prototype._clear=function(){this._clearLayers(),this._clearPages()},c.prototype._clearPages=function(){if(this._pagesPanel.empty(),this._document)for(var a=this._document.getScene(),b=a.getFirstChild();null!==b;b=b.getNext())b instanceof IFPage&&this._insertPage(b)},c.prototype._insertPage=function(a){var c=null;a.getNext()&&this._pagesPanel.find(".page-block").each(function(b,d){var e=$(d);return e.data("page")===a.getNext()?(c=e,!1):void 0});var e=$("<div></div>").addClass("page-block").data("page",a).attr("draggable","true").append($("<div></div>").addClass("page-visibility").attr("title","Toggle Page Visibility").on("click",function(b){b.stopPropagation(),IFEditor.tryRunTransaction(a,function(){a.setProperty("visible",!a.getProperty("visible"))},"Toggle Page Visibility")}).append($("<span></span>").addClass("fa fa-fw"))).append($("<div></div>").addClass("page-lock").attr("title","Toggle Page Lock").on("click",function(b){b.stopPropagation(),IFEditor.tryRunTransaction(a,function(){a.setProperty("locked",!a.getProperty("locked"))},"Toggle Page Lock")}).append($("<span></span>").addClass("fa fa-fw"))).append($("<div></div>").addClass("page-name").gAutoEdit({}).on("submitvalue",function(b,c){c&&""!==c.trim()&&IFEditor.tryRunTransaction(a,function(){a.setProperty("name",c)},"Rename Page")})).append($("<div></div>").addClass("page-master").append($("<span></span>").addClass("fa fa-fw"))).on("mousedown",function(){}).on("click",function(){a.getScene().setActivePage(a)}).on("dragstart",function(a){var c=$(this),e=a.originalEvent;e.stopPropagation(),d=c.data("page"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","dummy_data"),c.closest(".pages").find(".page-block").each(function(a,c){$(c).append($("<div></div>").addClass("drag-overlay").on("dragenter",function(){b(this.parentNode)&&$(this).parent().addClass("drop")}).on("dragleave",function(){b(this.parentNode)&&$(this).parent().removeClass("drop")}).on("dragover",function(a){var c=a.originalEvent;b(this.parentNode)&&(c.preventDefault(),c.stopPropagation(),c.dataTransfer.dropEffect="move")}).on("drop",function(){var a=($(this),$(this.parentNode));a.removeClass("drop"),a.closest(".pages").find(".drag-overlay").remove();
var b=a.data("page");if(d&&d.getParent()===b.getParent()){var c=d.getParent(),e=c.getIndexOfChild(d),f=c.getIndexOfChild(b);IFEditor.tryRunTransaction(c,function(){if(ifPlatform.modifiers.shiftKey){var a=d.getScene().getPageInsertPosition(),g=d.clone();g.setProperties(["x","y","name"],[a.getX(),a.getY(),g.getProperty("name")+"-copy"]),c.insertChild(g,f>e?b.getNext():b)}else c.removeChild(d),c.insertChild(d,f>e?b.getNext():b)},ifPlatform.modifiers.shiftKey?"Duplicate Page":"Move Page")}}))})}).on("dragend",function(a){var b=$(this),c=a.originalEvent;c.stopPropagation(),b.closest(".pages").find(".drag-overlay").remove(),d=null});c&&c.length>0?e.insertBefore(c):e.appendTo(this._pagesPanel),this._updatePage(a)},c.prototype._updatePage=function(a){var b=a.getProperty("visible"),c=a.getProperty("locked");this._pagesPanel.find(".page-block").each(function(d,e){var f=$(e);if(f.data("page")===a){f.toggleClass("g-active",a.hasFlag(IFNode.Flag.Active)),f.toggleClass("g-selected",a.hasFlag(IFNode.Flag.Selected)),f.find(".page-visibility").toggleClass("page-default",b).find("> span").toggleClass("fa-eye",b).toggleClass("fa-eye-slash",!b),f.find(".page-lock").toggleClass("page-default",!c).find("> span").toggleClass("fa-lock",c).toggleClass("fa-unlock",!c),f.find(".page-name").text(a.getProperty("name"));var g=a.getScene().linkCount(a),h=a.getMasterPage(),i="";return g&&(i="Master of "+g.toString()+" pages:",a.getScene().visitLinks(a,function(a){i+="\n"+a.getLabel()})),h&&(""!==i&&(i+="\n\n"),i+="Slave of "+h.getLabel()),f.find(".page-master").css("display",h||g>0?"":"none").find("> span").attr("title",i).toggleClass("fa-link",!!h&&0===g).toggleClass("fa-crosshairs",g>0),!1}})},c.prototype._removePage=function(a){this._pagesPanel.find(".page-block").each(function(b,c){var d=$(c);return d.data("page")===a?(d.remove(),!1):void 0})},c.prototype._clearLayers=function(){if(this._layersTree.tree("loadData",[]),this._layersTree.tree("getTree").is_open=!0,this._layersTreeNodeMap=[],this._document){var a=this._document.getScene().getActivePage();if(a)for(var b=a.getFirstChild();null!==b;b=b.getNext())b instanceof IFLayer&&this._insertLayer(b)}},c.prototype._insertLayer=function(a){var b=ifUtil.uuid(),c=a.getNext()?this._getLayerTreeNode(a.getNext()):null;if(c)this._layersTree.tree("addNodeBefore",{id:b,layerOrItem:a},c);else{var d=a.getParent(),e=!d||d instanceof IFPage?null:this._getLayerTreeNode(d);this._layersTree.tree("appendNode",{id:b,layerOrItem:a},e)}if(this._layersTreeNodeMap.push({node:a,treeId:b}),this._updateLayer(a),a.hasMixin(IFNode.Container))for(var f=a.getFirstChild();null!==f;f=f.getNext())(f instanceof IFLayer||f instanceof IFItem)&&this._insertLayer(f);var g=this._getLayerTreeNode(a);a instanceof IFItem&&a.hasFlag(IFNode.Flag.Selected)&&this._layersTree.tree("selectNode",g),a.hasFlag(IFNode.Flag.Expanded)&&this._layersTree.tree("openNode",g,!1)},c.prototype._updateLayer=function(a){var b=this._getLayerTreeNode(a);if(b){var c=a.getLabel();a instanceof IFLayer&&a.getProperty("tp")===IFLayer.Type.Draft&&(c="*"+c),this._layersTree.tree("updateNode",b,c)}},c.prototype._removeLayer=function(a){var b=this._getLayerTreeNode(a);b&&(this._layersTree.tree("removeNode",b),a.accept(function(a){if(a instanceof IFLayer||a instanceof IFItem)for(var b=0;b<this._layersTreeNodeMap.length;++b)if(this._layersTreeNodeMap[b].node===a){this._layersTreeNodeMap.splice(b,1);break}}.bind(this)))},c.prototype._afterNodeInsert=function(a){if(a.node instanceof IFPage)this._insertPage(a.node);else if(a.node instanceof IFLayer||a.node instanceof IFItem){var b=this._document.getScene().getActivePage();a.node.getPage()===b&&this._insertLayer(a.node)}},c.prototype._beforeNodeRemove=function(a){if(a.node instanceof IFPage)this._removePage(a.node);else if(a.node instanceof IFLayer||a.node instanceof IFItem){this._removeLayer(a.node);var b=a.node.getParent();if(b instanceof IFLayer||b instanceof IFItem){for(var c=!1,d=b.getFirstChild();null!==d;d=d.getNext())if((d instanceof IFLayer||d instanceof IFItem)&&d!==a.node){c=!0;break}c||(b.removeFlag(IFNode.Flag.Expanded),this._updateLayer(b))}}},c.prototype._afterPropertiesChange=function(a){a.node instanceof IFPage?this._updatePage(a.node):(a.node instanceof IFLayer||a.node instanceof IFItem)&&this._updateLayer(a.node)},c.prototype._afterFlagChange=function(a){a.node instanceof IFPage&&(a.flag===IFNode.Flag.Active||a.flag===IFNode.Flag.Selected)?(this._pagesPanel.find(".page-block").each(function(b,c){var d=$(c);d.data("page")===a.node&&d.toggleClass(a.flag===IFNode.Flag.Active?"g-active":"g-selected",a.set)}),a.flag===IFNode.Flag.Active&&this._clearLayers()):a.node instanceof IFLayer&&(a.flag===IFNode.Flag.Active||a.flag===IFNode.Flag.Selected||a.flag===IFNode.Flag.Expanded)?this._updateLayer(a.node):a.node instanceof IFItem&&a.flag===IFNode.Flag.Selected?this._updateLayer(a.node):!(a.node instanceof IFLayer||a.node instanceof IFItem)||a.flag!==IFElement.Flag.Hidden&&a.flag!==IFElement.Flag.Locked||this._updateLayer(a.node)},c.prototype._referenceEvent=function(a){a.reference instanceof IFPage&&this._updatePage(a.reference)},c.prototype._clickLayerTreeNode=function(a){a.node.layerOrItem&&(a.node.layerOrItem instanceof IFLayer?this._document.getScene().setActiveLayer(a.node.layerOrItem):a.node.layerOrItem instanceof IFItem&&(ifPlatform.modifiers.shiftKey||!a.node.layerOrItem.hasFlag(IFNode.Flag.Selected)?this._document.getEditor().updateSelection(ifPlatform.modifiers.shiftKey,[a.node.layerOrItem]):a.node.layerOrItem.hasFlag(IFNode.Flag.Selected)&&this._document.getEditor().clearSelection([a.node.layerOrItem])))},c.prototype._createLayerTreeItem=function(a,b){if(a.layerOrItem){for(var c=a.layerOrItem,d=0,e=!1,f=!1,g=!1,h=c.getParent();null!==h&&!(h instanceof IFPage);h=h.getParent())e=h.getProperty("visible")===!1||e,f=h.getProperty("locked")===!0||f,h instanceof IFLayer&&(g=h.getProperty("otl")===!0||g),d+=1;var i=e||c.getProperty("visible")===!1,j=f||c.getProperty("locked")===!0,k=g||c instanceof IFLayer&&c.getProperty("otl"),l=b.find("div.jqtree-element"),m=l.find("> .jqtree-title");l.toggleClass("g-active",c.hasFlag(IFNode.Flag.Active)).toggleClass("g-selected",c.hasFlag(IFNode.Flag.Selected)).gAutoEdit({selector:"> .jqtree-title"}).on("submitvalue",function(a,b){b&&""!==b.trim()&&IFEditor.tryRunTransaction(c,function(){c.setProperty("name",b)},"Rename Layer/Item")});for(var n=0;d>n;++n)$("<span></span>").addClass("layer-spacer").prependTo(l);var o=null;c instanceof IFLayer?o=c.hasFlag(IFNode.Flag.Expanded)?"folder-open":"folder":c instanceof IFSlice?o="crop":c instanceof IFShape&&(c instanceof IFText?o="font":c instanceof IFImage?o="image":c instanceof IFEllipse?o="circle":c instanceof IFRectangle?o="stop":c instanceof IFPath?o="pencil":c instanceof IFPolygon&&(o="star")),o&&$("<span></span>").addClass("layer-icon fa fa-"+o).insertBefore(m),$("<span></span>").addClass("layer-lock fa fa-fw fa-"+(j?"lock":"unlock")).toggleClass("layer-default",!j).attr("title","Toggle Lock").on("click",function(a){a.stopPropagation(),f||IFEditor.tryRunTransaction(c,function(){c.setProperty("locked",!c.getProperty("locked"))},"Toggle Layer Locked")}).prependTo(l);{$("<span></span>").addClass("layer-visibility fa fa-"+(i?"eye-slash":"eye")).toggleClass("layer-default",!i).attr("title","Toggle Visibility").on("click",function(a){if(a.stopPropagation(),!e){var b=!c.getProperty("visible");b||c.removeFlag(IFNode.Flag.Highlighted),IFEditor.tryRunTransaction(c,function(){c.setProperty("visible",b)},"Toggle Layer Visibility"),b&&c.setFlag(IFNode.Flag.Highlighted)}}).on("mouseenter",function(){c.hasFlag(IFElement.Flag.Hidden)||c.setFlag(IFNode.Flag.Highlighted)}).on("mouseleave",function(){c.hasFlag(IFElement.Flag.Hidden)||c.removeFlag(IFNode.Flag.Highlighted)}).prependTo(l)}c instanceof IFLayer&&(c.getProperty("tp")!==IFLayer.Type.Guide&&$("<span></span>").addClass("layer-outline fa fa-"+(k?"circle-o":"circle")).toggleClass("layer-default",!k).attr("title","Toggle Outline").on("click",function(a){a.stopPropagation(),e||IFEditor.tryRunTransaction(c,function(){c.setProperty("otl",!c.getProperty("otl"))},"Toggle Layer Outline")}).appendTo(l),$("<span></span>").addClass("layer-color").gColorButton({scene:this._document.getScene(),immediateClose:!0}).gColorButton("value",c.getProperty("cls")).on("colorchange",function(a,b){IFEditor.tryRunTransaction(c,function(){var a=c.getProperty("cls");c.setProperty("cls",b),c.acceptChildren(function(c){if(c instanceof IFLayer){var d=c.getProperty("cls");IFColor.equals(d,a)&&c.setProperty("cls",b)}})},"Change Layer Color")}).appendTo(l))}},c.prototype._canMoveLayerTreeNode=function(a,b,c){return null!==this._getLayerTreeNodeMoveInfo(c,a.layerOrItem,b.layerOrItem)},c.prototype._moveLayerTreeNode=function(a){a.preventDefault();var b=this._getLayerTreeNodeMoveInfo(a.move_info.position,a.move_info.moved_node.layerOrItem,a.move_info.target_node.layerOrItem);b&&IFEditor.tryRunTransaction(this._document.getScene(),function(){b.source.getParent().removeChild(b.source),b.parent.insertChild(b.source,b.before);for(var a=null,c=b.parent;null!==c&&!(c instanceof IFPage);c=c.getParent())c.setFlag(IFNode.Flag.Expanded),a=c;this._updateLayer(a)}.bind(this),"Move Layer/Item")},c.prototype._getLayerTreeNodeMoveInfo=function(a,b,c){if(c=c||this._document.getScene().getActivePage(),b&&c&&"none"!==a){var d=null,e=null;if("inside"===a?(d=c,e=c.getFirstChild()):"before"===a?c instanceof IFPage?(d=c,e=c.getFirstChild()):(d=c.getParent(),e=c):"after"==a&&(c instanceof IFPage?(d=c,e=null):(d=c.getParent(),e=c.getNext())),e===b)return null;if(b.validateInsertion(d,e))return{parent:d,before:e,source:b}}return null},c.prototype._getLayerTreeNodeId=function(a){if(this._layersTreeNodeMap)for(var b=0;b<this._layersTreeNodeMap.length;++b)if(this._layersTreeNodeMap[b].node===a)return this._layersTreeNodeMap[b].treeId},c.prototype._getLayerTreeNode=function(a){return this._layersTree.tree("getNodeById",this._getLayerTreeNodeId(a))},c.prototype.toString=function(){return"[Object GPagesLayersSidebar]"},a.GPagesLayersSidebar=c}(this),function(a){function b(){GSidebar.call(this)}IFObject.inherit(b,GSidebar),b.ID="swatches-layers",b.TITLE=new IFLocale.Key(b,"title"),b.prototype._stylePanel=null,b.prototype._swatchPanel=null,b.prototype._swatchDeleteControl=null,b.prototype.getId=function(){return b.ID},b.prototype.getTitle=function(){return b.TITLE},b.prototype.getIcon=function(){return'<span class="fa fa-fw fa-leaf"></span>'},b.prototype.init=function(a){GSidebar.prototype.init.call(this,a),this._stylePanel=$("<div></div>").addClass("g-style-list").gStylePanel({allowNameEdit:!0,placeholder:"No Shared Styles"}).on("stylechange",function(a,b){this._document.getScene().getStyleCollection().acceptChildren(function(a){a.removeFlag(IFNode.Flag.Selected)}),b&&b.setFlag(IFNode.Flag.Selected),this._updateStyleControls()}.bind(this)),$("<div></div>").gPanel({title:"Shared Styles",content:this._stylePanel}).appendTo(a),this._swatchPanel=$("<div></div>").addClass("g-swatch-list").gSwatchPanel({allowNameEdit:!0,placeholder:"Drop Swatches here"}).on("swatchchange",function(a,b){this._document.getScene().getSwatchCollection().acceptChildren(function(a){a.removeFlag(IFNode.Flag.Selected)}),b&&b.setFlag(IFNode.Flag.Selected),this._updateSwatchControls()}.bind(this)),this._swatchDeleteControl=$("<button></button>").attr("title","Delete Selected Swatch").on("click",function(){var a=this._swatchPanel.gSwatchPanel("value"),b=this._document.getEditor();b.beginTransaction();try{a.getParent().removeChild(a)}finally{b.commitTransaction("Delete Swatch")}}.bind(this)).append($("<span></span>").addClass("fa fa-trash-o")),this._updateStyleControls(),this._updateSwatchControls(),$("<div></div>").gPanel({title:"Swatches",content:this._swatchPanel,controls:[this._swatchDeleteControl]}).appendTo(a)},b.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.Activated){this._document=a.document;var b=this._document.getScene();this._stylePanel.gStylePanel("attach",b.getStyleCollection()),this._stylePanel.gStylePanel("value",b.getStyleCollection().querySingle("sharedStyle:selected")),this._swatchPanel.gSwatchPanel("attach",b.getSwatchCollection()),this._swatchPanel.gSwatchPanel("value",b.getSwatchCollection().querySingle("swatch:selected")),this._updateStyleControls(),this._updateSwatchControls()}else if(a.type===GApplication.DocumentEvent.Type.Deactivated){var b=this._document.getScene();this._document=null,this._stylePanel.gStylePanel("detach"),this._swatchPanel.gSwatchPanel("detach"),this._updateStyleControls(),this._updateSwatchControls()}},b.prototype._updateStyleControls=function(){this._stylePanel.gStylePanel("value")},b.prototype._updateSwatchControls=function(){var a=this._swatchPanel.gSwatchPanel("value");this._swatchDeleteControl.prop("disabled",!a)},b.prototype.toString=function(){return"[Object GStylesSwatchesSidebar]"},a.GStylesSwatchesSidebar=b}(this),function(a){function b(){}IFObject.inherit(b,GStyleEntry);var c=new IFGradient([{position:0,color:IFColor.BLACK},{position:100,color:IFColor.WHITE}]);b.prototype.createContent=function(a,b,c){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").css("width","100%").append($("<select></select>").attr("data-element","type").append($("<option></option>").attr("value",IFPattern.Type.Color).text("Color")).append($("<optgroup></optgroup>").attr("label","Gradient").append($("<option></option>").attr("value",IFPattern.Type.Gradient+"#"+IFGradient.Type.Linear).text("Linear")).append($("<option></option>").attr("value",IFPattern.Type.Gradient+"#"+IFGradient.Type.Radial).text("Radial"))).on("change",function(){b()})).append($("<button></button>").attr("data-element","color").gColorButton({scene:a}).on("colorchange",function(){b()}))).append($("<div></div>").append($("<select></select>").attr("data-property","blm").gBlendMode().on("change",function(){b()})).append($("<input>").attr("data-property","opc").css("width","3em").on("change",function(a){var d=IFLength.parseEquationValue($(a.target).val());null!==d?b():c()})))).append($("<div></div>").css("width","100%").attr("data-element","gradient").append($("<div></div>").css("width","100%").css("display","block").append($("<div></div>").css("width","100%").gGradientEditor({scene:a}).on("change",function(){b()}))))},b.prototype.updateProperties=function(a,b){var d=b.getProperty("pat"),e=d?d.getPatternType():null,f=null;e===IFPattern.Type.Gradient&&(f=d.getType()),a.find('[data-element="type"]').val(f?e+"#"+f:e),a.find('[data-element="color"]').gColorButton("value",e===IFPattern.Type.Color?d:IFColor.BLACK).css("display",e===IFPattern.Type.Color?"":"none"),a.find('[data-property="blm"]').val(b.getProperty("blm")),a.find('[data-property="opc"]').val(ifUtil.formatNumber(100*b.getProperty("opc"))),e===IFPattern.Type.Gradient?(a.find('[data-element="gradient"]').css("display",""),a.find(".g-gradient-editor").gGradientEditor("value",d.getStops())):(a.find('[data-element="gradient"]').css("display","none"),a.find(".g-gradient-editor").gGradientEditor("value",c.getStops()))},b.prototype.assignProperties=function(a,b,c){var d=[],e=[];this._getPropertiesToAssign(a,b,c,d,e),b.setProperties(d,e)},b.prototype._getPropertiesToAssign=function(a,b,c,d,e){d.push("pat","blm","opc");var f=IFLength.parseEquationValue(a.find('[data-property="opc"]').val()),g=b.getProperty("pat"),h=g?g.getPatternType():null,i=null,j=a.find('[data-element="type"]').val(),k=null;if(j.indexOf("#")>=0){var l=j.split("#");j=l[0],k=l[1]}j===IFPattern.Type.Color?i=h===IFPattern.Type.Gradient?g.getStops()[0].color:a.find('[data-element="color"]').gColorButton("value"):j===IFPattern.Type.Gradient&&(i=h===IFPattern.Type.Color?new IFGradient([{position:0,color:g},{position:100,color:IFColor.WHITE}],k):new IFGradient(a.find(".g-gradient-editor").gGradientEditor("value"),k)),e.push(i,a.find('[data-property="blm"]').val(),(0>f?0:f>100?100:f)/100)},b.prototype.toString=function(){return"[Object GPatternPaintEntry]"},a.GPatternPaintEntry=b}(this),function(a){function b(){GPatternPaintEntry.call(this)}IFObject.inherit(b,GPatternPaintEntry),b.prototype.createContent=function(a,b,c){var d=GPatternPaintEntry.prototype.createContent.call(this,a,b,c);return $("<div></div>").attr("data-element","transform").append($("<div></div>").append($("<input>").attr("data-property","tx").css("width","3em").on("change",function(a){var d=IFLength.parseEquationValue($(a.target).val());null!==d?b():c()})).append($("<label></label>").text("X"))).append($("<div></div>").append($("<input>").attr("data-property","ty").css("width","3em").on("change",function(a){var d=IFLength.parseEquationValue($(a.target).val());null!==d?b():c()})).append($("<label></label>").text("Y"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","sx").on("change",function(a){var d=IFLength.parseEquationValue($(a.target).val());null!==d&&0!==d?b():c()})).append($("<label></label>").text("W"))).append($("<div></div>").append($("<input>").attr("data-property","sy").css("width","3em").on("change",function(a){var d=IFLength.parseEquationValue($(a.target).val());null!==d&&0!==d?b():c()})).append($("<label></label>").text("H"))).append($("<div></div>").append($("<input>").attr("data-property","rt").css("width","3em").on("change",function(a){var d=IFLength.parseEquationValue($(a.target).val());null!==d?b():c()})).append($("<label></label>").text("Â°"))).appendTo(d),d},b.prototype.updateProperties=function(a,b,c){GPatternPaintEntry.prototype.updateProperties.call(this,a,b,c);var d=b.getProperty("pat"),e=d?d.getPatternType():null,f=a.find('[data-element="transform"]');e!==IFPattern.Type.Color?(f.css("display",""),f.find('[data-property="tx"]').val(ifUtil.formatNumber(100*b.getProperty("tx"))),f.find('[data-property="ty"]').val(ifUtil.formatNumber(100*b.getProperty("ty"))),f.find('[data-property="sx"]').val(ifUtil.formatNumber(100*b.getProperty("sx"))),f.find('[data-property="sy"]').val(ifUtil.formatNumber(100*b.getProperty("sy"))).closest("div").css("display",d.getType()===IFGradient.Type.Linear?"none":""),f.find('[data-property="rt"]').val(ifUtil.formatNumber(ifMath.toDegrees(b.getProperty("rt")),2))):f.css("display","none")},b.prototype._getPropertiesToAssign=function(a,b,c,d,e){GPatternPaintEntry.prototype._getPropertiesToAssign.call(this,a,b,c,d,e),d.push("tx","ty","sx","sy","rt");var f=IFLength.parseEquationValue(a.find('[data-property="tx"]').val()),g=IFLength.parseEquationValue(a.find('[data-property="ty"]').val()),h=IFLength.parseEquationValue(a.find('[data-property="sx"]').val()),i=IFLength.parseEquationValue(a.find('[data-property="sy"]').val()),j=IFLength.parseEquationValue(a.find('[data-property="rt"]').val()),f=null!==f?f/100:0,g=null!==g?g/100:0,h=null!==h?h/100:1,i=null!==i?i/100:1,j=null!==j?ifMath.normalizeAngleRadians(ifMath.toRadians(j)):0,k=b.getProperty("pat"),l=k?k.getPatternType():null,m=null,n=a.find('[data-element="type"]').val(),o=null;if(n.indexOf("#")>=0){var p=n.split("#");n=p[0],o=p[1]}if(n===IFPattern.Type.Color)f=0,g=0,h=1,i=1,j=0;else if(n===IFPattern.Type.Gradient){if(l!==IFPattern.Type.Gradient||k.getType()!==o)if(o===IFGradient.Type.Linear)h=1,i=1,f=.5,g=.5,j=ifMath.toRadians(90);else{if(o!==IFGradient.Type.Radial)throw new Error("Unsupported Gradient Type");h=1,i=1,f=.5,g=.5,j=0}m=l===IFPattern.Type.Color?new IFGradient([{position:0,color:k},{position:100,color:IFColor.WHITE}],o):new IFGradient(a.find(".g-gradient-editor").gGradientEditor("value"),o)}e.push(f,g,h,i,j)},b.prototype.toString=function(){return"[Object GAreaPaintEntry]"},a.GAreaPaintEntry=b}(this),function(a){function b(){GAreaPaintEntry.call(this)}IFObject.inherit(b,GAreaPaintEntry),b.prototype.getEntryClass=function(){return IFFillPaint},b.prototype.getEntryName=function(){return"Fill"},b.prototype.createContent=function(a,b,c){return GAreaPaintEntry.prototype.createContent.call(this,a,b,c)},b.prototype.updateProperties=function(a,b,c){GAreaPaintEntry.prototype.updateProperties.call(this,a,b,c)},b.prototype.toString=function(){return"[Object GFillPaintEntry]"},a.GFillPaintEntry=b}(this),function(a){function b(){GAreaPaintEntry.call(this)}IFObject.inherit(b,GAreaPaintEntry),b.prototype.getEntryClass=function(){return IFStrokePaint},b.prototype.getEntryName=function(){return"Stroke"},b.prototype.createContent=function(a,b,c){var d=GAreaPaintEntry.prototype.createContent.call(this,a,b,c);return $("<div></div>").attr("data-element","stroke-settings").css("display","none").append($("<div></div>").append($("<select></select>").attr("data-property","slc").append($("<option></option>").attr("value",IFPaintCanvas.LineCap.Butt).text("Butt")).append($("<option></option>").attr("value",IFPaintCanvas.LineCap.Round).text("Round")).append($("<option></option>").attr("value",IFPaintCanvas.LineCap.Square).text("Square")).on("change",function(){b()})).append($("<label></label>").text("Caption"))).append($("<div></div>").append($("<select></select>").attr("data-property","slj").append($("<option></option>").attr("value",IFPaintCanvas.LineJoin.Miter).text("Miter")).append($("<option></option>").attr("value",IFPaintCanvas.LineJoin.Bevel).text("Bevel")).append($("<option></option>").attr("value",IFPaintCanvas.LineJoin.Round).text("Round")).on("change",function(){b()})).append($("<label></label>").text("Join"))).append($("<div></div>").append($("<input>").css("width","5em").attr("data-property","slm").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d&&d>=0?b():c()})).append($("<label></label>").text("Miter"))).prependTo(d),$("<div></div>").append($("<div></div>").append($("<input>").attr("data-property","sw").css("width","5em").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d&&d>0?b():c()})).append($("<label></label>").text("Stroke"))).append($("<div></div>").append($("<select></select>").attr("data-property","sa").append($("<option></option>").attr("value",IFStrokePaint.Alignment.Center).text("Center")).append($("<option></option>").attr("value",IFStrokePaint.Alignment.Inside).text("Inside")).append($("<option></option>").attr("value",IFStrokePaint.Alignment.Outside).text("Outside")).on("change",function(){b()})).append($("<label></label>").text("Align"))).append($("<div></div>").css("width","100%").css("text-align","right").append($("<button></button>").css("margin-right","0px").attr("data-element","more").on("click",function(){var a=$(this),b=a.hasClass("g-active");a.toggleClass("g-active",!b),a.closest(".g-form").find('[data-element="stroke-settings"]').css("display",b?"none":"")}).append($("<span></span>").addClass("fa fa-cog"))).append($("<label>&nbsp;</label>"))).prependTo(d),d},b.prototype.updateProperties=function(a,b,c){GAreaPaintEntry.prototype.updateProperties.call(this,a,b,c),a.find('[data-property="sw"]').val(c.pointToString(b.getProperty("sw"))),a.find('[data-property="sa"]').val(b.getProperty("sa")),a.find('[data-property="slc"]').val(b.getProperty("slc")),a.find('[data-property="slj"]').val(b.getProperty("slj")),a.find('[data-property="slm"]').val(c.pointToString(b.getProperty("slm")))},b.prototype._getPropertiesToAssign=function(a,b,c,d,e){GAreaPaintEntry.prototype._getPropertiesToAssign.call(this,a,b,c,d,e),d.push("sw","sa","slc","slj","slm"),e.push(c.stringToPoint(a.find('[data-property="sw"]').val()),a.find('[data-property="sa"]').val(),a.find('[data-property="slc"]').val(),a.find('[data-property="slj"]').val(),c.stringToPoint(a.find('[data-property="slm"]').val()))},b.prototype.toString=function(){return"[Object GStrokePaintEntry]"},a.GStrokePaintEntry=b}(this),function(a){function b(){}IFObject.inherit(b,GStyleEntry),b.prototype.getEntryClass=function(){return IFBlurFilter},b.prototype.getEntryName=function(){return"Blur"},b.prototype.createContent=function(a,b,c){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").text("Blur")).append($("<div></div>").css("width","100%").append($("<input>").css("width","100%").attr("type","range").attr("min","0").attr("max","50").attr("data-property","r").on("input",function(){var a=$(this);a.parents(".g-form").find('[data-property="r"]:not([type="range"])').val(a.val()),b()}))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","r").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d&&d>=0?b():c()}))))},b.prototype.updateProperties=function(a,b,c){a.find('[data-property="r"]').val(c.pointToString(b.getProperty("r")))},b.prototype.assignProperties=function(a,b,c){b.setProperties(["r"],[c.stringToPoint(a.find('[data-property="r"]:not([type="range"])').val())])},b.prototype.toString=function(){return"[Object GBlurFilterEntry]"},a.GBlurFilterEntry=b}(this),function(a){function b(){}IFObject.inherit(b,GStyleEntry),b.prototype.getEntryClass=function(){return IFOffsetVEffect},b.prototype.getEntryName=function(){return"Offset"},b.prototype.createContent=function(a,b,c){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").text("Offset")).append($("<div></div>").css("width","100%").append($("<input>").css("width","100%").attr("type","range").attr("min","0").attr("max","50").attr("data-property","r").on("input",function(){var a=$(this);a.parents(".g-form").find('[data-property="r"]:not([type="range"])').val(a.val()),b()}))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","r").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d&&d>=0?b():c()}))).append($("<div></div>").append($("<select></select>").attr("data-property","tp").append($("<option></option>").attr("value",IFOffsetVEffect.OffsetType.Inset).text("Inset")).append($("<option></option>").attr("value",IFOffsetVEffect.OffsetType.Outset).text("Outset")).append($("<option></option>").attr("value",IFOffsetVEffect.OffsetType.Both).text("Both")).on("change",function(){b()}))))},b.prototype.updateProperties=function(a,b,c){a.find('[data-property="r"]').val(c.pointToString(b.getProperty("r"))),a.find('[data-property="tp"]').val(b.getProperty("tp"))},b.prototype.assignProperties=function(a,b,c){b.setProperties(["r","tp"],[c.stringToPoint(a.find('[data-property="r"]:not([type="range"])').val()),a.find('[data-property="tp"]').val()])},b.prototype.toString=function(){return"[Object GOffsetVEffectEntry]"},a.GOffsetVEffectEntry=b}(this),function(a){function b(){}IFObject.inherit(b,GStyleEntry),b.prototype.getEntryClass=function(){return IFShadowEffect},b.prototype.getEntryName=function(){return"Shadow"},b.prototype.createContent=function(a,b,c){return $("<div></div>").addClass("g-form").append($("<div></div>").append($("<div></div>").append($("<div></div>").css("width","4.5em").addClass("g-switch").append($("<label></label>").append($("<input>").attr("type","checkbox").attr("data-property","in").on("change",function(){b()})).append($("<span></span>").addClass("switch").attr({"data-on":"Inside","data-off":"Outside"})))).append($("<label></label>").text("Shadow"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","x").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d?b():c()})).append($("<label></label>").text("X"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","y").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d?b():c()})).append($("<label></label>").text("Y"))).append($("<div></div>").append($("<input>").css("width","3em").attr("data-property","r").on("change",function(){var d=a.stringToPoint($(this).val());null!==d&&"number"==typeof d&&d>=0?b():c()})).append($("<label></label>").text("Blur"))).append($("<div></div>").append($("<button></button>").attr("data-property","cls").gColorButton({scene:a}).on("colorchange",function(){b()})).append($("<label></label>").text("Color"))))},b.prototype.updateProperties=function(a,b,c){a.find('[data-property="in"]').prop("checked",b.getProperty("in")),a.find('[data-property="x"]').val(c.pointToString(b.getProperty("x"))),a.find('[data-property="y"]').val(c.pointToString(b.getProperty("y"))),a.find('[data-property="r"]').val(c.pointToString(b.getProperty("r"))),a.find('[data-property="cls"]').gColorButton("value",b.getProperty("cls"))},b.prototype.assignProperties=function(a,b,c){b.setProperties(["in","x","y","r","cls"],[a.find('[data-property="in"]').is(":checked"),c.stringToPoint(a.find('[data-property="x"]').val()),c.stringToPoint(a.find('[data-property="y"]').val()),c.stringToPoint(a.find('[data-property="r"]').val()),a.find('[data-property="cls"]').gColorButton("value")])},b.prototype.toString=function(){return"[Object GShadowEffectEntry]"},a.GShadowEffectEntry=b}(this),function(a){function b(){this._elements=[]}IFObject.inherit(b,GTransformer),b._AlignTo={Selection:"selection",Layer:"layer",Page:"page",PageMargins:"page-margins",FirstElement:"first-element",LastElement:"last-element"},b._AlignOn={Geometry:"geometry",Painted:"painted"},b.prototype._panel=null,b.prototype._controls=null,b.prototype._document=null,b.prototype._elements=null,b.prototype._savedAlignTo=b._AlignTo.Selection,b.prototype.getCategory=function(){return"Align"},b.prototype.init=function(a,c){this._panel=a,this._controls=c,$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Align To:")).append($("<td></td>").attr("colspan","3").append($("<select></select>").attr("data-option","align-to").append($("<option></option>").attr("value",b._AlignTo.Selection).text("Selection")).append($("<option></option>").attr("value",b._AlignTo.Layer).text("Active Layer")).append($("<option></option>").attr("value",b._AlignTo.Page).text("Active Page")).append($("<option></option>").attr("value",b._AlignTo.PageMargins).text("Active Page Margins")).append($("<option></option>").attr("value",b._AlignTo.FirstElement).text("First Selected Element")).append($("<option></option>").attr("value",b._AlignTo.LastElement).text("Last Selected Element")).on("change",function(a){this._savedAlignTo=$(a.target).val(),this._updateStates()}.bind(this))))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Align On:")).append($("<td></td>").attr("colspan","3").append($("<select></select>").attr("data-option","align-on").append($("<option></option>").attr("value",b._AlignOn.Geometry).text("Geometry")).append($("<option></option>").attr("value",b._AlignOn.Painted).text("Painted"))))).append($("<tr></tr>").append($("<td></td>").attr("colspan",4).append($("<hr>")))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Horizontal:")).append($("<td></td>").attr("colspan","3").append($("<button></button>").attr("title","Align Left").attr("data-align",GAlignAction.Type.AlignLeft).append($("<span></span>").addClass("fa fa-align-left"))).append($("<button></button>").attr("title","Align Center").attr("data-align",GAlignAction.Type.AlignCenter).append($("<span></span>").addClass("fa fa-align-center"))).append($("<button></button>").attr("title","Align Right").attr("data-align",GAlignAction.Type.AlignRight).append($("<span></span>").addClass("fa fa-align-right"))).append($("<button></button>").attr("title","Justify Horizontal").attr("data-align",GAlignAction.Type.AlignJustifyHorizontal).append($("<span></span>").addClass("fa fa-align-justify fa-rotate-270"))))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Vertical:")).append($("<td></td>").attr("colspan","3").append($("<button></button>").attr("title","Align Top").attr("data-align",GAlignAction.Type.AlignTop).append($("<span></span>").addClass("fa fa-align-right fa-rotate-270"))).append($("<button></button>").attr("title","Align Middle").attr("data-align",GAlignAction.Type.AlignMiddle).append($("<span></span>").addClass("fa fa-align-center fa-rotate-270"))).append($("<button></button>").attr("title","Align Bottom").attr("data-align",GAlignAction.Type.AlignBottom).append($("<span></span>").addClass("fa fa-align-left fa-rotate-270"))).append($("<button></button>").attr("title","Justify Vertical").attr("data-align",GAlignAction.Type.AlignJustifyVertical).append($("<span></span>").addClass("fa fa-align-justify"))))).append($("<tr></tr>").append($("<td></td>").addClass("label").text("Distribute:")).append($("<td></td>").attr("colspan","3").append($("<input>").attr("title","Horizontal Spacing, zero will auto-space").attr("data-dist",GDistributeAction.Type.Horizontal).css("width","3em").val("0")).append($("<button></button>").attr("title","Distribute Horizontal").attr("data-dist",GDistributeAction.Type.Horizontal).append($("<span></span>").addClass("fa fa-reorder fa-rotate-270"))).append($("<input>").attr("title","Vertical Spacing, zero will auto-space").attr("data-dist",GDistributeAction.Type.Vertical).css("width","3em").css("margin-left","10px").val("0")).append($("<button></button>").attr("title","Distribute Vertical").attr("data-dist",GDistributeAction.Type.Vertical).append($("<span></span>").addClass("fa fa-reorder"))))).appendTo(a);
var d=function(a){var b=this,c="selection"===a?"Align Selection":"Align Individual Elements",d="selection"===a?"Selection":"Individual";return $("<button></button>").addClass("g-button "+("selection"===a?"g-active":"")).attr("title",c).attr("data-apply",a).text(d).on("click",function(){$(this).hasClass("g-active")||("selection"===a?(b._controls.find('button[data-apply="objects"]').removeClass("g-active"),b._controls.find('button[data-apply="selection"]').addClass("g-active")):(b._controls.find('button[data-apply="selection"]').removeClass("g-active"),b._controls.find('button[data-apply="objects"]').addClass("g-active")))})}.bind(this);c.append(d("selection")).append(d("objects"));var e=function(a){this._executeAction($(a.target).closest("button").attr("data-align"),"align")}.bind(this),f=function(a){this._executeAction($(a.target).closest("button").attr("data-dist"),"dist")}.bind(this);this._panel.find("button[data-align]").each(function(a,b){$(b).on("click",e)}),this._panel.find("button[data-dist]").each(function(a,b){$(b).on("click",f)}),this._panel.find("input[data-dist]").each(function(a,b){$(b).on("keyup",function(a){13===a.keyCode&&f.call(this,a)})})},b.prototype.update=function(a,c){return this._document=a,this._elements=c,this._panel.find('select[data-option="align-to"]').val(this._elements&&1===this._elements.length?b._AlignTo.Page:this._savedAlignTo),this._updateStates(),!0},b.prototype._getActionArgs=function(a,c){var d=null,e=this._elements.slice(),f=this._document.getScene(),g=f.getActivePage(),h=f.getActiveLayer(),i=this._panel.find('select[data-option="align-to"]').val();switch(i){case b._AlignTo.Layer:d=h.getPaintBBox();break;case b._AlignTo.Page:d=g.getGeometryBBox();break;case b._AlignTo.PageMargins:d=g.getGeometryBBox().expanded(-g.getProperty("ml"),-g.getProperty("mt"),-g.getProperty("mr"),-g.getProperty("mb"));break;case b._AlignTo.FirstElement:d=e[0],e.splice(0);break;case b._AlignTo.LastElement:d=e[e.length-1],e.splice(e.length-1)}if(e.length>0){var j=this._panel.find('select[data-option="align-on"]').val()===b._AlignOn.Geometry;if("align"===c){var k=i!==b._AlignTo.Selection?this._controls.find('button[data-apply="selection"]').hasClass("g-active"):!1;return{actionId:GAlignAction.ID+"."+a,actionParams:[e,k,j,d]}}if("dist"===c){var l=f.stringToPoint(this._panel.find('input[data-dist="'+a+'"]').val())||0;return{actionId:GDistributeAction.ID+"."+a,actionParams:[e,j,d,l]}}throw new Error("Unknown align mode: "+c)}},b.prototype._executeAction=function(a,b){var c=this._getActionArgs(a,b);c&&gApp.executeAction(c.actionId,c.actionParams)},b.prototype._isActionEnabled=function(a,b){var c=this._getActionArgs(a,b);return c?gApp.canExecuteAction(c.actionId,c.actionParams):!1},b.prototype._updateStates=function(){var a=this._panel.find('select[data-option="align-to"]').val(),c=a!==b._AlignTo.Selection&&this._elements.length>1;this._controls.find('button[data-apply="selection"]').css("display",c?"":"none"),this._controls.find('button[data-apply="objects"]').css("display",c?"":"none"),this._panel.find("[data-align]").each(function(a,b){var c=$(b);c.prop("disabled",!this._isActionEnabled(c.attr("data-align"),"align"))}.bind(this)),this._panel.find("[data-dist]").each(function(a,b){var c=$(b);c.prop("disabled",!this._isActionEnabled(c.attr("data-dist"),"dist"))}.bind(this))},b.prototype.toString=function(){return"[Object GAlignTransformer]"},a.GAlignTransformer=b}(this),function(a){function b(){this._elements=[]}IFObject.inherit(b,GTransformer),b._TransformMode={Move:"move",Scale:"scale",Rotate:"rotate",Skew:"skew",Reflect:"reflect"},b.prototype._panel=null,b.prototype._controls=null,b.prototype._document=null,b.prototype._elements=null,b.prototype._transformMode=null,b.prototype.getCategory=function(){return"Adjust"},b.prototype.init=function(a,c){this._panel=a,this._controls=c,$("<button></button>").attr("title","Move").attr("data-mode",b._TransformMode.Move).append($("<span></span>").addClass("fa fa-arrows")).appendTo(c),$("<button></button>").attr("title","Scale").attr("data-mode",b._TransformMode.Scale).append($("<span></span>").addClass("fa fa-expand")).appendTo(c),$("<button></button>").attr("title","Rotate").attr("data-mode",b._TransformMode.Rotate).append($("<span></span>").addClass("fa fa-rotate-right")).appendTo(c),$("<button></button>").attr("title","Skew").attr("data-mode",b._TransformMode.Skew).append($("<span></span>").addClass("fa fa-eraser")).appendTo(c),$("<button></button>").attr("title","Reflect").attr("data-mode",b._TransformMode.Reflect).append($("<span></span>").addClass("fa fa-star-half-o")).appendTo(c),$("<button></button>").css("margin-left","7px").text("Apply").on("click",this._apply.bind(this)).appendTo(c),c.find("button[data-mode]").each(function(a,b){var c=$(b);c.on("click",function(){this._setTransformMode(c.attr("data-mode"))}.bind(this))}.bind(this));(function(a){var b=this;return $("<input>").attr("type","text").attr("data-dimension",a).css("width","5em").on("change",function(){b._assignDimension(a,$(this).val())})}).bind(this);$("<table></table>").addClass("g-form").css("margin","0px auto").append($("<tr></tr>").append($("<td></td>").addClass("label").text("Pivot:")).append($("<td></td>").append($("<div></div>").attr("data-property","pivot").css("display","inline-block").gPivot().on("pivotchange",function(){}))).append($("<td></td>").addClass("label").text("Copies:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","copies").val("0")))).append($("<tr></tr>").attr("data-mode",b._TransformMode.Move).append($("<td></td>").addClass("label").text("X:")).append($("<td></td>").append($("<input>").css("width","5em").attr("data-property","x").val("0"))).append($("<td></td>").addClass("label").text("Y:")).append($("<td></td>").append($("<input>").css("width","5em").attr("data-property","y").val("0")))).append($("<tr></tr>").attr("data-mode",b._TransformMode.Scale).append($("<td></td>").addClass("label").text("W:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","w").val("100")).append($("<span></span>").text("%"))).append($("<td></td>").addClass("label").text("H:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","h").val("100")).append($("<span></span>").text("%")))).append($("<tr></tr>").attr("data-mode",b._TransformMode.Rotate).append($("<td></td>").addClass("label").text("Angle:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","angle").val("0")).append($("<span></span>").text("Â°"))).append($("<td></td>").attr("colspan","2"))).append($("<tr></tr>").attr("data-mode",b._TransformMode.Skew).append($("<td></td>").addClass("label").text("X:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","x").val("0")).append($("<span></span>").text("Â°"))).append($("<td></td>").addClass("label").text("Y:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","y").val("0")).append($("<span></span>").text("Â°")))).append($("<tr></tr>").attr("data-mode",b._TransformMode.Reflect).append($("<td></td>").addClass("label").text("Axis:")).append($("<td></td>").append($("<input>").css("width","4em").attr("data-property","axis").val("0")).append($("<span></span>").text("Â°"))).append($("<td></td>").attr("colspan","2"))).append($("<tr></tr>").append($("<td></td>").css("display","none").attr("colspan","4"))).appendTo(a),this._setTransformMode(b._TransformMode.Move)},b.prototype.update=function(a,b){return this._document=a,this._elements=b,this._panel.find('[data-property="pivot"]').gPivot("value",IFRect.Side.CENTER),!0},b.prototype._setTransformMode=function(a){this._transformMode=a,this._controls.find("button[data-mode]").each(function(b,c){var d=$(c);d.toggleClass("g-active",d.attr("data-mode")===a)}.bind(this)),this._panel.find("tr[data-mode]").each(function(b,c){var d=$(c);d.css("display",d.attr("data-mode")===a?"":"none")})},b.prototype._apply=function(){var a=this._document.getScene(),c=parseInt(this._panel.find('[data-property="copies"]').val()),d=this._panel.find('[data-property="pivot"]').gPivot("value"),e=null,f=this._panel.find('[data-mode="'+this._transformMode+'"]');if(this._transformMode===b._TransformMode.Move){var g=a.stringToPoint(f.find('[data-property="x"]').val())||0,h=a.stringToPoint(f.find('[data-property="y"]').val())||0;(0!==g||0!==h)&&(e=function(a,b){b.transform(new IFTransform(1,0,0,1,g*a,h*a))})}else if(this._transformMode===b._TransformMode.Scale){var i=parseFloat(f.find('[data-property="w"]').val())/100||1,j=parseFloat(f.find('[data-property="h"]').val())/100||1;(1!==i||1!==j)&&(e=function(a,b,c){b.transform((new IFTransform).translated(-c.getX(),-c.getY()).scaled(i+(i-1)*(a-1),j+(j-1)*(a-1)).translated(c.getX(),c.getY()))})}else if(this._transformMode===b._TransformMode.Rotate){var k=ifMath.toRadians(parseFloat(f.find('[data-property="angle"]').val()))||0;0!==k&&(e=function(a,b,c){b.transform((new IFTransform).translated(-c.getX(),-c.getY()).rotated(-k*a).translated(c.getX(),c.getY()))})}else if(this._transformMode===b._TransformMode.Skew){var i=ifMath.toRadians(parseFloat(f.find('[data-property="x"]').val()))||0,j=ifMath.toRadians(parseFloat(f.find('[data-property="y"]').val()))||0;(0!==i||0!==j)&&i>-ifMath.PIHALF&&j>-ifMath.PIHALF&&i<ifMath.PIHALF&&j<ifMath.PIHALF&&(e=function(a,b,c){b.transform((new IFTransform).translated(-c.getX(),-c.getY()).skewed(i*a,j*a).translated(c.getX(),c.getY()))})}else if(this._transformMode===b._TransformMode.Reflect){var k=parseFloat(f.find('[data-property="axis"]').val())||0;k=ifMath.toRadians(-k);var l=Math.cos(k),m=Math.sin(k);e=function(a,b,c){a%2&&b.transform((new IFTransform).translated(-c.getX(),-c.getY()).multiplied(new IFTransform(l,-m,m,l,0,0)).multiplied(new IFTransform(1,0,0,-1,0,0)).multiplied(new IFTransform(l,m,-m,l,0,0)).translated(c.getX(),c.getY()))}}e&&IFEditor.tryRunTransaction(a,function(){for(var a=[],b=null,f=0;f<this._elements.length;++f){var g=this._elements[f];d&&(b=b?b.united(g.getGeometryBBox()):g.getGeometryBBox());var h=[g];if(c>0)for(var i=g.getParent(),j=g.getNext()?g.getNext():null,k=0;c>k;++k){var l=g.clone();i.insertChild(l,j),h.push(l)}a.push(h)}var m=null;b&&!b.isEmpty()&&(m=b.getSide(d));for(var f=0;f<a.length;++f)for(var h=a[f],n=1;n<=h.length;++n)e(n,h[n-1],m)}.bind(this),"Adjust Transformation")},b.prototype.toString=function(){return"[Object GAdjustTransformer]"},a.GAdjustTransformer=b}(this),ifLocale.setValues(GAddLayerAction,IFLocale.Language.English,["title"],["Add Layer"]),ifLocale.setValues(GAddPageAction,IFLocale.Language.English,["title"],["Add Page"]),ifLocale.setValues(GAlignAction,IFLocale.Language.English,["title.align-left","title.align-center","title.align-right","title.align-top","title.align-middle","title.align-bottom","title.align-justify-horizontal","title.align-justify-vertical"],["Align Left","Align Center","Align Right","Align Top","Align Middle","Align Bottom","Justify Horizontal","Justify Vertical"]),ifLocale.setValues(GCloneAction,IFLocale.Language.English,["title"],["Clone"]),ifLocale.setValues(GCloseAction,IFLocale.Language.English,["title"],["Close"]),ifLocale.setValues(GCloseAllAction,IFLocale.Language.English,["title"],["Close All"]),ifLocale.setValues(GCopyAction,IFLocale.Language.English,["title"],["Copy"]),ifLocale.setValues(GCopyAttributesAction,IFLocale.Language.English,["title"],["Copy Attributes"]),ifLocale.setValues(GCutAction,IFLocale.Language.English,["title"],["Cut"]),ifLocale.setValues(GDeleteAction,IFLocale.Language.English,["title"],["Delete"]),ifLocale.setValues(GDeleteLayerAction,IFLocale.Language.English,["title"],["Delete Layer"]),ifLocale.setValues(GDeletePageAction,IFLocale.Language.English,["title"],["Delete Page"]),ifLocale.setValues(GDistributeAction,IFLocale.Language.English,["title.horizontal","title.vertical"],["Distribute Horizontally","Distribute Vertically"]),ifLocale.setValues(GDuplicateAction,IFLocale.Language.English,["title"],["Duplicate"]),ifLocale.setValues(GFitAllAction,IFLocale.Language.English,["title"],["Fit All"]),ifLocale.setValues(GFitCurrentLayerAction,IFLocale.Language.English,["title"],["Fit Layer"]),ifLocale.setValues(GFitCurrentPageAction,IFLocale.Language.English,["title"],["Fit Page"]),ifLocale.setValues(GFitSelectionAction,IFLocale.Language.English,["title"],["Fit Selection"]),ifLocale.setValues(GGroupAction,IFLocale.Language.English,["title"],["Group Selection"]),ifLocale.setValues(GPlaceImageAction,IFLocale.Language.English,["title"],["Place Image..."]),ifLocale.setValues(GInvertSelectionAction,IFLocale.Language.English,["title"],["Invert Selection"]),ifLocale.setValues(GLayerTypeAction,IFLocale.Language.English,["title"],["%name% Layer"]),ifLocale.setValues(GNewAction,IFLocale.Language.English,["title"],["New..."]),ifLocale.setValues(GNewWindowAction,IFLocale.Language.English,["title"],["New Window"]),ifLocale.setValues(GOpenAction,IFLocale.Language.English,["title"],["Open..."]),ifLocale.setValues(GArrangeAction,IFLocale.Language.English,["title.send-front","title.bring-forward","title.send-backward","title.send-back"],["Send To Front","Bring Forward","Send Backward","Send To Back"]),ifLocale.setValues(GOriginalViewAction,IFLocale.Language.English,["title"],["Original-View"]),ifLocale.setValues(GPaintModeAction,IFLocale.Language.English,["title"],["%name% View"]),ifLocale.setValues(GPasteAction,IFLocale.Language.English,["title"],["Paste"]),ifLocale.setValues(GPasteInsideAction,IFLocale.Language.English,["title"],["Paste Inside Selection"]),ifLocale.setValues(GPasteAttributesAction,IFLocale.Language.English,["title"],["Paste Attributes"]),ifLocale.setValues(GPixelPreviewAction,IFLocale.Language.English,["title"],["Pixel Preview"]),ifLocale.setValues(GRedoAction,IFLocale.Language.English,["title"],["Redo"]),ifLocale.setValues(GSaveAction,IFLocale.Language.English,["title"],["Save"]),ifLocale.setValues(GSaveAllAction,IFLocale.Language.English,["title"],["Save All"]),ifLocale.setValues(GSaveAsAction,IFLocale.Language.English,["title"],["Save As..."]),ifLocale.setValues(GShowRulersAction,IFLocale.Language.English,["title"],["Show Rulers"]),ifLocale.setValues(GSelectAllAction,IFLocale.Language.English,["title"],["Select All"]),ifLocale.setValues(GShowAllPagesAction,IFLocale.Language.English,["title"],["All Pages visible"]),ifLocale.setValues(GShowGridAction,IFLocale.Language.English,["title"],["Show Grid"]),ifLocale.setValues(GSnapUnitAction,IFLocale.Language.English,["title.full","title.half"],["Snap to full units","Snap to half units"]),ifLocale.setValues(GTransformAction,IFLocale.Language.English,["title.rotate-45-left","title.rotate-90-left","title.rotate-180-left","title.rotate-45-right","title.rotate-90-right","title.rotate-180-right","title.flip-vertical","title.flip-horizontal"],["Rotate 45Â° Left","Rotate 90Â° Left","Rotate 180Â° Left","Rotate 45Â° Right","Rotate 90Â° Right","Rotate 180Â° Right","Flip Vertical","Flip Horizontal"]),ifLocale.setValues(GUndoAction,IFLocale.Language.English,["title"],["Undo"]),ifLocale.setValues(GUngroupAction,IFLocale.Language.English,["title"],["Ungroup Selection"]),ifLocale.setValues(GZoomInAction,IFLocale.Language.English,["title"],["Zoom in"]),ifLocale.setValues(GZoomOutAction,IFLocale.Language.English,["title"],["Zoom out"]),ifLocale.setValues(GAnalogousMatcher,IFLocale.Language.English,["title"],["Analogous"]),ifLocale.setValues(GComplementaryMatcher,IFLocale.Language.English,["title"],["Complementary"]),ifLocale.setValues(GExportPalette,IFLocale.Language.English,["title"],["Export"]),ifLocale.setValues(GPropertiesPalette,IFLocale.Language.English,["title"],["Properties"]),ifLocale.setValues(GStylePalette,IFLocale.Language.English,["title"],["Style"]),ifLocale.setValues(GTransformPalette,IFLocale.Language.English,["title"],["Transform"]),ifLocale.setValues(GStylesSwatchesSidebar,IFLocale.Language.English,["title"],["Styles & Swatches"]),ifLocale.setValues(GPagesLayersSidebar,IFLocale.Language.English,["title"],["Pages & Layers"]),function(){function a(){}IFObject.inherit(a,GModule),a.prototype.init=function(){gravit.exporters.push(new GImageExporter),gravit.palettes.push(new GPropertiesPalette,new GTransformPalette,new GExportPalette,new GStylePalette),gravit.sidebars.push(new GPagesLayersSidebar,new GStylesSwatchesSidebar),gravit.tools.push({instance:new IFPointerTool,title:"Pointer",category:GApplication.TOOL_CATEGORY_SELECT,group:"select",keys:["V","0"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M3.5,18.5v18l5-7h9L3.5,18.5z"/>\n</svg>'},{instance:new IFLassoTool,title:"Lasso",category:GApplication.TOOL_CATEGORY_SELECT,group:"select",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M18.5,27c-3.7,0-4.7,2.9-5.5,5.2c-0.7,2-1.2,3.2-2.5,3.2c-0.8,0-1.5-0.3-2.1-0.8\n	c-0.4-0.4-0.7-0.9-0.9-1.5c0.6-0.4,1-1,1-1.7c0-0.2,0-0.4-0.1-0.6c0.8-0.5,1.7-1.2,2.5-2c3.5-3.5,4.6-7.6,2.7-9.5\n	c-0.6-0.6-1.5-0.9-2.4-0.9c-2.1,0-4.7,1.3-7,3.6c-3.5,3.5-4.6,7.6-2.7,9.5c0.6,0.6,1.5,0.9,2.4,0.9c0.3,0,0.6,0,0.9-0.1\n	c0.3,0.6,1,1.1,1.8,1.1c0,0,0,0,0,0c0.3,0.7,0.6,1.4,1.2,1.9c0.7,0.7,1.7,1.1,2.8,1.1c2.2,0,2.8-2,3.5-4c0.8-2.3,1.6-4.6,4.5-4.6\n	C18.5,28,18.5,27,18.5,27z M2.1,30.9c-0.9-0.9-0.6-2.4-0.4-3.2c0.5-1.6,1.5-3.4,3.1-4.9c2-2,4.5-3.3,6.3-3.3c0.7,0,1.3,0.2,1.7,0.6\n	c0.4,0.4,0.6,1,0.6,1.7c0,1.9-1.3,4.3-3.3,6.3c-0.7,0.7-1.5,1.4-2.3,1.9c-0.4-0.3-0.8-0.5-1.4-0.5c-1.1,0-2,0.9-2,1.9\n	c-0.2,0-0.4,0.1-0.7,0.1C3.1,31.5,2.5,31.3,2.1,30.9z"/>\n</svg>'},{instance:new IFSubSelectTool,title:"Subselect",category:GApplication.TOOL_CATEGORY_SELECT,group:"select2",keys:["A","1"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M3.5,18.5v18l5-7h9L3.5,18.5z M7.5,27.5l-3,4.5V20.5l9,7H7.5z"/>\n</svg>'},{instance:new IFPageTool,title:"Page",category:GApplication.TOOL_CATEGORY_SELECT,group:"select3",keys:["D"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M15.5,18.5v10h-1v-9h-7v3h-3v10h3v1h-4v-12l3-3H15.5z M8.5,25.5v11l3.5-4h5.5L8.5,25.5z"/>\n</svg>'},{instance:new IFLayerTool,title:"Layer",category:GApplication.TOOL_CATEGORY_SELECT,group:"select3",keys:["L"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="-2.5 -.5 18 18" width="18px" height="18px">\n<path stroke="none" d="M0.5,8.5 L0.5,10.5 L4.5,10.5 L4.5,8.5 L0.5,8.5 Z M10.5,8.5 L10.5,10.5 L12.5,10.5 L12.5,8.5 L10.5,8.5 Z M9.5,8.5 L9.5,9.5 L10.5,9.5 L10.5,8.5 L9.5,8.5 Z M0.5,0.5 L0.5,2.5 L12.5,2.5 L12.5,0.5 L0.5,0.5 Z M0.5,4.5 L0.5,6.5 L12.5,6.5 L12.5,4.5 L0.5,4.5 Z M5.5,7.5 L5.5,18.5 L9,14.5 L14.5,14.5 L5.5,7.5 Z"></path>\n</svg>'},{instance:new IFTransformTool,title:"Transform",category:GApplication.TOOL_CATEGORY_SELECT,group:"transform",keys:["Q"],icon:'<span class="fa fa-arrows" style="font-size:16px"></span>'},{instance:new IFLineTool,title:"Line",category:GApplication.TOOL_CATEGORY_VECTOR,group:"line",keys:["N"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<rect stroke="none" x="9" y="15.3" transform="matrix(0.7069 0.7074 -0.7074 0.7069 22.2372 1.3418)" width="1" height="24.5"/>\n</svg>'},{instance:new IFPenTool,title:"Pen",category:GApplication.TOOL_CATEGORY_VECTOR,group:"path",keys:["P"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M9.2,21.3l0.7,0.7l-6.5,3.6c0,0-0.5,3.1-1.4,5.7c-0.8,2.2-2.1,3.6-1.4,4.3c0,0,0,0,0.7,0.7\n	c0.7,0.7,2.1-0.6,4.3-1.4c2.5-0.9,5.6-1.4,5.6-1.4l3.7-6.4l0.7,0.7l2.9-2.1l-7.1-7.1L9.2,21.3z M4.2,26.4l6.5-3.6l3.6,3.6l-3.7,6.4\n	c-4.8,0.5-8.5,2.8-8.5,2.8l3.2-3.2c0.8,0.5,1.8,0.3,2.4-0.3c0.8-0.8,0.8-2,0-2.8c-0.8-0.8-2-0.8-2.8,0c-0.7,0.7-0.8,1.7-0.4,2.5\n	l-3.2,3.2C1.4,34.9,3.7,31.2,4.2,26.4z"/>\n</svg>'},{instance:new IFBezigonTool,title:"Bezigon",category:GApplication.TOOL_CATEGORY_VECTOR,group:"path",keys:["B","8"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path d="M7.8,29.3c-1.8-1.7,4.4-10.8,4.4-10.8l1.3,1.2c-1.3,1.5-2.5,3.6-3.1,4.7c-1,1.8-1.1,2.7-1.1,2.7l6-5.7l3.1,3\n	C18.5,24.5,9.5,30.7,7.8,29.3z M18.5,33c0,0.8-0.7,1.5-1.5,1.5c-0.7,0-1.2-0.4-1.4-1H7.5v3h-7v-7h3v-8.1c-0.6-0.2-1-0.8-1-1.4\n	c0-0.8,0.7-1.5,1.5-1.5s1.5,0.7,1.5,1.5c0,0.7-0.4,1.2-1,1.4v8.1h3v3h8.1c0.2-0.6,0.8-1,1.4-1C17.8,31.5,18.5,32.2,18.5,33z\n	 M6.5,30.5h-5v5h5V30.5z" stroke="none"/>\n</svg>'},{instance:new IFRectangleTool,title:"Rectangle",category:GApplication.TOOL_CATEGORY_VECTOR,group:"shape",keys:["R"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M17.5,20.5v14h-16v-14H17.5 M18.5,19.5h-18v16h18v-15V19.5L18.5,19.5z"/>\n</svg>'},{instance:new IFEllipseTool,title:"Ellipse",category:GApplication.TOOL_CATEGORY_VECTOR,group:"shape2",keys:["E","3"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<ellipse style="fill:none; stroke: inherit" cx="9.5" cy="27.5" rx="8.5" ry="7.5"/>\n</svg>'},{instance:new IFPolygonTool,title:"Polygon",category:GApplication.TOOL_CATEGORY_VECTOR,group:"shape2",keys:["G"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M13.4,20.5l3.9,7l-3.9,7H5.6l-3.9-7l3.9-7H13.4 M14,19.5H5l-4.5,8l4.5,8h9l4.5-8L14,19.5L14,19.5z"/>\n</svg>'},{instance:new IFTextTool,title:"Text",category:GApplication.TOOL_CATEGORY_OTHER,group:"text",keys:["T"],icon:'<svg xmlns="http://www.w3.org/2000/svg">\n<text style="stroke:none; fill: inherit; font-family: Arial; font-size: 18px; text-anchor: middle" x="9" y="15">T</text>\n</svg>'},{instance:new IFSliceTool,title:"Slice",category:GApplication.TOOL_CATEGORY_OTHER,group:"slice",keys:["K"],icon:'<span class="fa fa-slack" style="font-size:16px"></span>'},{instance:new IFZoomTool,title:"Zoom",category:GApplication.TOOL_CATEGORY_VIEW,group:"zoom",keys:["Z"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M17.9,34L15,31.2c1-1.3,1.5-2.9,1.5-4.7c0-4.4-3.6-8.1-8-8.1c-4.4,0-8.1,3.6-8.1,8.1c0,4.4,3.6,8,8.1,8\n	c1.8,0,3.4-0.6,4.7-1.5l2.8,2.8c0.7,0.7,1.7,0.8,2.2,0.3C18.7,35.7,18.6,34.7,17.9,34z M1.6,26.5c0-3.8,3.1-6.9,6.9-6.9s7,3.1,7,6.9\n	s-3.1,7-7,7S1.6,30.3,1.6,26.5z"/>\n</svg>'},{instance:new IFHandTool,title:"Hand",category:GApplication.TOOL_CATEGORY_VIEW,group:"hand",keys:["H"],icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0.5 18.5 18 18">\n<path stroke="none" d="M13.7,22.6C10.3,19,7.9,19,7,19.2l-0.4-0.4c-0.1,0-0.5-0.3-1.1-0.3c-0.4,0-0.7,0.1-1,0.4\n	C4.2,19,4.1,19.2,4,19.4c-0.6-0.3-1.3-0.3-1.8,0.2c-0.3,0.3-0.5,0.7-0.5,1.1c0,0.1,0,0.3,0.1,0.4c-0.2,0.1-0.5,0.2-0.7,0.4\n	c-0.9,0.7-0.5,1.7-0.2,2.3c2.7,2.6,5.6,5.8,6.1,7c-0.5-0.2-1.4-0.9-1.9-1.4c-1.7-1.4-2.8-2.2-3.6-1.7c-0.6,0.3-0.7,0.8-0.8,1.1\n	c-0.4,1.5,3.4,5.2,3.6,5.4c1.2,1.3,8.9,2.4,8.9,2.4c0.1,0,0.2,0,0.3-0.1l4.8-3.3c0.1-0.1,0.2-0.2,0.2-0.4\n	C18.5,32.5,18.7,27.8,13.7,22.6z M13.1,35.5L13.1,35.5c-2.9-0.4-7.4-1.3-8.1-2.1c0,0-0.1-0.1-0.2-0.2c-2.6-2.7-3.6-4.1-3.1-4.6\n	c0.1-0.1,0.2-0.1,0.4-0.1c0.5,0,1.4,0.7,2.1,1.3L4.4,30c1,0.8,2.1,1.6,2.8,1.6c0.2,0,0.4-0.1,0.5-0.2c0.1-0.1,0.1-0.2,0.1-0.3\n	c0-1.3-3.2-5.1-6.3-8c-0.2-0.3-0.3-0.7,0-1C1.8,22,2,21.9,2.2,21.9c0.2,0,0.3,0.1,0.4,0.1l4.5,4.3c0.2,0.1,0.4,0.1,0.6,0\n	c0.1-0.1,0.1-0.1,0.1-0.2c0-0.1-0.1-0.3-0.1-0.3l-4.5-4.3c0,0-0.5-0.4-0.5-0.9c0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.3-0.2,0.4-0.2\n	c0.4,0,0.9,0.4,1.1,0.7L9,25.2c0.2,0.1,0.4,0.1,0.6,0c0.1-0.1,0.1-0.1,0.1-0.2c0-0.1-0.1-0.3-0.1-0.3l-4.6-4.4\n	c-0.1-0.1-0.1-0.4,0.1-0.6c0.1-0.1,0.3-0.2,0.5-0.2c0.2,0,0.4,0.1,0.4,0.2h0l5,4.3c0.2,0.1,0.4,0.1,0.6,0c0.1-0.1,0.1-0.2,0.1-0.3\n	c0-0.1-0.1-0.2-0.1-0.3L7.8,20l0.5,0.1c1,0.2,2.6,0.9,4.7,3.1c4,4.2,4.5,8.1,4.5,9.2l0,0.1L13.1,35.5z"/>\n</svg>'}),gravit.colorMatchers.push(new GAnalogousMatcher,new GComplementaryMatcher),gravit.properties.push(new GDimensionsProperties,new GDocumentProperties,new GPolygonProperties,new GPathProperties,new GRectangleProperties,new GEllipseProperties,new GTextProperties,new GImageProperties,new GSliceProperties,new GPageProperties),gravit.styleEntries.push(new GFillPaintEntry,new GStrokePaintEntry,new GBlurFilterEntry,new GOffsetVEffectEntry,new GShadowEffectEntry),gravit.transformers.push(new GAlignTransformer,new GAdjustTransformer),gravit.actions.push(new GNewAction,new GOpenAction,new GSaveAction,new GSaveAsAction,new GSaveAllAction,new GPlaceImageAction,new GCloseAction,new GCloseAllAction,new GUndoAction,new GRedoAction,new GCutAction,new GCopyAction,new GPasteAction,new GPasteInsideAction,new GDeleteAction,new GCopyAttributesAction,new GPasteAttributesAction,new GDuplicateAction,new GCloneAction,new GSelectAllAction,new GInvertSelectionAction,new GArrangeAction(GArrangeAction.Type.SendToFront),new GArrangeAction(GArrangeAction.Type.BringForward),new GArrangeAction(GArrangeAction.Type.SendBackward),new GArrangeAction(GArrangeAction.Type.SendToBack),new GAlignAction(GAlignAction.Type.AlignLeft),new GAlignAction(GAlignAction.Type.AlignCenter),new GAlignAction(GAlignAction.Type.AlignRight),new GAlignAction(GAlignAction.Type.AlignJustifyHorizontal),new GAlignAction(GAlignAction.Type.AlignTop),new GAlignAction(GAlignAction.Type.AlignMiddle),new GAlignAction(GAlignAction.Type.AlignBottom),new GAlignAction(GAlignAction.Type.AlignJustifyVertical),new GDistributeAction(GDistributeAction.Type.Horizontal),new GDistributeAction(GDistributeAction.Type.Vertical),new GSnapUnitAction(GSnapUnitAction.Type.FullUnit),new GSnapUnitAction(GSnapUnitAction.Type.HalfUnit),new GTransformAction(GTransformAction.Type.Rotate45Left),new GTransformAction(GTransformAction.Type.Rotate90Left),new GTransformAction(GTransformAction.Type.Rotate180Left),new GTransformAction(GTransformAction.Type.Rotate45Right),new GTransformAction(GTransformAction.Type.Rotate90Right),new GTransformAction(GTransformAction.Type.Rotate180Right),new GTransformAction(GTransformAction.Type.FlipVertical),new GTransformAction(GTransformAction.Type.FlipHorizontal),new GGroupAction,new GUngroupAction,new GAddPageAction,new GDeletePageAction,new GAddLayerAction,new GDeleteLayerAction,new GLayerTypeAction(IFLayer.Type.Output),new GLayerTypeAction(IFLayer.Type.Draft),new GLayerTypeAction(IFLayer.Type.Guide),new GOriginalViewAction,new GFitSelectionAction,new GFitCurrentPageAction,new GFitCurrentLayerAction,new GFitAllAction,new GMagnificationAction(6,null),new GMagnificationAction(12,null),new GMagnificationAction(25,null),new GMagnificationAction(50,[IFKey.Constant.META,"5"]),new GMagnificationAction(100,[IFKey.Constant.META,"1"]),new GMagnificationAction(200,[IFKey.Constant.META,"2"]),new GMagnificationAction(400,[IFKey.Constant.META,"4"]),new GMagnificationAction(800,[IFKey.Constant.META,"8"]),new GZoomInAction,new GZoomOutAction,new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Full),new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Fast),new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Outline),new GPaintModeAction(IFScenePaintConfiguration.PaintMode.Output),new GPixelPreviewAction,new GShowAllPagesAction,new GShowGridAction,new GShowRulersAction,new GNewWindowAction)},a.prototype.toString=function(){return"[Module Gravit]"},gravit.modules.push(new a)}(this);